"use strict";(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[876],{40876:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var o=a(72711),s=a(67907),n=a(65043),r=a(96452),l=a(728),i=a(55316),d=a(65187),c=a(78374),p=a(69062),h=a(97508),m=a(57726),u=a(35861),g=a(40252),f=a(93309),x=a(70579);class w extends n.Component{constructor(){super(...arguments),this.state={chartRef:n.createRef(),isDownloading:!1},this.downloadBtnClick=(e,t,a,o)=>{this.setState({isDownloading:!0},(()=>{let s=new r.PdfDocument({ended:(e,t)=>{t.blob&&this.setState({isDownloading:!1},(()=>{r.saveBlob(t.blob,"ProductDemandForecast.pdf")}))},pageSettings:{margins:{left:20,top:20,right:20,bottom:20},layout:r.PdfPageOrientation.Portrait}});try{(0,i.$E)(this.state.chartRef.hostElement,{cacheBust:!0}).then((n=>{let i=140,d=30;s.drawText(e("ProductDemandForecast_Report"),null,null,{align:r.PdfTextHorizontalAlign.Center,font:new r.PdfFont("times",16,"normal","bold"),lineGap:40}),s.drawText(e("ProductDemandForecast_Product"),0,s.y,{font:new r.PdfFont("times",12,"normal","bold"),continued:!0}),s.drawText(this.props.baseProduct,null,null,{continued:!0,font:new r.PdfFont("times",12,"normal","normal")}),s.drawText(e("ProductForecast_PrintDate"),265,s.y,{font:new r.PdfFont("times",12,"normal","bold"),continued:!0}),s.drawText((new Date).toLocaleString(),null,null,{font:new r.PdfFont("times",12,"normal","normal")}),s.drawText(e("ProductDemandForecast_Duration"),null,null,{font:new r.PdfFont("times",12,"normal","bold"),continued:!0}),s.drawText((new Date).toLocaleDateString()+" - "+this.props.endDate.toLocaleDateString(),null,null,{font:new r.PdfFont("times",12,"normal","normal"),lineGap:20});let c=s.y;s.paths.rect(0,c,560,d).stroke(),s.drawText(e("Tank_Details_Label")+": ",2,c+2,{font:new r.PdfFont("times",12,"normal","bold"),continued:!0}),s.drawText(e("Overall_Capacity_Label")+"- "+String(t)+" "+o+", "+e("Inventory_Label")+"- "+String(a)+" "+o,s.x,c+2,{font:new r.PdfFont("times",12,"normal","normal")}),c+=d,s.paths.rect(0,c,i,d).stroke(),s.drawText(e("TankCode"),2,c+2,{font:new r.PdfFont("times",12,"normal","bold")}),s.paths.rect(0+i,c,i,d).stroke(),s.drawText(e("ProductForecast_Inventory",[o]),0+i+2,c+2,{font:new r.PdfFont("times",12,"normal","bold")}),s.paths.rect(0+2*i,c,i,d).stroke(),s.drawText(e("ProductForecast_Capacity",[o]),0+2*i+2,c+2,{font:new r.PdfFont("times",12,"normal","bold")}),s.paths.rect(0+3*i,c,i,d).stroke(),s.drawText(e("TankInfo_Mode"),0+3*i+2,c+2,{font:new r.PdfFont("times",12,"normal","bold")});let h=["Code","Capacity","GrossQuantity","TankMode"];this.props.selectedTanks.forEach((t=>{c+=d,c>=s.height&&(c=0,s.addPage()),h.forEach(((a,o)=>{let n=null===t[a]||void 0===t[a]?"":String(t[a]);"Code"===a&&(t.Active?n+=" ("+e("ProductForecast_ActiveTank")+")":n+=" ("+e("ProductForecast_InactiveTank")+")"),s.paths.rect(0+o*i,c,i,d).stroke(),s.drawText(n,0+o*i+2,c+2,{font:new r.PdfFont("times",12,"normal","normal"),width:i-2})}))})),s.y>s.height/2?s.addPage():s.moveDown(3);let m=new Date;m.setHours(0,0,0,0),s.drawText(e("ProductDemandForecast_ForecastTableDetails",[p._D(m,this.props.endDate)]),0,s.y,{font:new r.PdfFont("times",12,"normal","bold"),lineGap:20}),i=this.props.isSlotEnabled?70:80,d=40,c=s.y,s.paths.rect(0,c,i,d).stroke(),s.drawText(e("ProductForecast_Date"),2,c+2,{width:i-2,font:new r.PdfFont("times",12,"normal","bold")}),s.paths.rect(0+i,c,i,d).stroke(),s.drawText(e("ProductForecast_OpeningInventory",[o]),0+i+2,c+2,{width:i-2,font:new r.PdfFont("times",12,"normal","bold")}),s.paths.rect(0+2*i,c,i,d).stroke(),s.drawText(e("ProductForecast_OpeningUllage",[o]),0+2*i+2,c+2,{width:i-2,font:new r.PdfFont("times",12,"normal","bold")}),s.paths.rect(0+3*i,c,i,d).stroke(),s.drawText(e("ProductForecast_PlannedReceipts",[o]),0+3*i+2,c+2,{width:i-2,font:new r.PdfFont("times",12,"normal","bold")}),s.paths.rect(0+4*i,c,i,d).stroke(),s.drawText(e("ProductForecast_PlannedShipments",[o]),0+4*i+2,c+2,{width:i-2,font:new r.PdfFont("times",12,"normal","bold")}),s.paths.rect(0+5*i,c,i,d).stroke(),s.drawText(e("ProductForecast_ClosingInventory",[o]),0+5*i+2,c+2,{width:i-2,font:new r.PdfFont("times",12,"normal","bold")}),s.paths.rect(0+6*i,c,i,d).stroke(),s.drawText(e("ProductForecast_ClosingUllage",[o]),0+6*i+2,c+2,{width:i-2,font:new r.PdfFont("times",12,"normal","bold")});let u=["ForecastDate","OpenInventory","OpenUllage","PlannedReceiptQty","ShipQtyDemand","CloseInventory","CloseUllage"];this.props.isSlotEnabled&&(s.paths.rect(0+7*i,c,i,d).stroke(),s.drawText(e("ProductForecast_SlotAvailability"),0+7*i+2,c+2,{width:i-2,font:new r.PdfFont("times",12,"normal","bold")}),u.push(["ROADSlots","MarineSlots"])),this.props.forecastDetails.forEach((e=>{c+=d,c>=s.height-20&&(c=0,s.addPage()),u.forEach(((t,a)=>{let o="",n=2;if(s.paths.rect(0+a*i,c,i,d).stroke(),7===a?(o="Not Available",e[t[0]]>0&&(o="Truck"),e[t[1]]>0&&(o="Truck"===o?o+" | Marine":"Marine")):o=String(e[t]),"ShipQtyDemand"===t){let o="green";const r=this.props.isVolume?this.props.configuration.tolerance.Volume:this.props.configuration.tolerance.Mass;Number(e[t])>e.OpenInventory?o="red":Number(e[t])+Number(r)>e.OpenInventory&&(o="yellow"),n=12,s.paths.circle(0+a*i+5,c+6,4).fill(new l.Color(o))}s.drawText(o,0+a*i+n,c+2,{width:i-n,font:new r.PdfFont("times",12,"normal","normal")})}))})),s.addPage(),s.drawText(e("ProductDemandForecast_ForecastOverview"),null,null,{font:new r.PdfFont("times",12,"normal","bold"),lineGap:20}),s.drawImage(n,void 0,void 0,{width:560,align:r.PdfImageHorizontalAlign.Center}),s.end()})).catch((e=>{console.log("Error converting HTML to image: ",e),this.setState({isDownloading:!1})}))}catch(n){this.setState({isDownloading:!1}),console.log("Error generating PDF: ",n)}}))},this.setRefs=(e,t,a)=>{this.setState({chartRef:t})},this.fetchChartConfiguration=(e,t,a,o)=>{let s={};return Array.isArray(this.props.forecastDetails)&&(s={JSONFormat:'{"Chart": {"ChartDetails": {"bindings": {"seriesSource": "Table"}, "common": {"bindingX": "ForecastDate", "ChartType": "Line", "name": "Days"}, "chartLegend": {"position":"Right"}, "seriesData": [{"name": "Default_lblShipment", "binding": "ShipQtyDemand", "chartType": "Column"}, {"name": "Inventory_Label", "binding": "OpenInventory", "chartType": "Area"}], "chartAxis": [{"wjProperty": "axisY", "title": "'+e("ProductForecast_Quantity",[a])+'", "axisLine": true, "position": "Left"}]}, "Thresholds": [{"Value":'+t+', "Name": "Tolerance_Level", "tooltipContent": {"Label":"Tolerance_Level", "Value": "{y}"}}, {"Value": '+String(o)+', "Name": "Total_Capacity", "tooltipContent": {"Label": "Total_Capacity", "Value":"{y}"}}]}}',KPIData:{Table:this.props.forecastDetails}}),s}}render(){let e=0,t=0;const a=this.props.isVolume?this.props.configuration.uoms.Volume:this.props.configuration.uoms.Mass,n=String(this.props.isVolume?this.props.configuration.tolerance.Volume:this.props.configuration.tolerance.Mass);Array.isArray(this.props.selectedTanks)&&this.props.selectedTanks.forEach((a=>{e+=Number(a.Capacity),t+=Number(a.GrossQuantity)}));let r=new Date;return r.setHours(0,0,0,0),(0,x.jsx)("div",{children:(0,x.jsx)(d.A,{children:(0,x.jsx)(s.TranslationConsumer,{children:s=>(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"row",children:[(0,x.jsx)("div",{className:"col-12",children:(0,x.jsx)(o.Button,{className:"btn-download-product-forecast",type:"primary",onClick:()=>this.downloadBtnClick(s,e,t,a),disabled:!this.props.isChartDataReady||this.state.isDownloading,actionType:"button",children:s("Chart_Download")})}),(0,x.jsxs)("div",{className:"col-12 col-md-12 col-lg-5 col-xxl-4",children:[(0,x.jsx)("div",{className:"row",children:(0,x.jsx)("div",{className:"col-12",children:(0,x.jsx)(o.Select,{options:this.props.baseProductsList,multiple:!1,disabled:this.state.isDownloading,placeholder:s("Common_Select"),label:s("BPCode"),value:this.props.baseProduct,onChange:e=>this.props.onChange("BaseProduct",e),reserveSpace:!1,error:s(this.props.validationErrors.BaseProduct)})})}),(0,x.jsxs)("div",{className:"row",children:[(0,x.jsx)("div",{className:"col-12 col-md-10 p-0",children:(0,x.jsxs)("div",{className:"row m-0 p-0",children:[(0,x.jsx)("div",{className:"col-12 col-md-6 product-demand-forecasting-date",children:(0,x.jsx)(o.DatePicker,{disabled:!0,label:s("From"),displayFormat:(0,u.F1)(),type:"date",reserveSpace:!1,value:new Date})}),(0,x.jsx)("div",{className:"col-12 col-md-6 product-demand-forecasting-date",children:(0,x.jsx)(o.DatePicker,{type:"date",disabled:this.state.isDownloading,label:s("To"),displayFormat:(0,u.F1)(),disablePast:!0,onChange:e=>this.props.onChange("EndDate",e),onTextChange:e=>this.props.onChange("EndDate",e),value:this.props.endDate,reserveSpace:!1})}),""!==this.props.validationErrors.EndDate?(0,x.jsx)("div",{className:"col-12 below-text",children:(0,x.jsx)("span",{className:"ui error-message",children:s(this.props.validationErrors.EndDate,[this.props.configuration.maxDuration])})}):null]})}),(0,x.jsx)("div",{className:"col-12 col-md-2 mt-md-4 pl-md-0",children:(0,x.jsx)(o.Button,{type:"primary",className:"product-demand-forecast-go-btn",actionType:"button",disabled:this.props.isLoading||this.state.isDownloading,onClick:this.props.onGoClick,children:s("Common_Go")})})]}),null!==this.props.baseProduct&&void 0!==this.props.baseProduct&&""!==this.props.baseProduct?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"row",children:(0,x.jsx)("div",{className:"col-12",children:(0,x.jsxs)("span",{children:[s("Tank_Details_Label"),": ",s("Overall_Capacity_Label")," ",e," ",a," | ",s("Inventory_Label"),": ",t," ",a]})})}),(0,x.jsxs)("div",{className:"row",children:[""!==this.props.validationErrors.Tanks?(0,x.jsx)("div",{className:"col-12 below-text",children:(0,x.jsx)("span",{className:"ui error-message",children:s(this.props.validationErrors.Tanks)})}):null,(0,x.jsx)("div",{className:"col-12",children:(0,x.jsxs)(c.bQ,{data:this.props.tanks,lazy:!0,scrollable:!0,className:"tank-grid-product-forecast",scrollHeight:"173px",showHeader:!0,selection:this.props.selectedTanks,onSelectionChange:this.props.onTankSelection,onSelectAll:this.props.onTankSelection,selectionMode:"multiple",children:[(0,x.jsx)(c.bQ.Column,{field:"Code",header:s("TankCode"),renderer:e=>(0,x.jsx)(o.Tooltip,{element:(0,x.jsx)("span",{style:{color:e.rowData.Active?"#14b614":"red"},children:e.value}),hover:!0,event:"hover",content:s(e.rowData.Active?"ProductForecast_ActiveTank":"ProductForecast_InactiveTank")})}),(0,x.jsx)(c.bQ.Column,{field:"GrossQuantity",header:s("ProductForecast_Inventory",[a])}),(0,x.jsx)(c.bQ.Column,{field:"Capacity",header:s("ProductForecast_Capacity",[a])}),(0,x.jsx)(c.bQ.Column,{field:"TankMode",header:s("TankInfo_Mode"),renderer:e=>s(e.value)})]})})]})]}):null]}),this.props.isChartDataReady?(0,x.jsx)("div",{className:"col-12 col-md-12 col-lg-7 col-xxl-8",children:(0,x.jsx)(f.A,{header:s("ProductDemandForecast_ForecastOverview"),childCount:0,isExportRequired:!1,className:"product-forecast-chart",children:(0,x.jsx)(m.A,{kpiInfo:this.fetchChartConfiguration(s,n,a,e),setChartRefs:this.setRefs})})}):this.props.isLoading?(0,x.jsx)("div",{className:"col-12 col-md-12 col-lg-7 col-xxl-8",children:(0,x.jsx)(g.A,{message:"Loading"})}):null]}),this.props.isChartDataReady?(0,x.jsxs)("div",{className:"row",children:[(0,x.jsx)("div",{className:"col-12 col-md-12 col-lg-6",children:(0,x.jsx)("span",{children:s("ProductDemandForecastGridHeader",[p._D(r,this.props.endDate),this.props.baseProduct,r.toLocaleDateString(),this.props.endDate.toLocaleDateString()])})}),(0,x.jsx)("div",{className:"col-12 col-md-12 col-lg-6",children:(0,x.jsx)("span",{style:{float:"right",fontStyle:"italic",color:"#a0a0a0"},children:s("ProductDemandForecastDisclaimer")})}),(0,x.jsx)("div",{className:"col-12",children:(0,x.jsxs)(c.bQ,{data:this.props.forecastDetails,lazy:!0,scrollable:!0,scrollHeight:"300px",showHeader:!0,className:"forecast-details-table",columnResizeMode:"fit",resizableColumns:!0,children:[(0,x.jsx)(c.bQ.Column,{field:"ForecastDate",header:s("ProductForecast_Date")}),(0,x.jsx)(c.bQ.Column,{field:"OpenInventory",header:s("ProductForecast_OpeningInventory",[a])}),(0,x.jsx)(c.bQ.Column,{field:"OpenUllage",header:s("ProductForecast_OpeningUllage",[a])}),(0,x.jsx)(c.bQ.Column,{field:"PlannedReceiptQty",header:s("ProductForecast_PlannedReceipts",[a])}),(0,x.jsx)(c.bQ.Column,{field:"ShipQtyDemand",header:s("ProductForecast_PlannedShipments",[a]),renderer:e=>{let t=null;return t=e.value>e.rowData.OpenInventory?(0,x.jsx)(o.Icon,{root:"building",className:"pr-2",name:"close-circled",size:"small",color:"red"}):e.value+Number(n)>e.rowData.OpenInventory?(0,x.jsx)(o.Icon,{name:"badge-warning",className:"pr-2",color:"yellow",size:"small"}):(0,x.jsx)(o.Icon,{root:"common",name:"badge-check",className:"pr-2",size:"small",color:"green"}),(0,x.jsxs)("span",{children:[t,e.value]})}}),(0,x.jsx)(c.bQ.Column,{field:"CloseInventory",header:s("ProductForecast_ClosingInventory",[a])}),(0,x.jsx)(c.bQ.Column,{field:"CloseUllage",header:s("ProductForecast_ClosingUllage",[a])}),this.props.isSlotEnabled?(0,x.jsx)(c.bQ.Column,{field:"ROADSlots",header:(0,x.jsxs)("span",{children:[s("ProductForecast_SlotAvailability"),(0,x.jsxs)("span",{className:"px-1",style:{fontSize:"8px"},children:["(",s("Common_Receipts"),")"]})]}),renderer:e=>{let t=0===e.rowData.ROADSlots?"red":"inherit",a=0===e.rowData.MarineSlots?"red":"inherit";return(0,x.jsxs)("span",{children:[(0,x.jsx)("span",{className:"icon-Road",style:{color:t}}),(0,x.jsx)("span",{className:"pl-1",style:{color:t},children:s("Common_Truck")}),(0,x.jsx)("span",{children:" | "}),(0,x.jsx)("span",{className:"icon-Marine",style:{color:a}}),(0,x.jsx)("span",{className:"pl-1",style:{color:a},children:s("Marine")})]})}}):null]})})]}):this.props.isLoading?(0,x.jsx)("div",{className:"row",children:(0,x.jsx)("div",{className:"col-12",children:(0,x.jsx)(g.A,{message:"Loading"})})}):null]})})})})}}w.defaultProps={isChartDataReady:!1,isLoading:!1};const b=(0,h.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})))(w)},35861:(e,t,a)=>{a.d(t,{F1:()=>l,i7:()=>i,r4:()=>r});var o=a(86178),s=a.n(o),n=(a(15660),a(65043),a(70579));function r(e,t){if(Array.isArray(e)){0===e.filter((e=>e.text===t)).length&&e.unshift({value:null,text:t})}return e}function l(){let e=window.navigator.userLanguage||window.navigator.language;return s().locale(e),s().localeData().longDateFormat("L")}function i(e){return(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{children:e}),(0,n.jsx)("div",{class:"ui red circular empty label badge  circle-padding"})]})}}}]);
//# sourceMappingURL=876.fc18b596.chunk.js.map