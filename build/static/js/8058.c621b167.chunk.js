(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[8058],{8058:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>P});var i=s(65043),a=s(72711),o=s(67907),l=s(60446),r=s.n(l),n=s(51525),d=s(40854),h=s.n(d),c=s(69062),p=s(7523),m=s(72067),u=s(97508),S=s(40252),C=s(93779),f=s(11981),g=s(14159),y=s(80312),T=s(53536),v=s.n(T),D=s(65187),x=s(85800),M=s(70579);class j extends i.Component{constructor(){super(...arguments),this.state={}}getSlotTimings(){let e=[];try{let t=this.props.slotParameters,s=t.slotStartTime,i=t.slotEndTime,a=t.slotDuration,o=s;for(;o.isBefore(i);)e.push({text:o.format("HH:mm"),value:o.format("HH:mm")}),o=o.add(a,"minute")}catch(t){console.log("CreateSlotComposite-> error in getSlotTimings",t)}return e}getDurations(){let e=[];try{let t=this.props.slotParameters,s=t.maxSlots,i=t.slotDuration;for(let a=1;a<=s;a++)e.push({text:a*i,value:(a*i).toString()})}catch(t){console.log("CreateSlotComposite-> error in getDurations",t)}return e}getProductAvaiabilityList(){let e=[];try{let t=[],s=this.props.bayList.filter((e=>e.bayCode===this.props.slotCreateFields.bayCode));s.length>0&&(t=s[0].shareholder),e=v().cloneDeep(this.props.transactionData.products),e.forEach((e=>{e.isAvailable=!1,t.forEach((t=>{t.shCode===e.shCode&&t.fpCodes.forEach((t=>{t===e.code&&(e.isAvailable=!0)}))}))}))}catch(t){console.log("CreateSlotComposite-> error in getProductAvaiabilityList",t)}return e}getModalContent(){let e=this.props.slotCreateFields,t=this.props.slotParameters;if(this.props.isRefreshing)return(0,M.jsx)(S.A,{loadingClass:"nestedList",message:""});if(null!==this.props.slotInfo){let e=this.props.slotInfo;return(0,M.jsx)(o.TranslationConsumer,{children:s=>(0,M.jsxs)("div",{className:"slotBookSuccess",children:[(0,M.jsxs)("div",{children:[(0,M.jsx)("span",{className:"icon-accept productAvailable"}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:s("Booking_Success")})]}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[s("Slot_ReferenceNum")," :"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:e.ReferenceNumber})]}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[s("ViewShipmentTrailerStatus_Time")," :"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:r()(e.StartTime).add(-1*t.timeDifference,"minute").format("DD-MMM-YYYY HH:mm")}),(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[" ",s("To")," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:r()(e.EndTime).add(-1*t.timeDifference,"minute").format(this.props.transportationType===p.LY.ROAD?"HH:mm":"DD-MMM-YYYY HH:mm")})]}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[this.props.transportationType===p.LY.ROAD?s("BayGroupList_BayCode"):s("LocationInfo_BerthCode")," ",":"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:e.LocationCode})]}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[e.TransactionType.toString()===p.Mv.SHIPMENT?s("Report_ShipmentCode"):s("Receipt_Code")," ",":"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:e.TransactionCode})]})]})})}return(0,M.jsx)(o.TranslationConsumer,{children:t=>(0,M.jsxs)("div",{className:"slotCreateDiv ",children:[(0,M.jsxs)("div",{className:"row",children:[(0,M.jsxs)("div",{className:"col-12 col-sm-6 col-md-12 col-lg-12",children:[(0,M.jsx)("span",{children:this.props.transportationType===p.LY.ROAD?t("BayGroupList_BayCode"):t("LocationInfo_BerthCode")}),": ",(0,M.jsx)("span",{children:e.bayCode})]}),(0,M.jsxs)("div",{className:"col-12 col-sm-6 col-md-4 col-lg-4",children:[(0,M.jsx)(a.InputLabel,{fluid:!0,label:t("Report_Date")}),(0,M.jsx)(a.InputLabel,{fluid:!0,label:e.slotTime.format("DD-MMM-YYYY")})]}),(0,M.jsx)("div",{className:"col-12 col-sm-6 col-md-4 col-lg-4",children:(0,M.jsx)(a.Select,{fluid:!0,label:t("StartTime"),value:e.slotTime.format("HH:mm"),options:this.getSlotTimings(),onChange:e=>{this.props.onChange(e,"Time")},reserveSpace:!1})}),(0,M.jsx)("div",{className:"col-12  col-sm-6 col-md-4 col-lg-4",children:(0,M.jsx)(a.Select,{fluid:!0,label:t("SlotDuration"),value:e.slotDuration,options:this.getDurations(),reserveSpace:!1,onChange:e=>{this.props.onChange(e,"slotDuration")}})}),this.props.transportationType===p.LY.ROAD?(0,M.jsx)("div",{className:"col-12 col-sm-6 col-md-6 col-lg-6",children:(0,M.jsx)(a.Select,{fluid:!0,label:t("Header_Shareholder"),value:e.shareholder,options:this.props.shareholders,onChange:e=>{this.props.onChange(e,"shareholder")},reserveSpace:!1})}):"",this.props.transportationType===p.LY.ROAD&&e.slotSource!==p.Mv.RECEIPT?(0,M.jsx)("div",{className:"col-12 col-sm-6 col-md-6 col-lg-6",children:(0,M.jsxs)("div",{children:[(0,M.jsx)(a.Radio,{label:t("Default_lblShipment"),name:"RadioGroup",checked:e.slotSource===p.Mv.SHIPMENT,onChange:()=>{this.props.onChange(p.Mv.SHIPMENT,"slotSource")}}),(0,M.jsx)(a.Radio,{label:t("FeatureConfig_TrckOrder"),name:"RadioGroup",checked:e.slotSource===p.Mv.ORDER,onChange:()=>{this.props.onChange(p.Mv.ORDER,"slotSource")}}),(0,M.jsx)(a.Radio,{label:t("FeatureConfig_TrckCon"),name:"RadioGroup",checked:e.slotSource===p.Mv.CONTRACT,onChange:()=>{this.props.onChange(p.Mv.CONTRACT,"slotSource")}})]})}):"",this.props.transportationType===p.LY.ROAD&&e.slotSource===p.Mv.ORDER?(0,M.jsx)("div",{className:"col-12 col-sm-6 col-md-6 col-lg-6",children:(0,M.jsx)(a.Select,{fluid:!0,label:t("ShipmentOrder_OrderCode"),value:this.props.slotCreateFields.orderCode,options:c.Zj(this.props.slotCreateOptions.filteredorders),onSearch:e=>this.props.onSearchChange(e,"orders"),onChange:e=>{this.props.onChange(e,"orderCode")},reserveSpace:!1,search:!0,noResultsMessage:t("noResultsMessage")})}):"",this.props.transportationType===p.LY.ROAD&&e.slotSource===p.Mv.CONTRACT?(0,M.jsx)("div",{className:"col-12 col-sm-6 col-md-6 col-lg-6",children:(0,M.jsx)(a.Select,{fluid:!0,label:t("ContractInfo_ContractCode"),value:this.props.slotCreateFields.contractCode,options:c.Zj(this.props.slotCreateOptions.filteredcontracts),onSearch:e=>this.props.onSearchChange(e,"contracts"),onChange:e=>{this.props.onChange(e,"contractCode")},reserveSpace:!1,search:!0,noResultsMessage:t("noResultsMessage")})}):"",e.slotSource===p.Mv.SHIPMENT||e.slotSource===p.Mv.ORDER&&""!==e.orderCode||e.slotSource===p.Mv.CONTRACT&&""!==e.contractCode?(0,M.jsx)("div",{className:"col-12 col-sm-6 col-md-6 col-lg-6",children:(0,M.jsx)(a.Select,{fluid:!0,label:t("Report_ShipmentCode"),value:this.props.slotCreateFields.shipmentCode,options:c.Zj(this.props.slotCreateOptions.filteredshipments),onChange:e=>{this.props.onChange(e,"shipmentCode")},reserveSpace:!1,onSearch:e=>this.props.onSearchChange(e,"shipments"),search:!0,noResultsMessage:t("noResultsMessage")})}):"",e.slotSource===p.Mv.RECEIPT?(0,M.jsx)("div",{className:"col-12 col-sm-6 col-md-6 col-lg-6",children:(0,M.jsx)(a.Select,{fluid:!0,label:t("Receipt_Code"),value:this.props.slotCreateFields.receiptCode,options:c.Zj(this.props.slotCreateOptions.filteredreceipts),onSearch:e=>this.props.onSearchChange(e,"receipts"),onChange:e=>{this.props.onChange(e,"receiptCode")},reserveSpace:!1,search:!0,noResultsMessage:t("noResultsMessage")})}):"",(0,M.jsx)("div",{className:"col-12  col-sm-6 col-md-6 col-lg-6",children:(0,M.jsx)(a.Input,{fluid:!0,value:this.props.slotCreateFields.remarks,onChange:e=>this.props.onChange(e,"remarks"),label:t("DriverInfo_Remarks"),reserveSpace:!1})})]}),""!==this.props.slotCreateFields.receiptCode||""!==this.props.slotCreateFields.shipmentCode?(0,M.jsxs)("div",{children:[(0,M.jsxs)("div",{style:{display:"flex",justifyContent:"space-evenly"},children:[(0,M.jsxs)("div",{children:[(0,M.jsx)("span",{className:"icon-accept productAvailable"}),(0,M.jsx)("span",{className:"slotDetailssmallSpan",children:t("Product_Available")})]}),(0,M.jsxs)("div",{children:[(0,M.jsx)("span",{className:"icon-denied noProduct"}),(0,M.jsx)("span",{className:"slotDetailssmallSpan",children:t("Product_not_available")})]})]}),(0,M.jsxs)("div",{className:"slotModelSeparator",children:[(0,M.jsxs)("div",{style:{width:"150px"},children:[(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:t("productAllocation_Carrier")})," : ",(0,M.jsx)("span",{className:"slotDetailssmallSpan",children:this.props.transactionData.carrier})]}),(0,M.jsxs)("div",{style:{width:"150px"},children:[(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:this.props.transportationType===p.LY.ROAD?t("ViewShipment_Vehicle"):t("MarineShipmentList_Vessel")})," : ",(0,M.jsx)("span",{className:"slotDetailssmallSpan",children:this.props.transactionData.vehicle})]}),(0,M.jsxs)("div",{style:{width:"150px"},children:[(0,M.jsxs)("span",{className:"slotDetailsSmallBoldSpan",children:[this.props.transportationType===p.LY.ROAD?t("DriverInfo_Driver"):t("ViewMarineShipmentList_Captain")," "]})," : ",(0,M.jsx)("span",{className:"slotDetailssmallSpan",children:this.props.transactionData.driver})]})]}),(0,M.jsx)("div",{className:"slotModelSeparator",children:this.getProductAvaiabilityList().map((e=>(0,M.jsxs)("div",{style:{width:"150px"},children:[(0,M.jsx)("span",{className:e.isAvailable?"icon-accept productAvailable":"icon-denied noProduct"}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:e.code})," : ",(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[e.quantity,e.UOM]})]})))})]}):"",this.props.attributesList.length>0?this.props.attributesList.map((e=>(0,M.jsx)(D.A,{children:(0,M.jsx)(a.Accordion,{children:(0,M.jsx)(a.Accordion.Content,{className:"attributeAccordian",title:t("Attributes_Header"),children:(0,M.jsx)(x.n,{selectedAttributeList:e.attributeMetaDataList,handleCellDataEdit:this.props.onAttributeDataChange,attributeValidationErrors:this.props.attributeValidationErrors})})})}))):""]})})}render(){return(0,M.jsx)(o.TranslationConsumer,{children:e=>(0,M.jsxs)(a.Modal,{closeIcon:!0,onClose:()=>this.props.modelCloseEvent(),open:this.props.modelOpen,size:"small",closeOnDimmerClick:!1,className:"createSlotModal",children:[(0,M.jsx)(a.Modal.Header,{children:(0,M.jsxs)("div",{className:"createSlotHeader",children:[(0,M.jsx)("span",{children:this.props.slotParameters.terminalCode})," -"," ",(0,M.jsx)("span",{children:this.props.transportationType})]})}),(0,M.jsx)(a.Modal.Content,{children:(0,M.jsxs)(D.A,{children:[" ",this.getModalContent()]})}),(0,M.jsx)(a.Modal.Footer,{className:"createSlotModalFooter",children:(0,M.jsx)(D.A,{children:""===this.props.slotCreateFields.shipmentCode&&""===this.props.slotCreateFields.receiptCode||!1!==this.props.isRefreshing||"READY"!==this.props.transactionData.status||null!==this.props.slotInfo?"":(0,M.jsxs)("div",{style:{width:"100%"},children:[(0,M.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,M.jsx)(a.Button,{type:"primary",content:e("SlotBook_Book"),onClick:()=>this.props.onBook()})}),Array.isArray(this.props.validationErrors)&&this.props.validationErrors.length>0?(0,M.jsx)("div",{className:"below-text",children:(0,M.jsx)("span",{className:"ui error-message",children:e(this.props.validationErrors[0])})}):""]})})})]})})}}const E=j;var b=s(35861);class R extends i.Component{constructor(){super(...arguments),this.state={}}getSlotTimings(){let e=[];try{let t=this.props.slotParameters,s=t.slotStartTime,i=t.slotEndTime,a=t.slotDuration,o=s;for(;o.isBefore(i);)e.push({text:o.format("HH:mm"),value:o.format("HH:mm")}),o=o.add(a,"minute")}catch(t){console.log("ModifySlotComposite-> error in getSlotTimings",t)}return e}getDurations(){let e=[];try{let t=this.props.slotParameters,s=t.maxSlots,i=t.slotDuration;for(let a=1;a<=s;a++)e.push({text:a*i,value:(a*i).toString()})}catch(t){console.log("ModifySlotComposite-> error in getDurations",t)}return e}getProductAvaiabilityList(){let e=[];try{let t=[],s=this.props.bayList.filter((e=>e.bayCode===this.props.slotModifyFields.bayCode));s.length>0&&(t=s[0].shareholder),e=v().cloneDeep(this.props.transactionData.products),e.forEach((e=>{e.isAvailable=!1,t.forEach((t=>{t.shCode===e.shCode&&t.fpCodes.forEach((t=>{t===e.code&&(e.isAvailable=!0)}))}))}))}catch(t){console.log("ModifySlotComposite-> error in getProductAvaiabilityList",t)}return e}getFilteredBays(){let e=[];try{let t=this.props.bayList,s=[];null!==this.props.transactionData&&(s=this.props.transactionData.products),t.filter((e=>!0===e.active)).filter((e=>e.shareholder.filter((e=>s.filter((t=>t.shCode===e.shCode&&e.fpCodes.filter((e=>e===t.code)).length>0)).length>0)).length>0)).forEach((t=>{e.push({text:t.bayCode,value:t.bayCode})}))}catch(t){console.log("ModifySlotComposite-> error in getFilteredBays",t)}return e}getModalContent(){let e=this.props.slotModifyFields,t=this.props.slotParameters,s=this.props.slotInfo;if(this.props.isRefreshing)return(0,M.jsx)(S.A,{loadingClass:"nestedList",message:""});{if(this.props.resultStatus.modify)return(0,M.jsx)(o.TranslationConsumer,{children:e=>(0,M.jsxs)("div",{className:"slotBookSuccess",children:[(0,M.jsx)("div",{children:(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:e("Slot_Modify_Success")})}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[e("Slot_ReferenceNum")," :"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:s.ReferenceNumber})]}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[e("ViewShipmentTrailerStatus_Time")," :"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:r()(s.StartTime).add(-1*t.timeDifference,"minute").format("DD-MMM-YYYY HH:mm")}),(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[" ",e("To")," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:r()(s.EndTime).add(-1*t.timeDifference,"minute").format(s.TransportationType===p.LY.ROAD?"HH:mm":"DD-MMM-YYYY HH:mm")})]}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[s.TransportationType===p.LY.ROAD?e("BayGroupList_BayCode"):e("LocationInfo_BerthCode")," ",":"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:s.LocationCode})]}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[s.TransactionType.toString()===p.Mv.SHIPMENT?e("Report_ShipmentCode"):e("Receipt_Code")," ",":"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:s.TransactionCode})]})]})});if(this.props.resultStatus.cancel)return(0,M.jsx)(o.TranslationConsumer,{children:e=>(0,M.jsxs)("div",{className:"slotBookSuccess",children:[(0,M.jsx)("div",{children:(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:e("Slot_Cancel_Success")})}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[e("Slot_ReferenceNum")," :"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:s.ReferenceNumber})]}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[s.TransportationType===p.LY.ROAD?e("BayGroupList_BayCode"):e("LocationInfo_BerthCode")," ",":"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:s.LocationCode})]}),(0,M.jsxs)("div",{children:[(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[s.TransactionType.toString()===p.Mv.SHIPMENT?e("Report_ShipmentCode"):e("Receipt_Code")," ",":"," "]}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:s.TransactionCode})]})]})});let i=!r()().add(t.minSlotChangeMinutes,"minute").isBefore(r()(s.StartTime));return(0,M.jsx)(o.TranslationConsumer,{children:t=>(0,M.jsxs)("div",{className:"slotCreateDiv ",children:[(0,M.jsxs)("div",{className:"row",children:[(0,M.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,M.jsx)(a.DatePicker,{fluid:!0,value:e.slotTime.toDate(),displayFormat:(0,b.F1)(),label:t("Report_Date"),showYearSelector:"true",onChange:e=>this.props.onChange(e,"Date"),onTextChange:(e,t)=>{this.props.onChange(e,"Date")},disabled:i,reserveSpace:!1})}),(0,M.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,M.jsx)(a.Select,{fluid:!0,label:t("StartTime"),value:e.slotTime.format("HH:mm"),options:this.getSlotTimings(),onChange:e=>{this.props.onChange(e,"Time")},reserveSpace:!1,disabled:i})}),(0,M.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,M.jsx)(a.Select,{fluid:!0,label:t("SlotDuration"),value:e.slotDuration,options:this.getDurations(),reserveSpace:!1,onChange:e=>{this.props.onChange(e,"slotDuration")},disabled:i})}),(0,M.jsx)("div",{className:"col-12 col-md-12 col-lg-6",children:(0,M.jsx)(a.Select,{fluid:!0,label:s.TransportationType===p.LY.ROAD?t("BayGroupList_BayCode"):t("LocationInfo_BerthCode"),value:e.bayCode,options:this.getFilteredBays(),onChange:e=>{this.props.onChange(e,"bayCode")},reserveSpace:!1,disabled:i})}),(0,M.jsx)("div",{className:"col-12 col-md-12 col-lg-6",children:(0,M.jsx)(a.Input,{fluid:!0,value:this.props.slotModifyFields.remarks,onChange:e=>this.props.onChange(e,"remarks"),label:t("DriverInfo_Remarks"),reserveSpace:!1,disabled:i,indicator:"required"})})]}),null!==this.props.transactionData?(0,M.jsxs)("div",{children:[(0,M.jsxs)("div",{style:{display:"flex",justifyContent:"space-evenly"},children:[(0,M.jsxs)("div",{children:[(0,M.jsx)("span",{className:"icon-accept productAvailable"}),(0,M.jsx)("span",{className:"slotDetailssmallSpan",children:t("Product_Available")})]}),(0,M.jsxs)("div",{children:[(0,M.jsx)("span",{className:"icon-denied noProduct"}),(0,M.jsx)("span",{className:"slotDetailssmallSpan",children:t("Product_not_available")})]})]}),(0,M.jsxs)("div",{className:"slotModelSeparator",children:[(0,M.jsxs)("div",{style:{width:"150px"},children:[(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:t("productAllocation_Carrier")})," : ",(0,M.jsx)("span",{className:"slotDetailssmallSpan",children:this.props.transactionData.carrier})]}),(0,M.jsxs)("div",{style:{width:"150px"},children:[(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:s.TransportationType===p.LY.ROAD?t("ViewShipment_Vehicle"):t("MarineShipmentList_Vessel")})," : ",(0,M.jsx)("span",{className:"slotDetailssmallSpan",children:this.props.transactionData.vehicle})]}),(0,M.jsxs)("div",{style:{width:"150px"},children:[(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:s.TransportationType===p.LY.ROAD?t("DriverInfo_Driver"):t("ViewMarineShipmentList_Captain")})," : ",(0,M.jsx)("span",{className:"slotDetailssmallSpan",children:this.props.transactionData.driver})]})]}),(0,M.jsx)("div",{className:"slotModelSeparator",children:this.getProductAvaiabilityList().map((e=>(0,M.jsxs)("div",{style:{width:"150px"},children:[(0,M.jsx)("span",{className:e.isAvailable?"icon-accept productAvailable":"icon-denied noProduct"}),(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:e.code})," : ",(0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[e.quantity,e.UOM]})]})))})]}):"",this.props.attributesList.length>0?this.props.attributesList.map((e=>(0,M.jsx)(D.A,{children:(0,M.jsx)(a.Accordion,{children:(0,M.jsx)(a.Accordion.Content,{className:"attributeAccordian",title:t("Attributes_Header"),children:(0,M.jsx)(x.n,{selectedAttributeList:e.attributeMetaDataList,handleCellDataEdit:this.props.onAttributeDataChange,attributeValidationErrors:this.props.attributeValidationErrors})})})}))):""]})})}}render(){let e=this.props.slotInfo,t=!1;return null!==e&&!1===this.props.isRefreshing&&(t=!r()().add(this.props.slotParameters.minSlotChangeMinutes,"minute").isBefore(r()(e.StartTime))),(0,M.jsx)(o.TranslationConsumer,{children:s=>(0,M.jsxs)(a.Modal,{closeIcon:!0,onClose:()=>this.props.modelCloseEvent(),open:this.props.modelOpen,size:"small",closeOnDimmerClick:!1,className:"createSlotModal",children:[(0,M.jsx)(a.Modal.Header,{children:null===e?"":(0,M.jsxs)("div",{className:"createSlotHeader",children:[(0,M.jsx)("span",{children:e.TransactionCode}),e.TransportationType===p.LY.ROAD?" - "+e.ShareholderCode:""]})}),(0,M.jsx)(a.Modal.Content,{children:(0,M.jsx)(D.A,{children:this.getModalContent()})}),(0,M.jsx)(a.Modal.Footer,{className:"modifySlotModalFooter",children:(0,M.jsx)(D.A,{children:null!==e&&!1===this.props.isRefreshing&&!1===t&&"READY"===this.props.transactionData.status&&!1===this.props.resultStatus.modify&&!1===this.props.resultStatus.cancel?(0,M.jsxs)("div",{style:{width:"100%"},children:[(0,M.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[this.props.modifyAccess?(0,M.jsx)(a.Button,{type:"primary",content:s("UOM_Update"),onClick:()=>this.props.onModify()}):"",this.props.cancelAccess?(0,M.jsx)(a.Button,{type:"primary",content:s("SlotBook_Cancel"),className:"cancelButton",onClick:()=>this.props.onCancel()}):""]}),Array.isArray(this.props.validationErrors)&&this.props.validationErrors.length>0?(0,M.jsxs)("div",{className:"below-text",children:[" ",(0,M.jsx)("span",{className:"ui error-message",children:s(this.props.validationErrors[0])})," "]}):""]}):""})})]})})}}const L=R;var A=s(39424),N=s(80297),I=s(62900);class k extends i.Component{constructor(){super(...arguments),this.refreshTimer=null,this.state={slotRangeList:[],selectedSlotRange:{slNo:1,fromLTTime:r()(),fromCurrentTime:r()(),toLTTime:r()(),toCurrentTime:r()()},slotParameters:{slotStartTime:r()(),slotEndTime:r()(),slotDuration:30,timeDifference:0,minSlotMinutesToBook:30,maxSlotDaysToBook:7,minSlotChangeMinutes:90,maxSlots:1,refreshTime:5,terminalCode:this.props.terminal.Key.Code},bayList:[],shipmentSlotsList:[],receiptSlotsList:[],selectedDate:this.props.selectedDate,isShipmentsRefreshing:!0,isReceiptsRefreshing:!0,isCreateSlotOpen:!1,modalSlotCreateFields:{transactionType:"",slotTime:r()(),bayCode:"",slotDuration:0,slotSource:"",shareholder:"",orderCode:"",contractCode:"",shipmentCode:"",receiptCode:"",remarks:"",attributes:[]},modalSlotCreateList:{orders:[],filteredorders:[],contracts:[],filteredcontracts:[],shipments:[],filteredshipments:[],receipts:[],filteredreceipts:[]},isCreateModalrefreshing:!0,modalTransactionData:{products:[],driver:"",carrier:"",vehicle:"",status:""},modalValidationErrors:[],modelResultStatus:{modify:!1,cancel:!1},isModifySlotOpen:!1,isModifyModalrefreshing:!0,modalSlotModifyFields:{slotTime:r()(),bayCode:"",slotDuration:0,remarks:"",shareholder:"",transactionCode:"",attributes:[]},selectedSlotInfo:null,kpiList:{},shipmentPageIndex:1,receiptPageIndex:1,filteredShipmentBayCode:"-1",filteredReceiptBayCode:"-1",modAttributeMetaDataList:[],attributeValidationErrors:[],showBookSlotAuthenticationLayout:!1,showUpdateSlotAuthenticationLayout:!1,showCancelSlotAuthenticationLayout:!1,tempSlotInfo:{}},this.startRefreshTimer=()=>{this.refreshTimer=setInterval((()=>{this.props.operationsVisibilty.shipments&&(this.getSlotsList(p.Mv.SHIPMENT),this.getKPIList(p.Mv.SHIPMENT)),this.props.operationsVisibilty.receipts&&(this.getSlotsList(p.Mv.RECEIPT),this.getKPIList(p.Mv.RECEIPT))}),60*this.state.slotParameters.refreshTime*1e3)},this.stopRefreshTimer=()=>{null!==this.refreshTimer&&clearInterval(this.refreshTimer)},this.handleDateChanage=e=>{try{let t=this.state.selectedDate;t=t.add(e,"day"),this.setState({selectedDate:t,isShipmentsRefreshing:!0,isReceiptsRefreshing:!0},(()=>this.getConfigurationsAndSlotsList())),this.props.onDateChange("day",e)}catch(t){console.log("error in handleDateChanage",t)}},this.handleSlotModifyFieldsChange=(e,t)=>{try{let s=v().cloneDeep(this.state.modalSlotModifyFields);if("bayCode"===t||"slotDuration"===t||"remarks"===t)s[t]=e;else if("Time"===t){let t=s.slotTime,i=e.split(":");s.slotTime=t.set("hour",i[0]).set("minute",i[1])}else if("Date"===t){let t=r()(s.slotTime.toDate());s.slotTime=r()(e).set("hour",t.get("hour")).set("minute",t.get("minute")),isNaN(s.slotTime.get("hour"))&&(s.slotTime=r()(t))}this.setState({modalSlotModifyFields:s})}catch(s){console.log("error in handleSlotModifyFieldsChange",s)}},this.handleSlotCreateFieldsChange=(e,t)=>{try{let s=v().cloneDeep(this.state.modalSlotCreateFields);if("slotDuration"===t)s.slotDuration=e,this.setState({modalSlotCreateFields:s});else if("Time"===t){let t=s.slotTime,i=e.split(":");s.slotTime=t.set("hour",i[0]).set("minute",i[1]),this.setState({modalSlotCreateFields:s})}else"remarks"===t?(s.remarks=e,this.setState({modalSlotCreateFields:s})):(s[t]=e,this.prepareKeyDataforAvailableTransactions(s,t),this.setState({isCreateModalrefreshing:!0}))}catch(s){console.log("error in handleSlotCreateFieldsChange",s)}},this.closeSlotModifyModal=()=>{this.startRefreshTimer();let e={slotTime:r()(),bayCode:"",slotDuration:0,remarks:"",shareholder:"",transactionCode:"",attributes:[]};this.setState({isModifySlotOpen:!1,isModifyModalrefreshing:!0,selectedSlotInfo:null,transactionData:null,modalTransactionData:{products:[],driver:"",carrier:"",vehicle:"",status:""},modalSlotModifyFields:e,modalValidationErrors:[],modelResultStatus:{modify:!1,cancel:!1}})},this.closeSlotCreateModal=()=>{this.startRefreshTimer();let e={transactionType:"",slotTime:r()(),bayCode:"",slotDuration:this.state.slotParameters.slotDuration,slotSource:"",shareholder:this.props.userDetails.EntityResult.PrimaryShareholder,shipmentCode:"",receiptCode:"",orderCode:"",contractCode:"",remarks:"",attributes:[]};this.setState({isCreateSlotOpen:!1,isCreateModalrefreshing:!0,modalSlotCreateFields:e,modalSlotCreateList:{orders:[],filteredOrders:[],contracts:[],filteredcontracts:[],shipments:[],filteredshipments:[],receipts:[],filteredreceipts:[]},modalTransactionData:{products:[],driver:"",carrier:"",vehicle:"",status:""},selectedSlotInfo:null,modalValidationErrors:[]})},this.handleModelOptionsSearchChange=(e,t)=>{try{let s=v().cloneDeep(this.state.modalSlotCreateList),i=s[t].filter((t=>t.toLowerCase().includes(e.toLowerCase())));i.length>p.bM&&(i=i.slice(0,p.bM)),s["filtered"+t]=i,this.setState({modalSlotCreateList:s})}catch(s){console.log("slotDetailsComposite:Error occured on handleModelOptionsSearchChange",s)}},this.cancelBooking=()=>{let e=this.validateCancelSlot();if(0===e.length){let e=this.state.modalSlotModifyFields,t=v().cloneDeep(this.state.selectedSlotInfo);t.Remarks=e.remarks;let s=!0!==this.props.userDetails.EntityResult.IsWebPortalUser,i=v().cloneDeep(t);this.setState({showCancelSlotAuthenticationLayout:s,tempSlotInfo:i},(()=>{!1===s&&this.handleCancelBooking()}))}else console.log("Error while Cancel Slot",e)},this.handleCancelBooking=()=>{this.handleAuthenticationClose();try{let t=v().cloneDeep(this.state.tempSlotInfo),s=v().cloneDeep(this.state.modalValidationErrors);var e={ShareHolderCode:"",keyDataCode:0,KeyCodes:null,Entity:t};this.setState({isModifyModalrefreshing:!0}),h()(m.HER,c.tW(e,this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;if(!0===t.IsSuccess)if(null!==t.EntityResult){let e={modify:!1,cancel:!0};this.setState({modelResultStatus:e,isModifyModalrefreshing:!1},(()=>{this.props.operationsVisibilty.shipments&&(this.getSlotsList(p.Mv.SHIPMENT),this.getKPIList(p.Mv.SHIPMENT)),this.props.operationsVisibilty.receipts&&(this.getSlotsList(p.Mv.RECEIPT),this.getKPIList(p.Mv.RECEIPT))}))}else s.push("UnKnown_Error"),this.setState({isModifyModalrefreshing:!1,modalValidationErrors:s}),console.log("Error while Cancel Slot:",t);else s.push(t.ErrorList.length>0?t.ErrorList[0]:"UnKnown_Error"),this.setState({isModifyModalrefreshing:!1,modalValidationErrors:s}),console.log("Error while  Cancle Slot:",t)})).catch((e=>{s.push("UnKnown_Error"),this.setState({isModifyModalrefreshing:!1,modalValidationErrors:s}),console.log("Error while  Cancel Slot:",e)}))}catch(t){console.log("Error while Cancel Slot",t)}},this.updateSlotBooking=()=>{let e=this.validateUpdateSlot(),t=c.pI(this.state.modAttributeMetaDataList),s=this.validateAttributes(t);if(0===e.length&&s){let e=this.state.modalSlotModifyFields,s=this.state.slotParameters,i=v().cloneDeep(this.state.selectedSlotInfo);i.Remarks=e.remarks,i.StartTime=e.slotTime.add(s.timeDifference,"minute").toDate(),i.EndTime=this.getSlotLTEndTimeForSave(e.slotTime,e.slotDuration).add(s.timeDifference,"minute").toDate(),i.LocationCode=e.bayCode,i.Attributes=c.Gh(t),this.setState({isModifyModalrefreshing:!0});let a=!0!==this.props.userDetails.EntityResult.IsWebPortalUser,o=v().cloneDeep(i);this.setState({showUpdateSlotAuthenticationLayout:a,tempSlotInfo:o},(()=>{!1===a&&this.handleUpdateSlotBooking()}))}else console.log("Error while Update Slot",e)},this.handleUpdateSlotBooking=()=>{this.handleAuthenticationClose();try{let t=v().cloneDeep(this.state.tempSlotInfo),s=v().cloneDeep(this.state.modalValidationErrors);var e={ShareHolderCode:"",keyDataCode:0,KeyCodes:null,Entity:t};h()(m.y4Q,c.tW(e,this.props.tokenDetails.tokenInfo)).then((e=>{let i=e.data;if(!0===i.IsSuccess)if(null!==i.EntityResult){let e={modify:!0,cancel:!1};this.setState({modelResultStatus:e,selectedSlotInfo:t,isModifyModalrefreshing:!1},(()=>{this.props.operationsVisibilty.shipments&&(this.getSlotsList(p.Mv.SHIPMENT),this.getKPIList(p.Mv.SHIPMENT)),this.props.operationsVisibilty.receipts&&(this.getSlotsList(p.Mv.RECEIPT),this.getKPIList(p.Mv.RECEIPT))}))}else s.push("UnKnown_Error"),this.setState({isModifyModalrefreshing:!1,modalValidationErrors:s}),console.log("Error while Update Slot:",i);else s.push(i.ErrorList.length>0?i.ErrorList[0]:"UnKnown_Error"),this.setState({isModifyModalrefreshing:!1,modalValidationErrors:s}),console.log("Error while  Update Slot:",i)})).catch((e=>{s.push("UnKnown_Error"),this.setState({isModifyModalrefreshing:!1,modalValidationErrors:s}),console.log("Error while  Update Slot:",e)}))}catch(t){console.log("Error while Update Slot",t)}},this.bookSlot=()=>{let e=c.pI(this.state.modAttributeMetaDataList),t=this.validateBookSlot(),s=this.validateAttributes(e);if(0===t.length&&s){let t=this.state.modalSlotCreateFields,s=this.state.slotParameters,i={Remarks:t.remarks,TransactionType:t.transactionType,TransactionCode:t.transactionType===p.Mv.SHIPMENT?t.shipmentCode:t.receiptCode,Status:p.P4.BOOKED,StartTime:t.slotTime.add(s.timeDifference,"minute").toDate(),EndTime:this.getSlotLTEndTimeForSave(t.slotTime,t.slotDuration).add(s.timeDifference,"minute").toDate(),LocationCode:t.bayCode,ShareholderCode:t.shareholder,TerminalCode:s.terminalCode,TransportationType:this.props.transportationType,Attributes:c.Gh(e)},a=!0!==this.props.userDetails.EntityResult.IsWebPortalUser,o=v().cloneDeep(i);this.setState({showBookSlotAuthenticationLayout:a,tempSlotInfo:o},(()=>{!1===a&&this.handleBookSlot()}))}else console.log("Error while Booking Slot",t)},this.handleBookSlot=()=>{this.handleAuthenticationClose();let e=v().cloneDeep(this.state.tempSlotInfo),t=v().cloneDeep(this.state.modalValidationErrors);var s={ShareHolderCode:"",keyDataCode:0,KeyCodes:null,Entity:e};this.setState({isCreateModalrefreshing:!0,selectedSlotInfo:null});try{h()(m.E9R,c.tW(s,this.props.tokenDetails.tokenInfo)).then((e=>{let s=e.data;!0===s.IsSuccess?null!==s.EntityResult?this.setState({selectedSlotInfo:s.EntityResult,isCreateModalrefreshing:!1},(()=>{this.props.operationsVisibilty.shipments&&(this.getSlotsList(p.Mv.SHIPMENT),this.getKPIList(p.Mv.SHIPMENT)),this.props.operationsVisibilty.receipts&&(this.getSlotsList(p.Mv.RECEIPT),this.getKPIList(p.Mv.RECEIPT))})):(t.push("UnKnown_Error"),this.setState({isCreateModalrefreshing:!0,selectedSlotInfo:null,modalValidationErrors:t}),console.log("Error while Booking Slot:",s)):(t.push(s.ErrorList.length>0?s.ErrorList[0]:"UnKnown_Error"),this.setState({isCreateModalrefreshing:!1,selectedSlotInfo:null,modalValidationErrors:t}),console.log("Error while Booking Slot:",s))})).catch((e=>{t.push("UnKnown_Error"),this.setState({isCreateModalrefreshing:!1,selectedSlotInfo:null,modalValidationErrors:t}),console.log("Error while Booking Slot:",e)}))}catch(i){console.log("Error while Booking Slot",i)}},this.handleAttributeDataChange=(e,t)=>{try{let s=[],i=v().cloneDeep(this.state.modAttributeMetaDataList),a=i.filter((t=>t.TerminalCode===e.TerminalCode));a.length>0&&Array.isArray(a[0].attributeMetaDataList)&&(s=a[0].attributeMetaDataList.filter((t=>t.Code===e.Code))),s.length>0&&(s[0].DefaultValue=t);const o=v().cloneDeep(this.state.attributeValidationErrors);o[e.Code]=c.I5(e,t),this.setState({attributeValidationErrors:o,modAttributeMetaDataList:i})}catch(s){console.log("SlotDetailsComposite:Error occured on onAttributeDataChange",s)}},this.handleAuthenticationClose=()=>{this.setState({showBookSlotAuthenticationLayout:!1,showUpdateSlotAuthenticationLayout:!1,showCancelSlotAuthenticationLayout:!1})}}componentWillUnmount(){this.stopRefreshTimer()}getConfigurationsAndSlotsList(){try{let e=[],t=this.props.terminal.Key.TimeZone,s=this.props.slotConfigurations.filter((e=>e.TerminalCode===this.props.terminal.Key.Code)),i=-1*(new Date).getTimezoneOffset()-t,a=this.state.selectedDate,o=this.state.selectedDate,l="00:00",n="23:59",d="30",h=1,c=30,m=7,u=90,S=5;if(s.length>0){let e=s[0].SlotParams.filter((e=>"SlotStartTime"===e.Name));e.length>0&&(l=e[0].Value),e=s[0].SlotParams.filter((e=>"SlotEndTime"===e.Name)),e.length>0&&(n=e[0].Value),e=s[0].SlotParams.filter((e=>"SlotDuration"===e.Name)),e.length>0&&(d=e[0].Value),e=s[0].SlotParams.filter((e=>"MaxNoOfSlots"===e.Name)),e.length>0&&(h=e[0].Value),e=s[0].SlotParams.filter((e=>"AdvanceSlotBookMaxDays"===e.Name)),e.length>0&&(m=e[0].Value),e=s[0].SlotParams.filter((e=>"BookAdvSlotMinutes"===e.Name)),e.length>0&&(c=e[0].Value),e=s[0].SlotParams.filter((e=>"ChangeAdvSlotMinutes"===e.Name)),e.length>0&&(u=e[0].Value),e=s[0].SlotParams.filter((e=>"RefreshInterval"===e.Name)),e.length>0&&(S=e[0].Value)}a=a.set("hour",l.split(":")[0]).set("minute",l.split(":")[1]),o=o.set("hour",n.split(":")[0]).set("minute",n.split(":")[1]),a.diff(o,"minute")>=0&&(o=o.add(1,"day"));let C=v().cloneDeep(a),f=C.add(7*d,"minute"),g=1;for(;o.diff(f,"minute")>=0;)e.push({slNo:g,fromLTTime:C,fromCurrentTime:C.add(i,"minute"),toLTTime:f,toCurrentTime:f.add(i,"minute")}),C=C.add(d,"minute"),f=f.add(d,"minute"),g+=1;let y={slotStartTime:a,slotEndTime:o,slotDuration:d,timeDifference:i,terminalCode:this.props.terminal.Key.Code,maxSlots:h,minSlotChangeMinutes:u,minSlotMinutesToBook:c,maxSlotDaysToBook:m,refreshTime:S},T=r()(),D=e.filter((e=>e.fromCurrentTime.diff(T,"minute")>-1*d)),x=e[0];D.length>0?x=D[0]:T.isBefore(e[e.length-1].toCurrentTime)&&(x=e[e.length-1]),this.setState({slotRangeList:e,selectedSlotRange:x,slotParameters:y},(()=>{this.props.operationsVisibilty.shipments&&(this.getSlotsList(p.Mv.SHIPMENT),this.getKPIList(p.Mv.SHIPMENT)),this.props.operationsVisibilty.receipts&&(this.getSlotsList(p.Mv.RECEIPT),this.getKPIList(p.Mv.RECEIPT)),this.startRefreshTimer()}))}catch(e){console.log("error in getConfigurationsAndSlotsList",e)}}getKPIList(e){var t={message:"",messageType:"critical",messageResultDetails:[]};let s={PageName:e===p.Mv.SHIPMENT?A.rA:A.nO,TransportationType:this.props.transportationType,InputParameters:[{key:"TerminalCode",value:this.state.slotParameters.terminalCode},{key:"Date",value:this.state.selectedDate.format("YYYY-MM-DD")},{key:"TransactionType",value:e}]};h()(m.dxq,c.tW(s,this.props.tokenDetails.tokenInfo)).then((s=>{var i=s.data;if(!0===i.IsSuccess){let t=v().cloneDeep(this.state.kpiList);t[e]=i.EntityResult.ListKPIDetails,this.setState({kpiList:t})}else this.setState({driverKPIList:[]}),console.log("Error in slot details KPIList:",i.ErrorList),t.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:i.ErrorList[0]});t.messageResultDetails.length>0&&(0,g.toast)((0,M.jsx)(D.A,{children:(0,M.jsx)(f.A,{notificationMessage:t})}),{autoClose:"success"===t.messageType&&1e4})})).catch((e=>{console.log("Error while getting SlotDetails KPIList:",e)}))}getSlotsList(e){let t=this.state.slotParameters,s={TerminalCode:t.terminalCode,TransportationType:this.props.transportationType,TransactionSource:e,FromDate:t.slotStartTime.add(t.timeDifference,"minute").toDate(),ToDate:t.slotEndTime.add(t.timeDifference,"minute").toDate()};h()(m.ghg,c.tW(s,this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;!0===t.IsSuccess&&Array.isArray(t.EntityResult)?s.TransactionSource===p.Mv.SHIPMENT?this.setState({shipmentSlotsList:t.EntityResult,isShipmentsRefreshing:!1}):this.setState({receiptSlotsList:t.EntityResult,isReceiptsRefreshing:!1}):(s.TransactionSource===p.Mv.SHIPMENT?this.setState({isShipmentsRefreshing:!1}):this.setState({isReceiptsRefreshing:!1}),console.log("Error while getting getSlotList:",t))})).catch((e=>{s.TransactionSource===p.Mv.SHIPMENT?this.setState({isShipmentsRefreshing:!1}):this.setState({isReceiptsRefreshing:!1}),console.log("Error while getting getSlotList:",e)}))}prepareKeyDataforAvailableTransactions(e,t){try{let s=v().cloneDeep(this.state.modalSlotCreateList),i={TerminalCode:this.props.terminal.Key.Code,TransportationType:this.props.transportationType,TransactionSource:e.slotSource,LocationCode:e.bayCode,ShareholderCode:e.shareholder,CreatedFrom:p.U6.None,TransactionSourceCode:""};if("shareholder"===t){if(""===e.slotSource)return void this.setState({modalSlotCreateFields:e});e.slotSource===p.Mv.SHIPMENT?(e.shipmentCode="",this.getAvailableTransactionsToBook(i,"shipments",e,s)):e.slotSource===p.Mv.ORDER?(e.shipmentCode="",e.orderCode="",s.shipments=[],this.getAvailableTransactionsToBook(i,"orders",e,s)):e.slotSource===p.Mv.CONTRACT?(e.shipmentCode="",e.contractCode="",s.shipments=[],this.getAvailableTransactionsToBook(i,"contracts",e,s)):e.slotSource===p.Mv.RECEIPT&&(e.receiptCode="",this.getAvailableTransactionsToBook(i,"receipts",e,s))}else"slotSource"===t?e.slotSource===p.Mv.SHIPMENT?(e.shipmentCode="",e.orderCode="",e.contractCode="",s.contracts=[],s.filteredcontracts=[],s.orders=[],s.filteredorders=[],this.getAvailableTransactionsToBook(i,"shipments",e,s)):e.slotSource===p.Mv.ORDER?(s.shipments=[],s.filteredshipments=[],s.contracts=[],s.filteredcontracts=[],e.shipmentCode="",e.orderCode="",e.contractCode="",this.getAvailableTransactionsToBook(i,"orders",e,s)):e.slotSource===p.Mv.CONTRACT?(s.shipments=[],s.filteredshipments=[],s.orders=[],s.filteredorders=[],e.shipmentCode="",e.ordercode="",e.contractCode="",this.getAvailableTransactionsToBook(i,"contracts",e,s)):e.slotSource===p.Mv.RECEIPT&&(e.receiptCode="",this.getAvailableTransactionsToBook(i,"receipts",e,s)):"orderCode"===t?(e.shipmentCode="",i.CreatedFrom=p.U6.Order,i.TransactionSource=p.Mv.SHIPMENT,i.TransactionSourceCode=e.orderCode,this.getAvailableTransactionsToBook(i,"shipments",e,s)):"contractCode"===t?(e.shipmentCode="",i.CreatedFrom=p.U6.Contract,i.TransactionSource=p.Mv.SHIPMENT,i.TransactionSourceCode=e.contractCode,this.getAvailableTransactionsToBook(i,"shipments",e,s)):"shipmentCode"===t?this.getShipment(e,"create"):"receiptCode"===t&&this.getReceipt(e,"create")}catch(s){console.log("error in prepareKeyDataforAvailableTransactions",s)}}getShipment(e,t){this.props.transportationType===p.LY.ROAD?this.getTruckShipment(e,t):this.props.transportationType===p.LY.MARINE&&this.getMarineShipment(e,t)}getReceipt(e,t){this.props.transportationType===p.LY.ROAD?this.getTruckReceipt(e,t):this.props.transportationType===p.LY.MARINE&&this.getMarineReceipt(e,t)}getTruckShipment(e,t){let s={products:[],driver:"",carrier:"",vehicle:"",status:""},i=[{key:C.yz,value:"create"===t?e.shipmentCode:e.transactionCode}],a={ShareHolderCode:e.shareholder,keyDataCode:C.yz,KeyCodes:i};h()(m.TJ4,c.tW(a,this.props.tokenDetails.tokenInfo)).then((i=>{let a=i.data;if(!0===a.IsSuccess&&null!=a.EntityResult){let e=a.EntityResult;s.driver=e.DriverCode,s.vehicle=e.VehicleCode,s.carrier=e.CarrierCode,s.status=e.Status,Array.isArray(e.ShipmentDetailsInfo)&&e.ShipmentDetailsInfo.forEach((e=>{s.products.push({code:e.FinishedProductCode,quantity:e.Quantity,UOM:e.QuantityUOM,shCode:e.ShareholderCode})}))}else console.log("Error in GetShiment:",a);"create"===t?this.setState({modalSlotCreateFields:e,modalTransactionData:s,isCreateModalrefreshing:!1}):this.setState({modalSlotModifyFields:e,modalTransactionData:s,isModifyModalrefreshing:!1})})).catch((s=>{"create"===t?this.setState({modalSlotCreateFields:e,isCreateModalrefreshing:!1}):this.setState({modalSlotModifyFields:e,isModifyModalrefreshing:!1}),console.log("Error while getting truck Shipment:",s)}))}getTruckReceipt(e,t){let s={products:[],driver:"",carrier:"",vehicle:"",status:""};var i=[{key:C.ml,value:"create"===t?e.receiptCode:e.transactionCode}],a={ShareHolderCode:e.shareholder,keyDataCode:C.ml,KeyCodes:i};h()(m.r$n,c.tW(a,this.props.tokenDetails.tokenInfo)).then((i=>{let a=i.data;if(!0===a.IsSuccess&&null!=a.EntityResult){let e=a.EntityResult;s.driver=e.DriverCode,s.vehicle=e.VehicleCode,s.carrier=e.CarrierCode,s.status=e.ReceiptStatus,Array.isArray(e.ReceiptCompartmentsInfo)&&e.ReceiptCompartmentsInfo.forEach((e=>{let t=s.products.filter((t=>e.FinishedProductCode===t.code));0===t.length?s.products.push({code:e.FinishedProductCode,quantity:e.Quantity,UOM:e.QuantityUOM,shCode:e.ShareholderCode}):t[0].quantity=t[0].quantity+e.Quantity}))}else console.log("Error in GetReceipt:",a);"create"===t?this.setState({modalSlotCreateFields:e,modalTransactionData:s,isCreateModalrefreshing:!1}):this.setState({modalSlotModifyFields:e,modalTransactionData:s,isModifyModalrefreshing:!1})})).catch((s=>{"create"===t?this.setState({modalSlotCreateFields:e,isCreateModalrefreshing:!1}):this.setState({modalSlotModifyFields:e,isModifyModalrefreshing:!1}),console.log("Error while getting Receipt:",s)}))}getMarineReceipt(e,t){let s={products:[],driver:"",carrier:"",vehicle:"",status:""};var i=[{key:C.UB,value:"create"===t?e.receiptCode:e.transactionCode},{key:C.v6,value:this.props.transportationType}],a={keyDataCode:C.UB,KeyCodes:i};h()(m.t7V,c.tW(a,this.props.tokenDetails.tokenInfo)).then((i=>{let a=i.data;if(!0===a.IsSuccess&&null!=a.EntityResult){let e=a.EntityResult;s.driver=e.GeneralTMUser,s.vehicle=e.VesselCode,s.carrier=e.CarrierCode,s.status=e.ReceiptStatus,Array.isArray(e.RailMarineReceiptCompartmentDetailPlanList)&&e.RailMarineReceiptCompartmentDetailPlanList.forEach((e=>{let t=s.products.filter((t=>e.FinishedProductCode===t.code&&e.ShareholderCode===t.shCode));0===t.length?s.products.push({code:e.FinishedProductCode,quantity:e.Quantity,UOM:e.QuantityUOM,shCode:e.ShareholderCode}):t[0].quantity=t[0].quantity+e.Quantity}))}else console.log("Error in GetReceipt:",a);"create"===t?this.setState({modalSlotCreateFields:e,modalTransactionData:s,isCreateModalrefreshing:!1}):this.setState({modalSlotModifyFields:e,modalTransactionData:s,isModifyModalrefreshing:!1})})).catch((s=>{"create"===t?this.setState({modalSlotCreateFields:e,isCreateModalrefreshing:!1}):this.setState({modalSlotModifyFields:e,isModifyModalrefreshing:!1}),console.log("Error while getting Receipt:",s)}))}getMarineShipment(e,t){let s={products:[],driver:"",carrier:"",vehicle:"",status:""};var i=[{key:C.yI,value:"create"===t?e.shipmentCode:e.transactionCode},{key:C.v6,value:this.props.transportationType}],a={keyDataCode:C.yI,KeyCodes:i};h()(m.FDo,c.tW(a,this.props.tokenDetails.tokenInfo)).then((i=>{let a=i.data;if(!0===a.IsSuccess&&null!=a.EntityResult){let e=a.EntityResult;s.driver=e.GeneralTMUser,s.vehicle=e.VesselCode,s.carrier=e.CarrierCode,s.status=e.DispatchStatus,Array.isArray(e.DispatchCompartmentDetailPlanList)&&e.DispatchCompartmentDetailPlanList.forEach((e=>{let t=s.products.filter((t=>e.FinishedProductCode===t.code&&e.ShareholderCode===t.shCode));0===t.length?s.products.push({code:e.FinishedProductCode,quantity:e.Quantity,UOM:e.QuantityUOM,shCode:e.ShareholderCode}):t[0].quantity=t[0].quantity+e.Quantity}))}else console.log("Error in GetReceipt:",a);"create"===t?this.setState({modalSlotCreateFields:e,modalTransactionData:s,isCreateModalrefreshing:!1}):this.setState({modalSlotModifyFields:e,modalTransactionData:s,isModifyModalrefreshing:!1})})).catch((s=>{"create"===t?this.setState({modalSlotCreateFields:e,isCreateModalrefreshing:!1}):this.setState({modalSlotModifyFields:e,isModifyModalrefreshing:!1}),console.log("Error while getting Shipment:",s)}))}getAvailableTransactionsToBook(e,t,s,i){h()(m.p0N,c.tW(e,this.props.tokenDetails.tokenInfo)).then((e=>{let a=e.data;!0===a.IsSuccess&&Array.isArray(a.EntityResult)?(i[t]=a.EntityResult,a.EntityResult.length>p.bM?i["filtered"+t]=a.EntityResult.slice(0,p.bM):i["filtered"+t]=a.EntityResult):(i[t]=[],i["filtered"+t]=[],console.log("Error while getting getAvailableTransactionsToBook:",a)),this.setState({modalSlotCreateFields:s,modalSlotCreateList:i,isCreateModalrefreshing:!1})})).catch((e=>{i[t]=[],i["filtered"+t]=[],this.setState({modalSlotCreateFields:s,modalSlotCreateList:i,isCreateModalrefreshing:!1}),console.log("Error while getting getAvailableTransactionsToBook:",e)}))}getFilteredTimeRangeOptions(e){let t=[];return this.state.slotRangeList.forEach((s=>{t.push({value:s.slNo,text:e?s.fromLTTime.format("HH:mm"):s.toLTTime.format("HH:mm")})})),t}handleTimeRangeChange(e){try{let t=this.state.slotRangeList.filter((t=>t.slNo===e));t.length>0?this.setState({selectedSlotRange:t[0]}):console.log("no slot Ranges identified")}catch(t){console.log("error in handleTimeRangeChange",t)}}moveTimeRange(e){let t=this.state.selectedSlotRange.slNo;t+=e,this.handleTimeRangeChange(t)}filterAttributeMetaData(e,t){try{let s=v().cloneDeep(this.props.attributeMetaDataList),i=[],a=[],o=this.props.terminal.Key.Code,l=this.props.transportationType+c.cd(p.Mv,e)+"SLOTINFO";if(Array.isArray(s[l])&&(i=s[l].filter((e=>e.TerminalCode===o))),a=c.Fl(i),a.length>0&&(a=a[0].attributeValidationErrors),null!==t&&void 0!==t){let e=t.Attributes.find((e=>e.TerminalCode===o));void 0!==e&&i.length>0&&i[0].attributeMetaDataList.forEach((t=>{let s=e.ListOfAttributeData.find((e=>e.AttributeCode===t.Code));void 0!==s&&(t.DefaultValue=s.AttributeValue)}))}this.setState({modAttributeMetaDataList:i,attributeValidationErrors:a})}catch(s){console.log("filterAttributeMetaData",s)}}getBaysforTerminal(){let e={messageType:"critical",message:this.props.transportationType===p.LY.ROAD?"BaySearch_NoResult":"Berths_Not_found",messageResultDetails:[]};h()(m.G2Z+"?TransportationType="+this.props.transportationType+"&TerminalCode="+this.props.terminal.Key.Code,c.Jm(this.props.tokenDetails.tokenInfo)).then((t=>{let s=t.data;if(!0===s.IsSuccess)if(Array.isArray(s.EntityResult)&&s.EntityResult.length>0){let e=[];s.EntityResult.forEach((t=>{let s={bayCode:t.BayCode,active:t.Active,bayType:t.BayType,shareholder:[]};Array.isArray(t.SupportedProducts)&&t.SupportedProducts.forEach((e=>{if(e.Active){let t=s.shareholder.filter((t=>t.shCode===e.Shareholdercode));t.length>0?t[0].fpCodes.push(e.Code):s.shareholder.push({shCode:e.Shareholdercode,fpCodes:[e.Code]})}})),e.push(s)})),this.setState({bayList:e},(()=>{this.getConfigurationsAndSlotsList()}))}else this.setState({isReceiptsRefreshing:!1,isShipmentsRefreshing:!1}),(0,g.toast)((0,M.jsx)(D.A,{children:(0,M.jsx)(f.A,{notificationMessage:e})}),{autoClose:"success"===e.messageType&&1e4}),console.log("No Bays found:",s);else this.setState({isReceiptsRefreshing:!1,isShipmentsRefreshing:!1}),(0,g.toast)((0,M.jsx)(D.A,{children:(0,M.jsx)(f.A,{notificationMessage:e})}),{autoClose:"success"===e.messageType&&1e4}),console.log("Error while getting bays:",s)})).catch((t=>{this.setState({isReceiptsRefreshing:!1,isShipmentsRefreshing:!1}),(0,g.toast)((0,M.jsx)(D.A,{children:(0,M.jsx)(f.A,{notificationMessage:e})}),{autoClose:"success"===e.messageType&&1e4}),console.log("Error while getting getSlotConfigurations:",t)}))}componentDidMount(){try{c.pJ(this.props.userDetails.EntityResult.IsArchived),this.getBaysforTerminal()}catch(e){console.log("error in Component did mount",e)}}getFPSpans(e,t){let s=[];try{for(const[i,a]of e.entries())t||i<2?s.push((0,M.jsxs)("span",{className:"slotDetailssmallSpan",children:[a,","]})):2===i&&s.push((0,M.jsx)("span",{className:"slotDetailssmallSpan",children:"..."}))}catch(i){console.log("error in getFPSpans",i)}return s}getbayFinishedProductPopover(e){return Array.isArray(e)&&e.length>0?(0,M.jsx)(D.A,{children:(0,M.jsx)(a.Popup,{className:"popup-theme-wrap",position:"top left",on:"click",element:this.getShareholderFPElements(e,!1),children:(0,M.jsx)(a.Card,{children:(0,M.jsx)(a.Card.Content,{children:this.getShareholderFPElements(e,!0)})})})}):""}getShareholderFPElements(e,t){let s=[];try{if(Array.isArray(e)){for(const[i,a]of e.entries())t?s.push((0,M.jsxs)("div",{style:{display:"flex"},children:[(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:a.shCode}),(0,M.jsx)("span",{children:": "}),this.getFPSpans(a.fpCodes,t)]})):i<2?s.push((0,M.jsxs)("div",{children:[(0,M.jsx)("span",{className:"slotDetailsSmallBoldSpan",children:a.shCode}),(0,M.jsx)("span",{children:": "}),this.getFPSpans(a.fpCodes,t)]})):2===i&&s.push((0,M.jsx)("div",{children:"..."}));return s}return""}catch(i){return console.log("error in getShareholderFPElements",i),""}}getBookedSlotsLayoutforBay(e,t,s,i){let a=[],l=this.state.selectedSlotRange,d=l.fromCurrentTime,h=l.toCurrentTime;return r().extend(n),t.filter((e=>e.LocationCode===i&&(d.isBetween(r()(e.StartTime),r()(e.EndTime).subtract(1,"minute"),"minute",[])||h.isBetween(r()(e.StartTime),r()(e.EndTime).subtract(1,"minute"),"minute",[])||r()(e.StartTime).isBetween(d,h,"minute",[])||r()(e.EndTime).subtract(1,"minute").isBetween(d,h,null,[])))).forEach((e=>{let t="",i="",l=0,n=100,c=r()(e.StartTime),m=r()(e.EndTime).subtract(1,"minute");l=s*c.diff(d,"minute"),l=l<0?1:l+1,window.innerWidth<=800&&l<=20?l+=18:l+=15.5,c.isBetween(d,h,null,[])&&m.isBetween(d,h,null,[])?n=m.diff(c,"minute")*s:c.isBefore(d)&&m.isAfter(h)?n=100:c.isBefore(d)?n=m.diff(d,"minute")*s:m.isAfter(d)&&(n=h.diff(c,"minute")*s),n-=.5,e.IsAuthorized?e.Status===p.P4.COMPLETED?(t="slotDetailsCompletedBooking",i="slotDetailsCompletedBookingBar"):m.isBefore(r()())?(t="slotDetailsPastBooking",i="slotDetailsPastBookingBar"):(t="slotDetailsFutureBooking",i="slotDetailsFutureBookingBar"):t="slotDetailsBlockedBooking",l<100&&a.push((0,M.jsx)(o.TranslationConsumer,{children:s=>(0,M.jsx)("div",{className:t,style:{left:l+"%",width:n+"%"},children:e.IsAuthorized?(0,M.jsxs)("div",{style:{cursor:"pointer"},onClick:()=>this.openSlotModifyModal(e),children:[(0,M.jsx)("div",{className:i}),(0,M.jsx)("div",{className:"slotDetailsTransactionSpan",children:(0,M.jsx)("span",{children:e.TransactionCode})}),(0,M.jsx)("div",{className:"slotDetailsBookingSpan",children:(0,M.jsx)("span",{children:e.ReferenceNumber})})]}):(0,M.jsx)("div",{className:"slotDetailsBookingSpan",children:(0,M.jsx)("span",{children:s("SlotUnauthorized")})})})}))})),a}openSlotModifyModal(e){this.stopRefreshTimer(),this.filterAttributeMetaData(e.TransactionType.toString(),e);let t={slotTime:r()(e.StartTime).add(-1*this.state.slotParameters.timeDifference,"minute"),slotDuration:(e.NoOfSlots*this.state.slotParameters.slotDuration).toString(),bayCode:e.LocationCode,transactionCode:e.TransactionCode,shareholder:e.ShareholderCode,remarks:e.Remarks};this.setState({isModifySlotOpen:!0,isModifyModalrefreshing:!0,selectedSlotInfo:e,modalValidationErrors:[],modelResultStatus:{modify:!1,cancel:!1}}),e.TransportationType===p.LY.ROAD?e.TransactionType.toString()===p.Mv.SHIPMENT?this.getTruckShipment(t,"modify"):this.getTruckReceipt(t,"modify"):e.TransportationType===p.LY.MARINE&&(e.TransactionType.toString()===p.Mv.SHIPMENT?this.getMarineShipment(t,"modify"):this.getMarineReceipt(t,"modify"))}openSlotCreateModal(e,t,s){this.stopRefreshTimer(),this.filterAttributeMetaData(e);let i={transactionType:e,slotTime:t,bayCode:s,slotDuration:this.state.slotParameters.slotDuration,slotSource:e,shareholder:this.props.userDetails.EntityResult.PrimaryShareholder,shipmentCode:"",receiptCode:"",orderCode:"",contractCode:"",remarks:""},a={TerminalCode:this.props.terminal.Key.Code,TransportationType:this.props.transportationType,TransactionSource:i.slotSource,LocationCode:i.bayCode,ShareholderCode:i.shareholder,CreatedFrom:p.U6.None,TransactionSourceCode:""};this.setState({isCreateSlotOpen:!0,isCreateModalrefreshing:!0,selectedSlotInfo:null,modalValidationErrors:[]}),this.getAvailableTransactionsToBook(a,e===p.Mv.SHIPMENT?"shipments":"receipts",i,{orders:[],filteredOrders:[],contracts:[],filteredcontracts:[],shipments:[],filteredshipments:[],receipts:[],filteredreceipts:[]})}validateCancelSlot(){r().extend(n);let e=[],t=this.state.modalSlotModifyFields,s=this.state.selectedSlotInfo,i=this.state.slotParameters,a=s.Remarks,o=t.remarks;if(null===o||0===o.length?e.push("OriginTerminal_RemarksRequired"):o.length>300?e.push("Contract_Remarks_Exceeds_MaxLen"):o===a?e.push("Remarks_Change_require"):o.match(/^[^!%<>?\[\]^`{}|~=]+$/)||e.push("Remarks_Invalid"),this.props.transportationType===p.LY.ROAD){let t=r()(s.StartTime);!1===r()().add(i.minSlotChangeMinutes,"minute").isBefore(t)&&e.push("Slot_Booking_Closed")}return this.setState({modalValidationErrors:e}),e}validateUpdateSlot(){r().extend(n);let e=[],t=this.state.modalSlotModifyFields,s=this.state.selectedSlotInfo,i=this.state.slotParameters,a=s.Remarks,o=t.remarks;null===o||0===o.length?e.push("OriginTerminal_RemarksRequired"):o.length>300?e.push("Contract_Remarks_Exceeds_MaxLen"):o===a?e.push("Remarks_Change_require"):o.match(/^[^!%<>?\[\]^`{}|~=]+$/)||e.push("Remarks_Invalid");let l=s.TransactionType.toString()===p.Mv.SHIPMENT?this.state.shipmentSlotsList:this.state.receiptSlotsList,d=t.slotTime,h=this.getSlotLTEndTimeForSave(t.slotTime,t.slotDuration),c=d.add(i.timeDifference,"minute"),m=h.add(i.timeDifference,"minute");!1===r()().add(i.minSlotChangeMinutes,"minute").isBefore(c)&&e.push("Slot_Booking_Closed");let u=i.slotStartTime,S=i.slotEndTime,C=d.diff(u,"day");u=u.add(C,"day"),S=S.add(C,"day"),d.isBetween(u,S,"minute","[)")||(u=u.add(-1,"day"),S=S.add(-1,"day"));let f=r()().add(-1*i.timeDifference,"minute").set("hour",0).set("minute",0).set("second",0);return u.set("hour",0).set("minute",0).set("second",0).diff(f,"day")>=i.maxSlotDaysToBook&&e.push("Slot_Booking_Closed"),this.props.transportationType===p.LY.ROAD&&h.isAfter(S)&&e.push("Slot_End_Time_Crossed_Day"),l.forEach((i=>{let a=r()(i.StartTime),o=r()(i.EndTime);i.LocationCode===t.bayCode&&i.TransactionCode!==s.TransactionCode&&(a.isBetween(c,m,"minute","[)")||o.isBetween(c,m,"minute","(]")||0===a.diff(c,"minute")&&0===o.diff(m,"minute"))&&e.push("Selected_Slot_Not_Available")})),this.setState({modalValidationErrors:e}),e}validateAttributes(e){let t=!0;var s=v().cloneDeep(this.state.attributeValidationErrors);let i=e.filter((e=>e.TerminalCode===this.state.slotParameters.terminalCode));return i.length>0&&Array.isArray(i[0].attributeMetaDataList)&&i[0].attributeMetaDataList.length>0&&(i[0].attributeMetaDataList.forEach((e=>{s[e.Code]=c.I5(e,e.DefaultValue)})),t=Object.values(s).every((function(e){return""===e}))),this.setState({attributeValidationErrors:s}),t}validateBookSlot(){r().extend(n);let e=[],t=this.state.modalSlotCreateFields,s=this.state.slotParameters,i=t.remarks;null===i||0===i.length||(i.length>300?e.push("Contract_Remarks_Exceeds_MaxLen"):i.match(/^[^!%<>?\[\]^`{}|~=]+$/)||e.push("Remarks_Invalid"));let a=t.transactionType.toString()===p.Mv.SHIPMENT?this.state.shipmentSlotsList:this.state.receiptSlotsList,o=t.slotTime,l=this.getSlotLTEndTimeForSave(t.slotTime,t.slotDuration),d=o.add(s.timeDifference,"minute"),h=l.add(s.timeDifference,"minute");return!1===r()().add(s.minSlotMinutesToBook,"minute").isBefore(d)&&e.push("Slot_Booking_Closed"),this.props.transportationType===p.LY.ROAD&&l.isAfter(s.slotEndTime)&&e.push("Slot_End_Time_Crossed_Day"),a.forEach((s=>{let i=r()(s.StartTime),a=r()(s.EndTime);s.LocationCode===t.bayCode&&(i.isBetween(d,h,"minute","[)")||a.isBetween(d,h,"minute","(]")||0===i.diff(d,"minute")&&0===a.diff(h,"minute"))&&e.push("Selected_Slot_Not_Available")})),this.setState({modalValidationErrors:e}),e}getSlotLTEndTimeForSave(e,t){r().extend(n);let s=this.state.slotParameters,i=s.slotStartTime,a=s.slotEndTime,o=e.diff(i,"day");i=i.add(o,"day"),a=a.add(o,"day"),e.isBetween(i,a,"minute","[)")||(i=i.add(-1,"day"),a=a.add(-1,"day"));let l=t,d=e;for(;0!==l;)d.add(l,"minute").isAfter(a)?(i=i.add(1,"day"),l-=a.diff(d,"minute"),a=a.add(1,"day"),d=i):(d=d.add(l,"minute"),l=0);return d}getBaySelectionControl(e,t){let s=[];return s.push({value:"-1",text:"All"}),e.forEach((e=>{s.push({value:e.bayCode,text:e.bayCode})})),(0,M.jsx)(o.TranslationConsumer,{children:e=>(0,M.jsx)(a.Select,{fluid:!0,value:t===p.Mv.SHIPMENT?this.state.filteredShipmentBayCode:this.state.filteredReceiptBayCode,options:s,onChange:e=>{t===p.Mv.SHIPMENT?this.setState({filteredShipmentBayCode:e}):this.setState({filteredReceiptBayCode:e})},reserveSpace:!1,search:!0})})}getSlotListLayOut(e,t,s){if(s)return(0,M.jsx)(S.A,{loadingClass:"nestedList",message:""});{let s=this.state.selectedSlotRange,i=this.state.slotParameters,o=[],l=s.fromLTTime,n=s.toLTTime,d=84/n.diff(l,"minute"),h=this.state.bayList,c=[];c=e===p.Mv.SHIPMENT?h.filter((e=>"BOTH"===e.bayType||"LOADING"===e.bayType)):h.filter((e=>"BOTH"===e.bayType||"UNLOADING"===e.bayType));let m=[],u="";if(u=e===p.Mv.SHIPMENT?this.state.filteredShipmentBayCode:this.state.filteredReceiptBayCode,"-1"===u){if(c.length>0){let t=5*((e===p.Mv.SHIPMENT?this.state.shipmentPageIndex:this.state.receiptPageIndex)-1),s=t+5;s>=c.length&&(s=c.length),m=c.slice(t,s)}}else m=c.filter((e=>e.bayCode===u));let S=r()(),C=S.add(-1*i.timeDifference,"minute"),f=S.add(i.minSlotMinutesToBook,"minute");for(;l.isBefore(n);)o.push({fromLTTime:l,fromCurrentTime:l.add(i.timeDifference,"minute"),toLTTime:l.add(i.slotDuration,"minute"),toCurrentTime:l.add(i.slotDuration,"minute").add(i.timeDifference,"minute")}),l=l.add(i.slotDuration,"minute");return(0,M.jsxs)("div",{className:" tableScroll tableSlotScroll",style:{overflowY:"hidden"},children:[(0,M.jsxs)("div",{style:{display:"flex",minWidth:"800px"},children:[(0,M.jsx)("div",{className:"slotBaySelection",children:this.getBaySelectionControl(c,e)}),o.map((e=>(0,M.jsx)(D.A,{children:(0,M.jsx)("div",{style:{width:"12%",textAlign:"center",margin:"auto"},children:(0,M.jsx)("span",{style:{paddingTop:"0.438rem"},children:e.fromLTTime.format("HH:mm")})})})))]}),m.map((s=>(0,M.jsx)(D.A,{children:(0,M.jsx)("div",{className:s.active?"":"slotInActiveBay",children:(0,M.jsxs)("div",{className:"slotDetailsBayBar",children:[(0,M.jsxs)("div",{className:"slotDetailsBayDiv",children:[(0,M.jsx)("div",{children:(0,M.jsx)("span",{className:"slotDetailsBayFont",children:s.bayCode})}),(0,M.jsx)("div",{children:this.getbayFinishedProductPopover(s.shareholder)})]}),o.map((t=>(0,M.jsx)(D.A,{children:(0,M.jsx)("div",{className:"slotDetailsSlotsDiv",children:(0,M.jsx)("div",{className:"slotDetailsAddIconDiv",children:f.isBefore(t.fromCurrentTime)&&this.state.selectedDate.diff(C,"day")<i.maxSlotDaysToBook&&s.active&&this.props.operationsVisibilty.add?(0,M.jsx)("div",{onClick:()=>this.openSlotCreateModal(e,t.fromLTTime,s.bayCode),children:(0,M.jsx)(a.Icon,{style:{cursor:"pointer"},root:"common",name:"badge-plus",exactSize:30})}):""})})}))),this.getBookedSlotsLayoutforBay(e,t,d,s.bayCode)]})})})))]})}}buildPaging(e){let t=this.state.bayList,s="-1",i=[];return e===p.Mv.SHIPMENT?(i=t.filter((e=>"BOTH"===e.bayType||"LOADING"===e.bayType)),s=this.state.filteredShipmentBayCode):(i=t.filter((e=>"BOTH"===e.bayType||"UNLOADING"===e.bayType)),s=this.state.filteredReceiptBayCode),i.length>5&&"-1"===s?(0,M.jsx)(D.A,{children:(0,M.jsx)(a.Pagination,{totalItems:i.length,itemsPerPage:5,activePage:e===p.Mv.SHIPMENT?this.state.shipmentPageIndex:this.state.receiptPageIndex,onPageChange:t=>{e===p.Mv.SHIPMENT?this.setState({shipmentPageIndex:t}):this.setState({receiptPageIndex:t})}})}):""}getTabControl(){return this.props.operationsVisibilty.shipments&&this.props.operationsVisibilty.receipts?(0,M.jsx)(o.TranslationConsumer,{children:e=>(0,M.jsxs)(a.Tab,{activeIndex:this.props.defaultTabIndex,onTabChange:e=>{this.props.onTabChange(e)},children:[(0,M.jsx)(a.Tab.Pane,{title:e("Common_Shipments"),children:(0,M.jsxs)("div",{children:[(0,M.jsx)(D.A,{children:this.getSlotListLayOut(p.Mv.SHIPMENT,this.state.shipmentSlotsList,this.state.isShipmentsRefreshing)}),this.buildPaging(p.Mv.SHIPMENT)]})}),(0,M.jsx)(a.Tab.Pane,{title:e("Common_Receipts"),children:(0,M.jsxs)("div",{children:[(0,M.jsx)(D.A,{children:this.getSlotListLayOut(p.Mv.RECEIPT,this.state.receiptSlotsList,this.state.isReceiptsRefreshing)}),this.buildPaging(p.Mv.RECEIPT)]})})]})}):this.props.operationsVisibilty.shipments?(0,M.jsx)(o.TranslationConsumer,{children:e=>(0,M.jsx)(a.Tab,{activeIndex:this.props.defaultTabIndex,onTabChange:e=>{this.props.onTabChange(e)},children:(0,M.jsx)(a.Tab.Pane,{title:e("Common_Shipments"),children:(0,M.jsxs)("div",{children:[" ",(0,M.jsx)(D.A,{children:this.getSlotListLayOut(p.Mv.SHIPMENT,this.state.shipmentSlotsList,this.state.isShipmentsRefreshing)}),this.buildPaging(p.Mv.SHIPMENT)]})})})}):this.props.operationsVisibilty.receipts?(0,M.jsx)(o.TranslationConsumer,{children:e=>(0,M.jsx)(a.Tab,{activeIndex:this.props.defaultTabIndex,onTabChange:e=>{this.props.onTabChange(e)},children:(0,M.jsx)(a.Tab.Pane,{title:e("Common_Receipts"),children:(0,M.jsxs)("div",{children:[" ",(0,M.jsx)(D.A,{children:this.getSlotListLayOut(p.Mv.RECEIPT,this.state.receiptSlotsList,this.state.isReceiptsRefreshing)}),this.buildPaging(p.Mv.RECEIPT)]})})})}):void 0}getSlotKPIsPane(){return this.props.operationsVisibilty.shipments&&this.props.operationsVisibilty.receipts?0===this.props.defaultTabIndex&&Array.isArray(this.state.kpiList[p.Mv.SHIPMENT])?(0,M.jsx)(D.A,{children:(0,M.jsx)(N.A,{kpiList:this.state.kpiList[p.Mv.SHIPMENT],pageName:"SlotDetails"})}):1===this.props.defaultTabIndex&&Array.isArray(this.state.kpiList[p.Mv.RECEIPT])?(0,M.jsx)(D.A,{children:(0,M.jsx)(N.A,{kpiList:this.state.kpiList[p.Mv.RECEIPT],pageName:"SlotDetails"})}):"":this.props.operationsVisibilty.shipments?Array.isArray(this.state.kpiList[p.Mv.SHIPMENT])?(0,M.jsx)(D.A,{children:(0,M.jsx)(N.A,{kpiList:this.state.kpiList[p.Mv.SHIPMENT],pageName:"SlotDetails"})}):"":this.props.operationsVisibilty.receipts&&Array.isArray(this.state.kpiList[p.Mv.RECEIPT])?(0,M.jsx)(D.A,{children:(0,M.jsx)(N.A,{kpiList:this.state.kpiList[p.Mv.RECEIPT],pageName:"SlotDetails"})}):""}getOperationMode(){return this.state.showBookSlotAuthenticationLayout?y.i.add:this.state.showUpdateSlotAuthenticationLayout?y.i.modify:this.state.showCancelSlotAuthenticationLayout?y.i.remove:void 0}handleOperation(){return this.state.showBookSlotAuthenticationLayout?this.handleBookSlot:this.state.showUpdateSlotAuthenticationLayout?this.handleUpdateSlotBooking:this.state.showCancelSlotAuthenticationLayout?this.handleCancelBooking:void 0}render(){let e=this.state.selectedDate;return(0,M.jsx)(o.TranslationConsumer,{children:t=>(0,M.jsxs)("div",{children:[this.getSlotKPIsPane(),(0,M.jsx)("div",{className:"slotLayoutOuterPane",children:(0,M.jsxs)("div",{className:"slotDetailsPane",children:[(0,M.jsxs)("div",{className:"row lightBackground",children:[(0,M.jsx)("div",{className:"col-12 col-md-7 col-lg-8 slotDateColHeader",children:(0,M.jsxs)("div",{className:"slotBlocksDispaly",children:[(0,M.jsx)("div",{children:(0,M.jsx)(a.Icon,{onClick:()=>this.handleDateChanage(-1),style:{cursor:"pointer"},root:"common",name:"double-caret-left",exactSize:24})}),(0,M.jsx)("div",{className:"slotDateSpan",children:(0,M.jsx)("span",{children:e.format("DD-MMM-YYYY")})}),(0,M.jsx)("div",{children:(0,M.jsx)(a.Icon,{onClick:()=>this.handleDateChanage(1),style:{cursor:"pointer"},root:"common",name:"double-caret-right",exactSize:24})})]})}),(0,M.jsxs)("div",{className:"col-12 col-md-5 col-lg-4 ",style:{display:"flex",justifyContent:"space-between"},children:[(0,M.jsx)("div",{children:(0,M.jsx)(a.Icon,{onClick:()=>{this.state.selectedSlotRange.slNo>1&&this.moveTimeRange(-1)},style:{cursor:"pointer"},root:"common",name:"double-caret-left",exactSize:16,disabled:!0})}),(0,M.jsx)("div",{className:"slotTimeRangeDDL",children:(0,M.jsx)(a.Select,{fluid:!0,value:this.state.selectedSlotRange.slNo,options:this.getFilteredTimeRangeOptions(!0),onChange:e=>{this.handleTimeRangeChange(e)},reserveSpace:!1})}),(0,M.jsx)("div",{className:"slotTimeRangeDDL",children:(0,M.jsx)(a.Select,{fluid:!0,value:this.state.selectedSlotRange.slNo,options:this.getFilteredTimeRangeOptions(!1),disabled:!0,reserveSpace:!1})}),(0,M.jsx)("div",{children:(0,M.jsx)(a.Icon,{onClick:()=>{this.state.selectedSlotRange.slNo<this.state.slotRangeList.length&&this.moveTimeRange(-1),this.moveTimeRange(1)},style:{cursor:"pointer"},root:"common",name:"double-caret-right",exactSize:16})})]})]}),this.getTabControl()]})}),(0,M.jsx)(a.Button,{className:"backButton",onClick:this.props.onBackClick,content:t("Back")}),(0,M.jsx)(D.A,{children:(0,M.jsx)(E,{modelOpen:this.state.isCreateSlotOpen,slotCreateFields:this.state.modalSlotCreateFields,shareholders:c.Zj(this.props.terminal.Value),slotInfo:this.state.selectedSlotInfo,slotCreateOptions:this.state.modalSlotCreateList,transactionData:this.state.modalTransactionData,isRefreshing:this.state.isCreateModalrefreshing,transportationType:this.props.transportationType,slotParameters:this.state.slotParameters,bayList:this.state.bayList,validationErrors:this.state.modalValidationErrors,attributeValidationErrors:this.state.attributeValidationErrors,attributesList:this.state.modAttributeMetaDataList,modelCloseEvent:this.closeSlotCreateModal,onChange:this.handleSlotCreateFieldsChange,onAttributeDataChange:this.handleAttributeDataChange,onSearchChange:this.handleModelOptionsSearchChange,onBook:this.bookSlot})}),(0,M.jsx)(D.A,{children:(0,M.jsx)(L,{modelOpen:this.state.isModifySlotOpen,isRefreshing:this.state.isModifyModalrefreshing,slotModifyFields:this.state.modalSlotModifyFields,slotInfo:this.state.selectedSlotInfo,slotParameters:this.state.slotParameters,transactionData:this.state.modalTransactionData,bayList:this.state.bayList,modifyAccess:this.props.operationsVisibilty.modify,cancelAccess:this.props.operationsVisibilty.cancel,validationErrors:this.state.modalValidationErrors,attributeValidationErrors:this.state.attributeValidationErrors,attributesList:this.state.modAttributeMetaDataList,resultStatus:this.state.modelResultStatus,onChange:this.handleSlotModifyFieldsChange,onAttributeDataChange:this.handleAttributeDataChange,modelCloseEvent:this.closeSlotModifyModal,onModify:this.updateSlotBooking,onCancel:this.cancelBooking})}),this.state.showBookSlotAuthenticationLayout||this.state.showUpdateSlotAuthenticationLayout||this.state.showCancelSlotAuthenticationLayout?(0,M.jsx)(I.A,{Username:this.props.userDetails.EntityResult.UserName,functionName:this.getOperationMode(),functionGroup:y.hk,handleOperation:this.handleOperation(),handleClose:this.handleAuthenticationClose}):null]})})}}const P=(0,u.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})))(k)},85800:(e,t,s)=>{"use strict";s.d(t,{n:()=>n});s(65043);var i=s(72711),a=s(67907),o=s(7523),l=s(35861),r=s(70579);function n(e){let{selectedAttributeList:t,handleCellDataEdit:s,attributeValidationErrors:n}=e;const d=e=>{if("0000-00-00"===e.DefaultValue)return h(e,new Date),new Date;var t=e.DefaultValue.split("-");return new Date(t[0],t[1]-1,t[2])},h=(e,t)=>{var i=new Date(t);t=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2),s(e,t)};return(0,r.jsx)(a.TranslationConsumer,{children:e=>(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("div",{className:"col-md-12 attributeDetails-wrap",children:(0,r.jsx)("div",{className:"row",children:t.map((t=>t.DataType.toLowerCase()===o.pe.STRING.toLowerCase()&&!0===t.IsVisible?(0,r.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,r.jsx)(i.Input,{fluid:!0,label:e(t.DisplayName),value:null===t.DefaultValue?"":t.DefaultValue,indicator:!0===t.IsMandatory?"required":null,disabled:!0===t.IsReadonly,onChange:e=>s(t,e),error:e(n[t.Code]),reserveSpace:!1})}):t.DataType.toLowerCase()!==o.pe.INT.toLowerCase()&&t.DataType.toLowerCase()!==o.pe.LONG.toLowerCase()||!0!==t.IsVisible?t.DataType.toLowerCase()!==o.pe.FLOAT.toLowerCase()&&t.DataType.toLowerCase()!==o.pe.DOUBLE.toLowerCase()||!0!==t.IsVisible?t.DataType.toLowerCase()===o.pe.BOOL.toLowerCase()&&!0===t.IsVisible?(0,r.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,r.jsx)(i.Checkbox,{className:"deviceCheckBox customDeviceCheckBox",label:e(t.DisplayName),checked:null===t.DefaultValue?"":"true"===t.DefaultValue.toString().toLowerCase(),disabled:!0===t.IsReadonly,onChange:e=>s(t,e)})}):t.DataType.toLowerCase()===o.pe.DATETIME.toLowerCase()&&!0===t.IsVisible?(0,r.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,r.jsx)(i.DatePicker,{fluid:!0,value:null===t.DefaultValue||""===t.DefaultValue?"":d(t),label:e(t.DisplayName),displayFormat:(0,l.F1)(),showYearSelector:"true",indicator:!0===t.IsMandatory?"required":null,disabled:!0===t.IsReadonly,onChange:e=>h(t,e),onTextChange:e=>{h(t,e)},error:e(n[t.Code]),reserveSpace:!1})}):null:(0,r.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,r.jsx)(i.Input,{fluid:!0,label:e(t.DisplayName),value:null===t.DefaultValue||""===t.DefaultValue?"":t.DefaultValue.toLocaleString(),indicator:!0===t.IsMandatory?"required":null,disabled:!0===t.IsReadonly,onChange:e=>s(t,e),error:e(n[t.Code]),reserveSpace:!1})}):(0,r.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,r.jsx)(i.Input,{fluid:!0,label:e(t.DisplayName),value:null===t.DefaultValue?"":t.DefaultValue,indicator:!0===t.IsMandatory?"required":null,disabled:!0===t.IsReadonly,onChange:e=>s(t,e),error:e(n[t.Code]),reserveSpace:!1})})))})})})})}},35861:(e,t,s)=>{"use strict";s.d(t,{F1:()=>r,i7:()=>n,r4:()=>l});var i=s(86178),a=s.n(i),o=(s(15660),s(65043),s(70579));function l(e,t){if(Array.isArray(e)){0===e.filter((e=>e.text===t)).length&&e.unshift({value:null,text:t})}return e}function r(){let e=window.navigator.userLanguage||window.navigator.language;return a().locale(e),a().localeData().longDateFormat("L")}function n(e){return(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{children:e}),(0,o.jsx)("div",{class:"ui red circular empty label badge  circle-padding"})]})}},51525:function(e){e.exports=function(){"use strict";return function(e,t,s){t.prototype.isBetween=function(e,t,i,a){var o=s(e),l=s(t),r="("===(a=a||"()")[0],n=")"===a[1];return(r?this.isAfter(o,i):!this.isBefore(o,i))&&(n?this.isBefore(l,i):!this.isAfter(l,i))||(r?this.isBefore(o,i):!this.isAfter(o,i))&&(n?this.isAfter(l,i):!this.isBefore(l,i))}}}()}}]);
//# sourceMappingURL=8058.c621b167.chunk.js.map