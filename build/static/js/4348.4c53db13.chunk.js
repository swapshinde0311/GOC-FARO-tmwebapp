"use strict";(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[4348,6094],{96094:(e,t,s)=>{s.r(t),s.d(t,{default:()=>I});var a=s(72711),i=s(65043),r=(s(63973),s(70579));const l=e=>{const{size:t,progress:s,strokeWidth:a,circleOneStroke:i}=e,l=t/2,n=t/2-a/2;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("svg",{className:"svg",width:t,height:t,children:[(0,r.jsx)("circle",{className:"svg-circle-bg",stroke:i,cx:l,cy:l,r:n,strokeWidth:a}),(0,r.jsx)("text",{x:"".concat(l),y:"".concat(l+10),className:"svg-circle-text",children:s})]})})};var n=s(53536),o=s.n(n),c=s(65187),h=s(78374),d=s(67907),p=s(39424),m=s(40854),u=s.n(m),g=s(72067),x=s(69062),T=s(14159),f=s(11981),y=s(80297);const C=window.runConfig.mapOptions;class D extends i.Component{constructor(){super(...arguments),this.state={selectedMOT:"",expandedRows:[],kpiList:[]},this.startRefreshTimer=()=>{let e=5;void 0!==C.refreshMinutes&&C.refreshMinutes>0&&(e=C.refreshMinutes),this.refreshTimer=setInterval((()=>{console.log("Details Refreshing started "+e+new Date),this.getKPIList()}),60*e*1e3)},this.stopRefreshTimer=()=>{null!==this.refreshTimer&&(clearInterval(this.refreshTimer),console.log("Details Refreshing stopped "+new Date))},this.handleMOTClick=e=>{this.setState({selectedMOT:e===this.state.selectedMOT?"":e})}}componentDidMount(){try{this.getKPIList(),this.startRefreshTimer()}catch(e){console.log("EnDashboarDetailsComposite:Error occured on ComponentDidMount",e)}}componentWillUnmount(){this.stopRefreshTimer()}getKPIList(){var e={message:"",messageType:"critical",messageResultDetails:[]};let t={PageName:p.Hk,InputParameters:[{key:"TerminalCode",value:this.props.selectedTerminal.TerminalCode}]};u()(g.dxq,x.tW(t,null)).then((t=>{var s=t.data;!0===s.IsSuccess?this.setState({kpiList:s.EntityResult.ListKPIDetails}):(this.setState({kpiList:[]}),console.log("Error in Dashboard KPIList:",s.ErrorList),e.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:s.ErrorList[0]})),e.messageResultDetails.length>0&&(0,T.toast)((0,r.jsx)(c.A,{children:(0,r.jsx)(f.A,{notificationMessage:e})}),{autoClose:"success"===e.messageType&&1e4})})).catch((e=>{console.log("Error while getting Dashboard KPIList:",e)}))}getTPIList(){let e=this.state.selectedMOT,t=this.props.selectedTerminal,s=[],i=this.props.tpiList.filter((e=>e.Key===t.TerminalCode));try{if(i.length>0&&Array.isArray(i[0].Value.MoTTPIDetails)){let t=[];""!==e?t=i[0].Value.MoTTPIDetails.filter((t=>t.Key===e)):(t=[{Key:"Terminal",Value:[]}],i[0].Value.MoTTPIDetails.forEach((e=>{t[0].Value=t[0].Value.concat(e.Value)}))),t.length>0&&Array.isArray(t[0].Value)&&t[0].Value.length>0&&t[0].Value.forEach((e=>{if("SingleValue"===e.ParentTPIDetails.ChartType){let t=o().cloneDeep(e.ParentTPIDetails);t.childTPIs=o().cloneDeep(e.ChildTPIDetails),s.push(t)}}))}}catch(l){console.log("error in format TPIs at DashboardDetails.getTPIList",l)}return(0,r.jsx)(c.A,{children:(0,r.jsx)(d.TranslationConsumer,{children:e=>(0,r.jsxs)(h.bQ,{data:s,reorderableColumns:!0,resizableColumns:!0,expandedRows:this.state.expandedRows,rowExpansionTemplate:this.rowExpansionTemplate,children:[(0,r.jsx)(h.bQ.Column,{initialWidth:"20%",field:"TPICategory",header:e("tpi_Category"),sortable:!0,renderer:t=>e("tpi_"+t.rowData.TPICategory)},"TPICategory"),(0,r.jsx)(h.bQ.Column,{initialWidth:"20%",header:e("tpi_Name"),renderer:t=>{let s=JSON.parse(t.rowData.JSONFormat);return e("tpi_"+s.reflocalekey+"_name")}},"TPIName"),(0,r.jsx)(h.bQ.Column,{header:e("tpi_Formula"),renderer:e=>{let t=JSON.parse(e.rowData.JSONFormat).item.formulaCol,s=e.rowData.TPIData[0];return null===s[t]?"---":(0,r.jsx)("span",{children:s[t]})}},"Formula"),(0,r.jsx)(h.bQ.Column,{initialWidth:"12%",header:e("tpi_Value"),renderer:e=>{let t=JSON.parse(e.rowData.JSONFormat),s=t.item.tpiValueCol,a=t.item.unit,i=e.rowData.TPIData[0];return null===i[s]?"---":(0,r.jsxs)("span",{children:[i[s]," ",a]})}},"TPIValue"),(0,r.jsx)(h.bQ.Column,{initialWidth:"10%",field:"TPIValue",header:e("tpi_Index"),sortable:!0,renderer:e=>{let t=JSON.parse(e.rowData.JSONFormat),s=t.item.tpiValueCol,a=e.rowData.TPIData[0],i=t.item.categories,l=this.getTPIColorCode(i,"tpiValue",a[s]);return(0,r.jsx)("span",{style:{color:l},children:e.rowData.TPIValue})}},"TPIIndex"),(0,r.jsx)(h.bQ.Column,{initialWidth:"5px",renderer:e=>{if(e.rowData.childTPIs.length>0){const t=this.state.expandedRows.findIndex((t=>t.TransportationType===e.rowData.TransportationType&&t.TPIName===e.rowData.TPIName))>=0;return(0,r.jsx)("div",{onClick:()=>this.toggleExpand(e.rowData,t),children:(0,r.jsx)(a.Icon,{root:"common",name:t?"caret-down":"caret-right"})})}return""}})]})})})}getTPIColorCode(e,t,s){let a="";try{let i=null===s?0:s;if(Array.isArray(e))for(const s of e)if(i>=s[t]){a=s.color;break}}catch(i){console.log("DashboardDetails-GetColor-Error:",i)}return a}rowExpansionTemplate(e){return(0,r.jsxs)("div",{children:["childTPIS: ",e.childTPIs.length]})}toggleExpand(e,t){let s=this.state.expandedRows;if(t){let t=s.findIndex((t=>t.TransportationType===e.TransportationType&&t.TPIName===e.TPIName));s.splice(t,1)}else s.push(e);this.setState({expandedRows:s})}getTransportationTPIIndexes(){let e=this.props.selectedTerminal,t=[];try{let s=this.props.tpiList.filter((t=>t.Key===e.TerminalCode));s.length>0&&Array.isArray(s[0].Value.MoTTPIIndex)&&s[0].Value.MoTTPIIndex.forEach((s=>{let a=JSON.parse(e.TerminalConfig).TPIConfig[s.Key],i=s.Key.toLowerCase();i="icon-"+i.charAt(0).toUpperCase()+i.slice(1);let n="tpiMotPane",o="tpiMOTType";s.Key===this.state.selectedMOT&&(n="tpiSelectedMotPane",o="selectedtpiMOTType"),t.push((0,r.jsx)("div",{className:"col-12 col-md-6 col-lg-4 col-xl-3",children:(0,r.jsx)(c.A,{children:(0,r.jsx)(d.TranslationConsumer,{children:e=>(0,r.jsxs)("div",{className:n,children:[(0,r.jsxs)("div",{style:{display:"flex",padding:"8px",paddingBottom:"0px",borderBottom:"1.5px solid #f0f0f0"},children:[(0,r.jsx)("div",{children:(0,r.jsx)("span",{className:i+" "+o+" font24"})}),(0,r.jsx)("div",{children:(0,r.jsx)("span",{className:o,children:e(s.Key)})})]}),(0,r.jsx)("div",{style:{height:"100px",cursor:"pointer"},onClick:()=>this.handleMOTClick(s.Key),children:(0,r.jsx)(l,{progress:s.Value,size:95,strokeWidth:5,circleOneStroke:this.getTPIColorCode(a,"tpiIndex",s.Value)})})]})})})}))}))}catch(s){console.log("error in DashboardDetails- getTransportationTPIIndexes",s)}return t}render(){return(0,r.jsx)(c.A,{children:(0,r.jsx)(d.TranslationConsumer,{children:e=>(0,r.jsxs)("div",{style:{marginTop:"10px"},children:[(0,r.jsxs)("div",{className:" ui breadcrumb",children:[(0,r.jsx)("div",{className:"section",style:{cursor:"pointer"},onClick:()=>this.props.onBackClick(1),children:(0,r.jsx)(a.Icon,{root:"common",name:"caret-left",className:"caretLeft"})}),(0,r.jsx)("div",{className:"section pl-1",children:(0,r.jsx)("span",{children:e("tpi_Benchmarking")+" - "+this.props.selectedTerminal.TerminalCode})})]}),(0,r.jsx)(c.A,{children:(0,r.jsx)(y.A,{kpiList:this.state.kpiList})}),(0,r.jsx)("div",{className:"row",children:this.getTransportationTPIIndexes()}),(0,r.jsx)("div",{children:this.getTPIList()})]})})})}}const I=D},84348:(e,t,s)=>{s.r(t),s.d(t,{default:()=>B});var a=s(65043),i=s(2077),r=s(99869),l=s(29350),n=s(91600),o=s(40252),c=s(40854),h=s.n(c),d=(s(66433),s(65187)),p=s(80228),m=s.n(p),u=s(97508),g=s(72711),x=s(67907),T=s(24182),f=(s(51880),s(70579));const y=e=>(0,f.jsx)(d.A,{children:(0,f.jsx)(T.gi,{naturalSlideWidth:e.slideWidth,totalSlides:e.items.length,visibleSlides:(()=>{let t=window.screen.width;return t<768?1:t>=768&&t<992?e.visibleSlides.tablet?e.visibleSlides.tablet:2:t>=992&&t<1600?e.visibleSlides.laptop?e.visibleSlides.laptop:3:e.visibleSlides.desktop?e.visibleSlides.desktop:4})(),naturalSlideHeight:e.slideHeight,children:(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)(T.Ap,{className:"slider",children:e.items.map(((t,s)=>(0,f.jsx)(T.q7,{index:s,children:(0,f.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.renderItem(t)})},s)))}),(0,f.jsx)(T._X,{className:"carousel-back-button",children:(0,f.jsx)(g.Icon,{root:"common",className:"carousel-next-prev-icon",name:"caret-left",size:"large"})}),(0,f.jsx)(T.CC,{className:"carousel-next-button",children:(0,f.jsx)(g.Icon,{root:"common",className:"carousel-next-prev-icon",name:"caret-right",size:"large"})})]})})});y.defaultProps={slideWidth:100,slideHeight:100};const C=y;var D=s(80297),I=s(72067),j=s(69062),v=s(39424),N=s(89453),k=s(44951),S=s(7523),P=s(57726),b=s(75667),w=s(8972);const R=window.runConfig.mapOptions;class E extends a.Component{constructor(){super(...arguments),this.state={mapData:null,carouselChartData:[],chartRefs:{},modalOpen:!1,parentKpiName:null},this.componentWillUnmount=()=>{this.timer&&(this.timer=clearInterval(this.timer))},this.autoRefreshTimer=()=>{let e=5;void 0!==R.refreshMinutes&&R.refreshMinutes>0&&(e=R.refreshMinutes),this.timer=setInterval((()=>{this.getCarouselChartData()}),60*e*1e3)},this.getMapData=()=>{h()("map.json",{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((e=>{let t=e.data;this.setState({mapData:t})})).catch((e=>{console.log("Error while getting Map data:",e)}))},this.getCarouselChartData=()=>{try{h()(I.dxq,j.tW({PageName:v.Bw,InputParameters:[],TransportationType:"All"},this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;t.IsSuccess?this.setState({carouselChartData:t.EntityResult.ListKPIDetails}):console.log("Error in carousel KPIList",t.ErrorList)})).catch((e=>{console.log(e)}))}catch(e){console.log("Error in carousel chart data:",e)}},this.getGenericChart=e=>e.ChartType===S.NB.FlexSeries||e.ChartType===S.NB.FlexPie||e.ChartType===S.NB.FlexDynamicSeries?(0,f.jsx)(d.A,{children:(0,f.jsx)(k.A,{cardHeader:e.KPIName,childCount:e.ChildCount,exportHandler:(e,t)=>(0,w.v)(this.state.chartRefs[e],t,e),handleClick:()=>this.cardClick(e.KPIName,null),modalOpen:e.KPIName===this.state.parentKpiName&&this.state.modalOpen,handleModalClose:()=>{this.setState({modalOpen:!1,parentKpiName:null,modalContent:null}),this.timer||this.autoRefreshTimer()},modalContent:this.state.modalContent,fullScreenHandler:this.fullScreenView,children:this.getChart(e)})}):"Chart Type not supported",this.fullScreenView=e=>{e?this.timer&&(this.timer=clearInterval(this.timer)):this.timer||this.autoRefreshTimer()},this.getChart=e=>e.ChartType===S.NB.FlexSeries?(0,f.jsx)(P.A,{kpiInfo:e,setChartRefs:this.setChartRefs}):e.ChartType===S.NB.FlexDynamicSeries?(0,f.jsx)(b.A,{kpiInfo:e,setChartRefs:this.setChartRefs}):e.ChartType===S.NB.FlexPie?(0,f.jsx)(N.A,{kpiInfo:e,setChartRefs:this.setChartRefs}):void 0,this.setChartRefs=(e,t)=>{this.setState((s=>({...s,chartRefs:{...s.chartRefs,[e]:t}})))},this.cardClick=async e=>{this.timer&&(this.timer=clearInterval(this.timer)),this.setState({modalOpen:!0,parentKpiName:e});try{this.getChildKpiData(e).then((t=>{let s=t.data;s.IsSuccess?this.setState({modalContent:(0,f.jsx)(x.TranslationConsumer,{children:t=>(0,f.jsx)(D.A,{kpiList:s.EntityResult.ListKPIDetails,fetchData:this.getChildKpiData,isDetails:!0,isDraggable:!0,isResizable:!0,rowHeight:125,widgetHeight:2,pageName:e+"Map",customControlObject:(0,f.jsx)("span",{className:"pl-1",style:{fontSize:"1.125rem"},children:t(e)}),exportRequired:!0})})}):console.log("Error in carousel KPIList",s.ErrorList)})).catch((e=>{console.log(e)}))}catch(t){console.log("Error in carousel chart data:",t)}},this.getChildKpiData=e=>h()(I.dxq,j.tW({PageName:v.Bw,InputParameters:[],TransportationType:"All",ParentKPIName:e},this.props.tokenDetails.tokenInfo))}componentDidMount(){try{this.getMapData(),this.props.userDetails.EntityResult.IsEnterpriseNode&&(this.getCarouselChartData(),this.autoRefreshTimer())}catch(e){console.log("ENDashboardSummary:Error occured on componentDidMount",e)}}getTPIColorCode(e,t,s){let a="";try{if(Array.isArray(e))for(const i of e)if(s>=i[t]){a=i.color;break}}catch(i){console.log("DashboardSummary-GetColor-Error:",i)}return a}getTerminalPopupDetails(e){let t=this.props.tpiList.filter((t=>t.Key===e.TerminalCode)),s=null,a=[];t.length>0&&(s=t[0].Value.TerminalTPIIndex,Array.isArray(t[0].Value.MoTTPIIndex)&&t[0].Value.MoTTPIIndex.forEach((e=>{a.push(e)})));let i=JSON.parse(e.TerminalConfig);return(0,f.jsx)(d.A,{children:(0,f.jsx)(x.TranslationConsumer,{children:t=>(0,f.jsx)("div",{style:{width:"100%"},children:(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:"row",children:(0,f.jsx)("div",{className:"col-12 col-md-12 col-lg-12",children:(0,f.jsx)("span",{style:{fontSize:"16px",fontWeight:"bold"},children:e.TerminalCode+" "+t("tpi_Overview")})})}),null!==s?(0,f.jsxs)("div",{className:"row",children:[(0,f.jsx)("div",{className:"col-8 col-md-8 col-lg-8",children:(0,f.jsx)("span",{style:{fontSize:"16px"},children:t("tpi_Terminal_Index")})}),(0,f.jsx)("div",{className:"col-4 col-md-4 col-lg-4",children:(0,f.jsx)("span",{style:{fontSize:"18px",color:this.getTPIColorCode(i.TPIConfig.Terminal,"tpiIndex",s)},children:s})})]}):"",a.map((e=>(0,f.jsxs)("div",{className:"row",children:[(0,f.jsx)("div",{className:"col-8 col-md-8 col-lg-8",children:(0,f.jsxs)("span",{style:{fontSize:"16px"},children:[t("tpi_"+e.Key+"_Index")," "]})}),(0,f.jsx)("div",{className:"col-4 col-md-4 col-lg-4",children:(0,f.jsx)("span",{style:{fontSize:"18px",color:this.getTPIColorCode(i.TPIConfig[e.Key],"tpiIndex",e.Value)},children:e.Value})})]}))),e.IsAlive||!this.props.userDetails.EntityResult.IsEnterpriseNode?"":(0,f.jsxs)("div",{className:"row",children:[(0,f.jsx)("div",{className:"col-6 col-md-6 col-lg-6",children:(0,f.jsx)("span",{style:{fontSize:"16px"},children:t("tpi_LastAliveTime")})}),(0,f.jsx)("div",{className:"col-6 col-md-6 col-lg-6",children:(0,f.jsx)("span",{style:{fontSize:"13px"},children:new Date(e.LastAliveTime).toLocaleDateString()+" "+new Date(e.LastAliveTime).toLocaleTimeString()})})]}),(0,f.jsxs)("div",{className:"row",children:[a.length>0?(0,f.jsx)("div",{className:"col-6 col-md-6 col-lg-6 mapButtondiv",children:(0,f.jsx)(g.Button,{className:"mapButton",content:t("AccessCardInfo_Details"),onClick:()=>this.props.onDetailsClick(e,2)})}):"",(0,f.jsx)("div",{className:"col-6 col-md-6 col-lg-6 mapButtondiv",children:(0,f.jsx)(g.Button,{className:"mapButton",content:t("tpi_Dashboard"),onClick:()=>this.props.onDashboardClick(e,3)})})]})]})})})})}getTerminalMarker(e){return(0,f.jsx)(d.A,{children:(0,f.jsx)(i.p,{position:[e.Latitude,e.Longitude],icon:m().divIcon({className:this.props.userDetails.EntityResult.IsEnterpriseNode?e.IsAlive?"icon-Location-pin blinking  mapAliveIcon":"icon-Location-pin mapDeadIcon":"icon-Location-pin mapAliveIcon"}),children:(0,f.jsx)(r.z,{children:this.getTerminalPopupDetails(e)})})})}render(){return null!==this.state.mapData?(0,f.jsx)("div",{style:{height:"90vh",position:"relative"},children:(0,f.jsxs)(d.A,{children:[(0,f.jsxs)(l.W,{style:{height:"100%"},zoom:R.zoom,center:R.center,children:[(0,f.jsx)(n.k,{style:{opacity:"1",weight:1},className:"mapCountry",data:this.state.mapData.features}),this.props.terminals.map((e=>this.getTerminalMarker(e)))]}),(0,f.jsx)(d.A,{children:this.state.carouselChartData&&this.props.userDetails.EntityResult.IsEnterpriseNode&&this.state.carouselChartData.length>0?(0,f.jsx)("div",{style:{position:"absolute",bottom:"-10px",zIndex:400,width:"100%"},children:(0,f.jsx)("div",{className:"row",children:(0,f.jsx)("div",{className:"col-12",children:(0,f.jsx)(C,{items:this.state.carouselChartData,slideWidth:100,visibleSlides:{tablet:2,laptop:3,desktop:4},renderItem:this.getGenericChart})})})}):null})]})}):(0,f.jsx)(o.A,{loadingClass:"nestedList",message:""})}}const L=(0,u.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})))(E);s(63973);var A=s(96094),M=(s(38726),s(14159)),O=s(43724);const V=window.runConfig.mapOptions;class K extends a.Component{constructor(){super(...arguments),this.refreshTimer=null,this.state={terminals:[],tpiList:[],screenType:1,selectedTerminal:""},this.startRefreshTimer=()=>{let e=5;void 0!==V.refreshMinutes&&V.refreshMinutes>0&&(e=V.refreshMinutes),this.refreshTimer=setInterval((()=>{console.log("Summary Refreshing started "+e+new Date),this.getTerminalsInfo(),this.getTPIInfo()}),60*e*1e3)},this.stopRefreshTimer=()=>{null!==this.refreshTimer&&(clearInterval(this.refreshTimer),console.log("Summary Refreshing stopped "+new Date))},this.handleDetailsClick=(e,t)=>{this.setState({selectedTerminal:e,screenType:t})},this.handleDashboardClick=(e,t)=>{this.setState({selectedTerminal:e,screenType:t})},this.handleBackClick=e=>{this.setState({screenType:e})}}componentDidMount(){try{this.getTerminalsInfo(),this.getTPIInfo(),this.startRefreshTimer()}catch(e){console.log("ENDashboardComposite:Error occured on componentDidMount",e)}}componentWillUnmount(){this.stopRefreshTimer()}getTerminalsInfo(){h()(I.vjL,j.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;!0===t.IsSuccess&&Array.isArray(t.EntityResult.Table)&&t.EntityResult.Table.length>0?this.setState({terminals:t.EntityResult.Table}):console.log("Error while getting Terminal List:",t)})).catch((e=>{console.log("Error while getting Terminal List:",e)}))}getTPIInfo(){h()(I.m5l,j.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;!0===t.IsSuccess&&Array.isArray(t.EntityResult)&&t.EntityResult.length>0?this.setState({tpiList:t.EntityResult}):console.log("Error while getting TPIInfo:",t)})).catch((e=>{console.log("Error while getting TPIInfo:",e)}))}getScreen(){return 1===this.state.screenType?(0,f.jsx)(d.A,{children:(0,f.jsx)(L,{terminals:this.state.terminals,tpiList:this.state.tpiList,onDetailsClick:this.handleDetailsClick,onDashboardClick:this.handleDashboardClick})}):2===this.state.screenType?(0,f.jsx)(d.A,{children:(0,f.jsx)(A.default,{tpiList:this.state.tpiList,selectedTerminal:this.state.selectedTerminal,onBackClick:this.handleBackClick})}):3===this.state.screenType?(0,f.jsx)(d.A,{children:(0,f.jsx)(O.default,{selectedTerminal:this.state.selectedTerminal,onBackClick:this.handleBackClick})}):""}render(){return(0,f.jsxs)("div",{children:[this.getScreen(),(0,f.jsx)(d.A,{children:(0,f.jsx)(M.ToastContainer,{hideProgressBar:!0,closeOnClick:!1,closeButton:!0,newestOnTop:!0,position:"bottom-right",toastClassName:"toast-notification-wrap"})})]})}}const B=(0,u.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})))(K)},43724:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var a=s(65043),i=s(72711),r=s(67907),l=s(97508),n=(s(7523),s(40854)),o=s.n(n),c=s(72067),h=s(69062),d=(s(60663),s(39424)),p=s(80297),m=s(65187),u=s(40252),g=s(53536),x=s.n(g),T=s(35861),f=s(70579);class y extends a.Component{constructor(){super(...arguments),this.state={selectedMOT:this.props.selectedMOT,kpis:{},chartRefs:{},modalOpen:!1,parentKpiName:null,rangeValue:{to:new Date((new Date).setHours(23,59,59,0)),from:new Date((new Date).setHours(0,0,0,0))},ErrorMsg:null,isRefreshing:!1,refreshInterval:15e3,exportLoading:!1},this.dashboardRef=a.createRef(),this.componentWillUnmount=()=>{this.interval&&(this.interval=clearInterval(this.interval))},this.handleMOTChange=e=>{e!==this.state.selectedMOT&&(this.setState({selectedMOT:e}),this.getKPIs(e))},this.getChildKpiData=e=>o()(c.dxq,h.tW({PageName:d.y6,InputParameters:[{key:"TerminalCode",value:this.props.selectedTerminal.TerminalCode},{key:"FromDate",value:this.state.rangeValue.from.toJSON()},{key:"ToDate",value:this.state.rangeValue.to.toJSON()}],TransportationType:this.state.selectedMOT,ParentKPIName:e},this.props.tokenDetails.tokenInfo)),this.loadWidgets=()=>{let e=h.wb(this.state.rangeValue.to,this.state.rangeValue.from);""!==e?this.setState({ErrorMsg:e}):this.setState((e=>({kpis:{...e.kpis,[this.state.selectedMOT]:void 0},ErrorMsg:null})),(()=>{this.getKPIs(this.state.selectedMOT)}))},this.handleDateTextChange=(e,t)=>{""===e&&this.setState({ErrorMsg:"",rangeValue:{...this.state.rangeValue,to:"",from:""}}),null!==t&&""!==t?this.setState({ErrorMsg:"Common_InvalidDate",rangeValue:{...this.state.rangeValue,to:"",from:""}}):this.setState({dateError:"",rangeValue:{...this.state.rangeValue,to:"",from:""}})},this.getDateControl=()=>(0,f.jsx)(r.TranslationConsumer,{children:e=>(0,f.jsxs)("div",{className:"col-sm-12 "+(this.state.exportLoading?"col-lg-8":"col-lg-9")+" pl-1 pb-0",style:{display:"flex"},children:[(0,f.jsx)(i.DatePicker,{type:"daterange",className:"dashboardDatePicker ml-sm-auto ml-lg-0",displayFormat:(0,T.F1)(),rangeValue:this.state.rangeValue,disableFuture:!0,closeOnSelection:!0,onTextChange:this.handleDateTextChange,onRangeSelect:e=>{let{to:t,from:s}=e;return this.dateChange(t,s)},error:e(this.state.ErrorMsg),reserveSpace:!1}),(0,f.jsx)(i.Button,{type:"primary",actionType:"button",onClick:this.loadWidgets,className:"doneButton ml-2",disabled:this.state.exportLoading,children:(0,f.jsx)(i.Icon,{root:"common",name:"arrow-right",size:"small",className:"btnArrowRight"})})]})}),this.dateChange=(e,t)=>{let s=new Date(e),a=new Date(t);"Invalid Date"===s.toString()?s=null:(s.setHours(23,59,59,0),s.toDateString()===(new Date).toDateString()?this.interval||this.autoRefreshData():this.interval&&(this.interval=clearInterval(this.interval))),"Invalid Date"===a.toString()&&(a=null),this.setState({rangeValue:{to:s,from:a}})},this.fullScreenView=e=>{e?this.interval&&(this.interval=clearInterval(this.interval)):this.interval||this.autoRefreshData()}}componentDidMount(){try{let e="";void 0!==this.state.selectedMOT&&null!==this.state.selectedMOT?e=this.state.selectedMOT:(Array.isArray(this.props.userDetails.EntityResult.TransportationTypes)&&this.props.userDetails.EntityResult.TransportationTypes.length>0&&(e=this.props.userDetails.EntityResult.TransportationTypes[0],this.setState({selectedMOT:e})),void 0!==e&&null!==e&&this.getKPIs(e),o()(c.xAA+"?LookUpTypeCode=TerminalsDashboard",h.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;!0===t.IsSuccess&&Number.isInteger(parseInt(t.EntityResult.RefreshInterval))?this.setState({refreshInterval:Number(t.EntityResult.RefreshInterval)},(()=>{this.autoRefreshData()})):(console.log("Error in fetching LookupValue"),this.autoRefreshData())})).catch((e=>{this.autoRefreshData(),console.log("Error in fetching LookupValue: ",e)})))}catch(e){console.log("EnDashboardOverviewComposite:Error occured on ComponentDidMount",e)}}autoRefreshData(){this.interval=setInterval((()=>{let e=h.wb(this.state.rangeValue.to,this.state.rangeValue.from);""!==e?this.setState({ErrorMsg:e}):this.setState({isRefreshing:!0,ErrorMsg:null},(()=>{this.getKPIs(this.state.selectedMOT)}))}),this.state.refreshInterval)}getKPIs(e){if(void 0===this.state.kpis[e]||this.state.isRefreshing){let t=x().cloneDeep(this.state.kpis);let s={PageName:d.y6,TransportationType:e,InputParameters:[{key:"TerminalCode",value:this.props.selectedTerminal.TerminalCode},{key:"FromDate",value:this.state.rangeValue.from.toJSON()},{key:"ToDate",value:this.state.rangeValue.to.toJSON()}]};o()(c.dxq,h.tW(s,this.props.tokenDetails.tokenInfo)).then((s=>{var a=s.data;!0===a.IsSuccess?(t[e]=a.EntityResult.ListKPIDetails,this.setState({kpis:t,isRefreshing:!1})):console.log("Error in Dashboard KPIList:",a.ErrorList)})).catch((e=>{console.log("Error while getting Dashboard KPIList:",e)}))}}BindTransportationTypes(){let e=[];if(Array.isArray(this.props.userDetails.EntityResult.TransportationTypes)){("carriercompany"===this.props.userDetails.EntityResult.RoleName.toLowerCase()?this.props.userDetails.EntityResult.TransportationTypes.filter((e=>"pipeline"!==e.toLowerCase())):[...this.props.userDetails.EntityResult.TransportationTypes]).forEach((t=>{let s=t.toLowerCase();s="icon-"+s.charAt(0).toUpperCase()+s.slice(1),e.push((0,f.jsx)(r.TranslationConsumer,{children:e=>(0,f.jsx)("div",{onClick:()=>this.handleMOTChange(t),className:"dashboardTab",children:(0,f.jsxs)("div",{className:this.state.selectedMOT===t?"flexWrap active":"flexWrap",children:[(0,f.jsx)("span",{className:s,style:{padding:"0",paddingTop:"0.4rem",paddingBottom:"0.25rem",fontSize:"24px"}}),(0,f.jsx)("a",{className:"item",children:e(t)})]})})}))}))}return e}render(){this.props.userDetails.EntityResult;return(0,f.jsx)(m.A,{children:(0,f.jsx)(r.TranslationConsumer,{children:e=>(0,f.jsxs)("div",{style:{marginTop:"10px"},children:[(0,f.jsxs)(m.A,{children:[(0,f.jsxs)("div",{className:"ui breadcrumb pl-1",style:{alignItems:"start"},children:[(0,f.jsx)("div",{className:"section mt-sm-2 mt-lg-0",style:{cursor:"pointer"},onClick:()=>this.props.onBackClick(1),children:(0,f.jsx)(i.Icon,{root:"common",name:"caret-left",className:"caretLeft"})}),(0,f.jsx)("div",{className:"section pl-1 mt-sm-2 mt-lg-0",style:{width:"50%"},children:(0,f.jsx)("span",{children:e("tpi_Dashboard")+" - "+this.props.selectedTerminal.TerminalCode})}),(0,f.jsx)("div",{className:"pr-3",style:{marginLeft:"auto"},children:(0,f.jsxs)("div",{className:"row",children:[this.getDateControl(),(0,f.jsx)("div",{className:"col-sm-12 "+(this.state.exportLoading?"col-lg-4":"col-lg-3")+" pl-3 pb-0 pt-sm-3 pt-lg-0",style:{textAlign:"right"},children:(0,f.jsxs)(i.Button,{type:"primary",disabled:this.state.exportLoading,className:"dashboardExport",onClick:()=>{this.dashboardRef.current&&this.setState({exportLoading:!0},(()=>{this.dashboardRef.current.exportAllCharts()}))},actionType:"button",children:[e("WijmoGridExport"),this.state.exportLoading?(0,f.jsx)("span",{className:"pl-1",children:(0,f.jsx)(i.Icon,{name:"redo",size:"small",loading:!0})}):null]})})]})})]}),(0,f.jsx)("div",{className:"dashboard detailsContainer",style:{paddingTop:"0px"},children:(0,f.jsxs)("div",{className:" ui pointing secondary ui scuf-tab menu ",style:{minHeight:"0px",marginBottom:"20px"},children:[this.BindTransportationTypes(),(0,f.jsxs)("div",{className:"mt-2 pr-3",style:{marginLeft:"auto",fontSize:"14px"},children:[e("LastUpdatedTime"),": ",(new Date).toLocaleTimeString()]})]})})]}),(0,f.jsx)(m.A,{children:this.state.kpis[this.state.selectedMOT]?(0,f.jsx)(p.A,{ref:this.dashboardRef,kpiList:this.state.kpis[this.state.selectedMOT],fetchData:this.getChildKpiData,fullScreenHandler:this.fullScreenView,isDraggable:!0,isResizable:!0,rowHeight:125,widgetHeight:2,exportCallback:()=>this.setState({exportLoading:!1}),pageName:"Dashboard"}):(0,f.jsx)(u.A,{loadingClass:"nestedList",message:""})})]})})})}}const C=(0,l.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})))(y)},11981:(e,t,s)=>{s.d(t,{A:()=>n});s(65043);var a=s(72711),i=s(67907),r=s(7523),l=s(70579);function n(e){let{notificationMessage:t}=e;function s(e){try{return e.split(r.uV)[0]}catch(t){return console.log(t),""}}function n(e){try{let t=e.split(r.uV);return t.splice(0,1),t}catch(t){return console.log(t),[]}}return(0,l.jsx)(i.TranslationConsumer,{children:e=>(0,l.jsx)(a.Notification,{className:"toast-notification",severity:t.messageType,hasIcon:!0,title:e(t.message),children:t.messageResultDetails.map((t=>{var a="";if(t.keyFields.length>0)for(var i=0;i<t.keyFields.length;i++)a=a+e(t.keyFields[i])+" : "+t.keyValues[i]+", ";return(0,l.jsxs)("div",{children:[(0,l.jsxs)("span",{style:{color:t.isSuccess?"#7eb338":"#F15A4F"},children:[a,t.isSuccess?e("NotificationList_MessageType_Success"):e("NotificationList_MessageType_Failure")+" : "+e(s(t.errorMessage),n(t.errorMessage))]}),(0,l.jsx)("br",{})]})}))})})}},35861:(e,t,s)=>{s.d(t,{F1:()=>n,i7:()=>o,r4:()=>l});var a=s(86178),i=s.n(a),r=(s(15660),s(65043),s(70579));function l(e,t){if(Array.isArray(e)){0===e.filter((e=>e.text===t)).length&&e.unshift({value:null,text:t})}return e}function n(){let e=window.navigator.userLanguage||window.navigator.language;return i().locale(e),i().localeData().longDateFormat("L")}function o(e){return(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:e}),(0,r.jsx)("div",{class:"ui red circular empty label badge  circle-padding"})]})}}}]);
//# sourceMappingURL=4348.4c53db13.chunk.js.map