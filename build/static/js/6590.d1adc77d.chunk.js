"use strict";(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[6590,8149],{43724:(t,e,s)=>{s.r(e),s.d(e,{default:()=>b});var r=s(65043),i=s(72711),n=s(67907),o=s(97508),a=(s(7523),s(40854)),l=s.n(a),h=s(72067),p=s(69062),d=(s(60663),s(39424)),c=s(80297),u=s(65187),f=s(40252),g=s(53536),m=s.n(g),_=s(35861),y=s(70579);class v extends r.Component{constructor(){super(...arguments),this.state={selectedMOT:this.props.selectedMOT,kpis:{},chartRefs:{},modalOpen:!1,parentKpiName:null,rangeValue:{to:new Date((new Date).setHours(23,59,59,0)),from:new Date((new Date).setHours(0,0,0,0))},ErrorMsg:null,isRefreshing:!1,refreshInterval:15e3,exportLoading:!1},this.dashboardRef=r.createRef(),this.componentWillUnmount=()=>{this.interval&&(this.interval=clearInterval(this.interval))},this.handleMOTChange=t=>{t!==this.state.selectedMOT&&(this.setState({selectedMOT:t}),this.getKPIs(t))},this.getChildKpiData=t=>l()(h.dxq,p.tW({PageName:d.y6,InputParameters:[{key:"TerminalCode",value:this.props.selectedTerminal.TerminalCode},{key:"FromDate",value:this.state.rangeValue.from.toJSON()},{key:"ToDate",value:this.state.rangeValue.to.toJSON()}],TransportationType:this.state.selectedMOT,ParentKPIName:t},this.props.tokenDetails.tokenInfo)),this.loadWidgets=()=>{let t=p.wb(this.state.rangeValue.to,this.state.rangeValue.from);""!==t?this.setState({ErrorMsg:t}):this.setState((t=>({kpis:{...t.kpis,[this.state.selectedMOT]:void 0},ErrorMsg:null})),(()=>{this.getKPIs(this.state.selectedMOT)}))},this.handleDateTextChange=(t,e)=>{""===t&&this.setState({ErrorMsg:"",rangeValue:{...this.state.rangeValue,to:"",from:""}}),null!==e&&""!==e?this.setState({ErrorMsg:"Common_InvalidDate",rangeValue:{...this.state.rangeValue,to:"",from:""}}):this.setState({dateError:"",rangeValue:{...this.state.rangeValue,to:"",from:""}})},this.getDateControl=()=>(0,y.jsx)(n.TranslationConsumer,{children:t=>(0,y.jsxs)("div",{className:"col-sm-12 "+(this.state.exportLoading?"col-lg-8":"col-lg-9")+" pl-1 pb-0",style:{display:"flex"},children:[(0,y.jsx)(i.DatePicker,{type:"daterange",className:"dashboardDatePicker ml-sm-auto ml-lg-0",displayFormat:(0,_.F1)(),rangeValue:this.state.rangeValue,disableFuture:!0,closeOnSelection:!0,onTextChange:this.handleDateTextChange,onRangeSelect:t=>{let{to:e,from:s}=t;return this.dateChange(e,s)},error:t(this.state.ErrorMsg),reserveSpace:!1}),(0,y.jsx)(i.Button,{type:"primary",actionType:"button",onClick:this.loadWidgets,className:"doneButton ml-2",disabled:this.state.exportLoading,children:(0,y.jsx)(i.Icon,{root:"common",name:"arrow-right",size:"small",className:"btnArrowRight"})})]})}),this.dateChange=(t,e)=>{let s=new Date(t),r=new Date(e);"Invalid Date"===s.toString()?s=null:(s.setHours(23,59,59,0),s.toDateString()===(new Date).toDateString()?this.interval||this.autoRefreshData():this.interval&&(this.interval=clearInterval(this.interval))),"Invalid Date"===r.toString()&&(r=null),this.setState({rangeValue:{to:s,from:r}})},this.fullScreenView=t=>{t?this.interval&&(this.interval=clearInterval(this.interval)):this.interval||this.autoRefreshData()}}componentDidMount(){try{let t="";void 0!==this.state.selectedMOT&&null!==this.state.selectedMOT?t=this.state.selectedMOT:(Array.isArray(this.props.userDetails.EntityResult.TransportationTypes)&&this.props.userDetails.EntityResult.TransportationTypes.length>0&&(t=this.props.userDetails.EntityResult.TransportationTypes[0],this.setState({selectedMOT:t})),void 0!==t&&null!==t&&this.getKPIs(t),l()(h.xAA+"?LookUpTypeCode=TerminalsDashboard",p.Jm(this.props.tokenDetails.tokenInfo)).then((t=>{var e=t.data;!0===e.IsSuccess&&Number.isInteger(parseInt(e.EntityResult.RefreshInterval))?this.setState({refreshInterval:Number(e.EntityResult.RefreshInterval)},(()=>{this.autoRefreshData()})):(console.log("Error in fetching LookupValue"),this.autoRefreshData())})).catch((t=>{this.autoRefreshData(),console.log("Error in fetching LookupValue: ",t)})))}catch(t){console.log("EnDashboardOverviewComposite:Error occured on ComponentDidMount",t)}}autoRefreshData(){this.interval=setInterval((()=>{let t=p.wb(this.state.rangeValue.to,this.state.rangeValue.from);""!==t?this.setState({ErrorMsg:t}):this.setState({isRefreshing:!0,ErrorMsg:null},(()=>{this.getKPIs(this.state.selectedMOT)}))}),this.state.refreshInterval)}getKPIs(t){if(void 0===this.state.kpis[t]||this.state.isRefreshing){let e=m().cloneDeep(this.state.kpis);let s={PageName:d.y6,TransportationType:t,InputParameters:[{key:"TerminalCode",value:this.props.selectedTerminal.TerminalCode},{key:"FromDate",value:this.state.rangeValue.from.toJSON()},{key:"ToDate",value:this.state.rangeValue.to.toJSON()}]};l()(h.dxq,p.tW(s,this.props.tokenDetails.tokenInfo)).then((s=>{var r=s.data;!0===r.IsSuccess?(e[t]=r.EntityResult.ListKPIDetails,this.setState({kpis:e,isRefreshing:!1})):console.log("Error in Dashboard KPIList:",r.ErrorList)})).catch((t=>{console.log("Error while getting Dashboard KPIList:",t)}))}}BindTransportationTypes(){let t=[];if(Array.isArray(this.props.userDetails.EntityResult.TransportationTypes)){("carriercompany"===this.props.userDetails.EntityResult.RoleName.toLowerCase()?this.props.userDetails.EntityResult.TransportationTypes.filter((t=>"pipeline"!==t.toLowerCase())):[...this.props.userDetails.EntityResult.TransportationTypes]).forEach((e=>{let s=e.toLowerCase();s="icon-"+s.charAt(0).toUpperCase()+s.slice(1),t.push((0,y.jsx)(n.TranslationConsumer,{children:t=>(0,y.jsx)("div",{onClick:()=>this.handleMOTChange(e),className:"dashboardTab",children:(0,y.jsxs)("div",{className:this.state.selectedMOT===e?"flexWrap active":"flexWrap",children:[(0,y.jsx)("span",{className:s,style:{padding:"0",paddingTop:"0.4rem",paddingBottom:"0.25rem",fontSize:"24px"}}),(0,y.jsx)("a",{className:"item",children:t(e)})]})})}))}))}return t}render(){this.props.userDetails.EntityResult;return(0,y.jsx)(u.A,{children:(0,y.jsx)(n.TranslationConsumer,{children:t=>(0,y.jsxs)("div",{style:{marginTop:"10px"},children:[(0,y.jsxs)(u.A,{children:[(0,y.jsxs)("div",{className:"ui breadcrumb pl-1",style:{alignItems:"start"},children:[(0,y.jsx)("div",{className:"section mt-sm-2 mt-lg-0",style:{cursor:"pointer"},onClick:()=>this.props.onBackClick(1),children:(0,y.jsx)(i.Icon,{root:"common",name:"caret-left",className:"caretLeft"})}),(0,y.jsx)("div",{className:"section pl-1 mt-sm-2 mt-lg-0",style:{width:"50%"},children:(0,y.jsx)("span",{children:t("tpi_Dashboard")+" - "+this.props.selectedTerminal.TerminalCode})}),(0,y.jsx)("div",{className:"pr-3",style:{marginLeft:"auto"},children:(0,y.jsxs)("div",{className:"row",children:[this.getDateControl(),(0,y.jsx)("div",{className:"col-sm-12 "+(this.state.exportLoading?"col-lg-4":"col-lg-3")+" pl-3 pb-0 pt-sm-3 pt-lg-0",style:{textAlign:"right"},children:(0,y.jsxs)(i.Button,{type:"primary",disabled:this.state.exportLoading,className:"dashboardExport",onClick:()=>{this.dashboardRef.current&&this.setState({exportLoading:!0},(()=>{this.dashboardRef.current.exportAllCharts()}))},actionType:"button",children:[t("WijmoGridExport"),this.state.exportLoading?(0,y.jsx)("span",{className:"pl-1",children:(0,y.jsx)(i.Icon,{name:"redo",size:"small",loading:!0})}):null]})})]})})]}),(0,y.jsx)("div",{className:"dashboard detailsContainer",style:{paddingTop:"0px"},children:(0,y.jsxs)("div",{className:" ui pointing secondary ui scuf-tab menu ",style:{minHeight:"0px",marginBottom:"20px"},children:[this.BindTransportationTypes(),(0,y.jsxs)("div",{className:"mt-2 pr-3",style:{marginLeft:"auto",fontSize:"14px"},children:[t("LastUpdatedTime"),": ",(new Date).toLocaleTimeString()]})]})})]}),(0,y.jsx)(u.A,{children:this.state.kpis[this.state.selectedMOT]?(0,y.jsx)(c.A,{ref:this.dashboardRef,kpiList:this.state.kpis[this.state.selectedMOT],fetchData:this.getChildKpiData,fullScreenHandler:this.fullScreenView,isDraggable:!0,isResizable:!0,rowHeight:125,widgetHeight:2,exportCallback:()=>this.setState({exportLoading:!1}),pageName:"Dashboard"}):(0,y.jsx)(f.A,{loadingClass:"nestedList",message:""})})]})})})}}const b=(0,o.Ng)((t=>({userDetails:t.getUserDetails.userDetails,tokenDetails:t.getUserDetails.TokenAuth})))(v)},35861:(t,e,s)=>{s.d(e,{F1:()=>a,i7:()=>l,r4:()=>o});var r=s(86178),i=s.n(r),n=(s(15660),s(65043),s(70579));function o(t,e){if(Array.isArray(t)){0===t.filter((t=>t.text===e)).length&&t.unshift({value:null,text:e})}return t}function a(){let t=window.navigator.userLanguage||window.navigator.language;return i().locale(t),i().localeData().longDateFormat("L")}function l(t){return(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{children:t}),(0,n.jsx)("div",{class:"ui red circular empty label badge  circle-padding"})]})}},6890:(t,e,s)=>{s.d(e,{x:()=>o});var r=s(728),i=s(65043),n=function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function r(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(r.prototype=s.prototype,new r)}}(),o=function(t){function e(s,n,o){var a=t.call(this,s)||this;a._objPropHash={},a._isMounted=!1,a._mountedCBs=[],a._hostRef=function(t){return a._hostRefValue=t},a._beforeRender=new r.Event,a._afterRender=new r.Event,a._beforeWillUnmount=new r.Event,a._afterWillUnmount=new r.Event,a._beforeDidUpdate=new r.Event,a._afterDidUpdate=new r.Event,e._reactMajorVersion||(e._reactMajorVersion=parseInt(i.version)),a.props=s,a.controlType=n;for(var l=0,h=o&&o.objectProps||[];l<h.length;l++){var p=h[l];a._objPropHash[p]=!0}return a}return n(e,t),e.prototype.render=function(){this._onBeforeRender();var t=this._renderImpl();return this._onAfterRender(),t},e.prototype.componentDidMount=function(){var t=this;if(this._isChild()){var s=this.props[e._propsParent];s&&s._mountedCB((function(){t._setParent(s)}))}else this._prepareControl();return this.control},e.prototype.componentWillUnmount=function(){this._onBeforeWillUnmount(),this._siblingInsertedEH&&this._getElement().removeEventListener("DOMNodeInserted",this._siblingInsertedEH);var t=this.control;if(t)if(this._isChild()){var e=this._getParentProp();if(e){var s=this.parent.control[e];if((0,r.isArray)(s)){var i=s.indexOf(t);i>-1&&s.splice(i,1)}}}else t instanceof r.Control&&setTimeout((function(){t.hostElement&&(t._orgOuter=null,t.dispose())}));this._onAfterWillUnmount()},e.prototype.shouldComponentUpdate=function(t){return!0},e.prototype.componentDidUpdate=function(t){this._onBeforeDidUpdate();var e=this.control;this._copy(e,this.props,t),this._onAfterDidUpdate()},e.prototype._mountedCB=function(t){this._isMounted?t():this._mountedCBs.push(t)},e.prototype._renderImpl=function(){var t={};t[e._propsParent]=this;var s=i.Children.map(this.props.children,(function(e){return e&&i.cloneElement(e,t)})),r={ref:this._hostRef};return this._isChild()&&(r.style={display:"none"}),i.createElement("div",r,s)},e.prototype._onBeforeRender=function(t){this._beforeRender.raise(this,t)},e.prototype._onAfterRender=function(t){this._afterRender.raise(this,t)},e.prototype._onBeforeWillUnmount=function(t){this._beforeWillUnmount.raise(this,t)},e.prototype._onAfterWillUnmount=function(t){this._afterWillUnmount.raise(this,t)},e.prototype._onBeforeDidUpdate=function(t){this._beforeDidUpdate.raise(this,t)},e.prototype._onAfterDidUpdate=function(t){this._afterDidUpdate.raise(this,t)},e.prototype._createControl=function(){var t=this._isChild()?this._isParentInCtor()?this.parent.control:void 0:this._getElement();return new this.controlType(t)},e.prototype._prepareControl=function(){var t=this._getElement(),s=this.props;t&&!this._isChild()&&e._copyAttrs(t,s,r.Control._rxInputAtts);var i=this.control=this._createControl(),n=i instanceof r.Control,o=e;this._siblingId||(null==this.constructor[o._typeSiblingIdProp]&&(this.constructor[o._typeSiblingIdProp]=++o._siblingDirId+""),this._siblingId=this.constructor[o._typeSiblingIdProp]),t.setAttribute(o._typeSiblingIdProp,this._siblingId);var a={};for(var l in s){var h=s[l];this._ignoreProp(l)||(0,r.isUndefined)(h)||(l in i?a[l]=h:this._setHostAttribute(t,l,h))}n?i.initialize(a):this._copy(i,a,null,!0),this._isMounted=!0;var p=this._mountedCBs;this._mountedCBs=[];for(var d=0,c=p;d<c.length;d++)(0,c[d])();(0,r.isFunction)(s.initialized)&&s.initialized(i)},e.prototype._initParent=function(){var t=this._getParentProp();if(t){var e=this.parent.control,s=e[t];if((0,r.isArray)(s)){var i=this._getSiblingIndex();(i<0||i>=s.length)&&(i=s.length),s.splice(i,0,this.control),this._siblingInsertedEH=this._siblingInserted.bind(this),this._getElement().addEventListener("DOMNodeInserted",this._siblingInsertedEH)}else e[t]=this.control}},e.prototype._setParent=function(t){if(t!==this.parent){if(this.parent)throw"Wijmo child component is already attached to a different parent.";this.parent=t,this._prepareControl(),this._initParent()}},e.prototype._isChild=function(){return null!=this._parentProp||null!=this._parentInCtor},e.prototype._isParentInCtor=function(){return!0===this._parentInCtor},e.prototype._getParentProp=function(){return this.props.wjProperty||this._parentProp},e.prototype._getSiblingIndex=function(){var t=this._getElement(),s=t.parentElement;if(!s)return-1;for(var r=s.childNodes,i=-1,n=this._siblingId,o=0;o<r.length;o++){var a=r[o];if(1==a.nodeType&&a.getAttribute(e._typeSiblingIdProp)==n&&(++i,a===t))return i}return-1},e.prototype._siblingInserted=function(t){if(t.target===this._getElement()){var e=this._getSiblingIndex(),s=this.control,r=this.parent.control[this._getParentProp()],i=r.indexOf(s);e>=0&&i>=0&&e!==i&&(r.splice(i,1),e=Math.min(e,r.length),r.splice(e,0,s))}},e.prototype._copy=function(t,e,s,i){if(void 0===i&&(i=!1),t&&e){var n,o=t===this.control;for(var a in e)if(!this._ignoreProp(a)||!o){var l=e[a];if(a in t){if(this._isEvent(t,a))i&&(0,r.isFunction)(l)&&t[a].addHandler(l);else if(!s||!this._sameValue(s[a],l))if(null==l)t[a]=l;else if((0,r.isPrimitive)(l)||(0,r.isFunction)(l)||this._objPropHash[a]&&t===(n||(n=this.control)))t[a]=l;else if((0,r.isArray)(l)&&(0,r.isArray)(t[a])){var h=t[a],p=l;if(p.length==h.length)for(var d=0;d<p.length;d++)this._copy(h[d],p[d])}else(0,r.isObject)(l)&&this._copy(t[a],e[a])}else this._setHostAttribute(t.hostElement,a,e[a])}}},e.prototype._setHostAttribute=function(t,e,s){if(t)switch(e){case"className":var i=this._appliedClassName;i!==s&&((0,r.removeClass)(t,i),(0,r.addClass)(t,s),this._appliedClassName=s);break;case"style":(0,r.setCss)(t,s);break;default:null!=t[e]?t[e]=s:"string"==typeof s&&"$"!==e[0]&&t.setAttribute(e,s)}},e.prototype._sameValue=function(t,e){return t==e||r.DateTime.equals(t,e)},e.prototype._isEvent=function(t,e){var s=t&&t[e];return null!=s&&s instanceof r.Event},e.prototype._getElement=function(){return this._hostRefValue},e.prototype._ignoreProp=function(t){return"children"===t},e._copyAttrs=function(t,e,s){if(t)for(var r in e)r.match(s)&&t.setAttribute(r,e[r])},e.isInStrictMode=function(t){return!!(t.hasOwnProperty("_reactInternalFiber")&&1&t._reactInternalFiber.mode)},e._propsParent="$parent",e._typeSiblingIdProp="_wjSiblingIdProp",e._siblingDirId=0,e}(i.Component)},43024:(t,e,s)=>{function r(t){var e,s,i="";if("string"==typeof t||"number"==typeof t)i+=t;else if("object"==typeof t)if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(s=r(t[e]))&&(i&&(i+=" "),i+=s);else for(e in t)t[e]&&(i&&(i+=" "),i+=e);return i}function i(){for(var t,e,s=0,i="";s<arguments.length;)(t=arguments[s++])&&(e=r(t))&&(i&&(i+=" "),i+=e);return i}s.r(e),s.d(e,{clsx:()=>i,default:()=>n});const n=i},60663:()=>{}}]);
//# sourceMappingURL=6590.d1adc77d.chunk.js.map