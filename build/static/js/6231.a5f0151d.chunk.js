"use strict";(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[6231],{16231:(e,t,s)=>{s.r(t),s.d(t,{default:()=>R});var o=s(65043),i=s(46100),a=s(72711),c=s(67907),n=s(78374),l=s(70579);function d(e){let{location:t,modLocation:s,modAvailableDevices:o,modAssociatedDevices:i,selectedLocationType:d,validationErrors:r,checkBoxChanged:h,onFieldChange:p,handleCellDataEdit:u,onActiveStatusChange:v}=e;const[D]=(0,c.useTranslation)(),m=e=>(0,l.jsx)(a.Input,{fluid:!0,value:i[e.rowIndex][e.field],onChange:t=>u(t,e),reserveSpace:!1});return(0,l.jsxs)("div",{className:"detailsContainer",children:[(0,l.jsxs)("div",{className:"row",children:[(0,l.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,l.jsx)(a.Input,{fluid:!0,value:s.LocationCode,label:D(d+"Code"),indicator:"required",disabled:""!==t.LocationCode,onChange:e=>p("LocationCode",e),error:D(r.LocationCode),reserveSpace:!1})}),(0,l.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,l.jsx)(a.Input,{fluid:!0,value:s.LocationName,label:D(d+"Name"),indicator:"required",onChange:e=>p("LocationName",e),error:D(r.LocationName),reserveSpace:!1})}),(0,l.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,l.jsx)(a.Input,{fluid:!0,value:d,disabled:"true",label:D("LocationType"),onChange:e=>p("LocationType",e),reserveSpace:!1})}),(0,l.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,l.jsx)(a.Input,{fluid:!0,value:null===s.Description?"":s.Description,label:D("FinishedProductList_Description"),onChange:e=>p("Description",e),error:D(r.Description),reserveSpace:!1})}),(0,l.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,l.jsx)(a.Select,{fluid:!0,placeholder:D("FinishedProductInfo_Select"),label:D("Cust_Status"),value:s.Active,options:[{text:D("ViewShipment_Ok"),value:!0},{text:D("ViewShipmentStatus_Inactive"),value:!1}],onChange:e=>v(e)})}),(0,l.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,l.jsx)(a.Input,{fluid:!0,value:null===s.Remarks?"":s.Remarks,label:D("Cust_Remarks"),onChange:e=>p("Remarks",e),indicator:s.Active!==t.Active?"required":"",error:D(r.Remarks),reserveSpace:!1})})]}),(0,l.jsxs)("div",{className:"row",children:[(0,l.jsxs)("div",{className:"col-3 pr-1 pb-0",children:[(0,l.jsx)("h5",{children:D("Loc_AvailableDevices")}),(0,l.jsx)(a.Accordion,{children:o.map((e=>(0,l.jsx)(a.Accordion.Content,{title:e.DeviceType,arrowPosition:"left",children:e.DeviceList.map((t=>(0,l.jsx)("div",{children:(0,l.jsx)(a.Checkbox,{label:t.DeviceCode,checked:t.IsAssociated,onChange:s=>h(t.DeviceCode,e.DeviceType,s)})})))})))})]}),(0,l.jsxs)("div",{className:"col-9 pb-0",children:[(0,l.jsx)("h5",{children:D("Loc_AssociatedDevices")}),(0,l.jsxs)(n.bQ,{data:i,children:[(0,l.jsx)(n.bQ.Column,{className:"compColHeight",field:"DeviceCode",header:D("Loc_DeviceCode"),editable:!0,sortable:!0,editFieldType:"text",customEditRenderer:m},"DeviceCode"),(0,l.jsx)(n.bQ.Column,{className:"compColHeight",field:"DeviceType",header:D("Loc_DeviceType"),editable:!0,sortable:!0,editFieldType:"text",customEditRenderer:m},"DeviceType"),(0,l.jsx)(n.bQ.Column,{className:"compColHeight",field:"DeviceModel",header:D("Loc_DeviceModel"),editable:!0,sortable:!0,editFieldType:"text",customEditRenderer:m},"DeviceModel")]})]})]})]})}var r=s(80432),h=s(40854),p=s.n(h),u=s(97508),v=s(53536),D=s.n(v),m=s(69062),L=s(93779),y=s(72067),C=s(7523),g=s(65187),A=s(40252),E=s(43503),S=s(44192),k=s(80312),b=s(62900);class T extends o.Component{constructor(){super(...arguments),this.state={location:{},modLocation:{},modAssociatedDevices:[],modAvailableDevices:[],isReadyToRender:!1,saveEnabled:!1,isDeleteEnabled:!1,selectedLocationType:"",checkedDevices:[],validationErrors:m.Th(S.OA),showDeleteAuthenticationLayout:!1,showSaveAuthenticationLayout:!1,tempLocation:{}},this.handleCellDataEdit=(e,t)=>{try{let s=D().cloneDeep(this.state.modAssociatedDevices);s[t.rowIndex][t.field]=e,this.setState({modAssociatedDevices:s})}catch(s){console.log("LocationDetailsComposite:Error occured on handleCellDataEdit",s)}},this.saveLocation=()=>{try{this.setState({saveEnabled:!1});let e=D().cloneDeep(this.state.tempLocation);""===this.state.location.LocationCode?this.createLocation(e):this.updateLocation(e)}catch(e){console.log("LocationComposite : Error in saveLocation")}},this.handleSave=()=>{try{let e=this.fillDetails();if(this.validateSave(e)){let t=!0!==this.props.userDetails.EntityResult.IsWebPortalUser,s=D().cloneDeep(e);this.setState({showSaveAuthenticationLayout:t,tempLocation:s},(()=>{!1===t&&this.saveLocation()}))}else this.setState({saveEnabled:!0})}catch(e){console.log("LocationDetailsComposite:Error occured on handleSave",e)}},this.handleChange=(e,t)=>{try{let s=D().cloneDeep(this.state.modLocation);s[e]=t;const o={...this.state.validationErrors};s.Active===this.state.location.Active&&(this.state.location.Remarks!==s.Remarks&&""!==s.Remarks||(o.Remarks=""),""===s.Remarks&&(s.Remarks=this.state.location.Remarks)),"Active"===e&&s.Active!==this.state.location.Active&&(s.Remarks=""),void 0!==S.OA[e]&&(o[e]=m.jr(S.OA[e],t)),this.setState({validationErrors:o,modLocation:s})}catch(s){console.log("LocationDetailsComposite:Error occured on handleChange",s)}},this.handleCheckboxChanged=(e,t,s)=>{try{let a=D().cloneDeep(this.state.modAvailableDevices);var o=a.findIndex((e=>e.DeviceType===t));if(void 0!==o)var i=a[o].DeviceList.findIndex((t=>t.DeviceCode===e));void 0!==i&&(a[o].DeviceList[i].IsAssociated=s),this.setState({modAvailableDevices:a});let c={DeviceType:t,DeviceCode:e,DeviceModel:null},n=D().cloneDeep(this.state.checkedDevices);!0===s&&0===n.filter((t=>t.DeviceCode===e)).length?(n.push(c),this.setState({checkedDevices:n})):!1===s&&this.state.checkedDevices.filter((t=>t.DeviceCode===e)).length>0&&(n=n.filter((t=>t.DeviceCode!==e)),this.setState({checkedDevices:n}))}catch(a){console.log("LocationDetailsComposite:Error occured on handleCheckboxChanged",a)}},this.handleDelete=()=>{try{var e=[],t=this.state.modLocation.LocationCode,s={keyDataCode:0,ShareHolderCode:"",KeyCodes:[{Key:L.$A,Value:t},{Key:L.uw,Value:this.props.selectedTerminal},{Key:L.c4,Value:this.props.locationtype}]};e.push(s),p()(y.$Xc,m.tW(e,this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data,s=t.IsSuccess;null!==t.ResultDataList&&void 0!==t.ResultDataList&&(s=t.ResultDataList.filter((function(e){return!e.IsSuccess})).length!==t.ResultDataList.length);var o=m.Cy(t,[this.state.selectedLocationType+"DeletionStatus"],["LocationCode"]);s?(this.getLocation({selectedlocation:this.state.modLocation.LocationCode,locationtype:this.props.locationtype,isClone:!0}),this.setState({isDeleteEnabled:!1,showDeleteAuthenticationLayout:!1})):this.setState({isDeleteEnabled:!0,showDeleteAuthenticationLayout:!1}),o.messageResultDetails.forEach((e=>{e.keyFields.length>0&&(e.keyFields[0]=[this.state.selectedLocationType+"Code"])})),this.props.onDelete(this.state.modLocation,"delete",o)}))}catch(o){console.log("LocationDetailsComposite:Error occured on handleDelete",o)}},this.handleActiveStatusChange=e=>{try{let t=D().cloneDeep(this.state.modLocation);t.Active=e,t.Active!==this.state.location.Active&&(t.Remarks=""),this.setState({modLocation:t})}catch(t){console.log("LocationDetailsComposite:Error occured on handleActiveStatusChange",t)}},this.authenticateDelete=()=>{try{let e=!0!==this.props.userDetails.EntityResult.IsWebPortalUser;this.setState({showDeleteAuthenticationLayout:e}),!1===e&&this.handleDelete()}catch(e){console.log("LocationComposite : Error in authenticateDelete")}},this.handleAuthenticationClose=()=>{this.setState({showSaveAuthenticationLayout:!1,showDeleteAuthenticationLayout:!1})}}componentDidMount(){try{m.pJ(this.props.userDetails.EntityResult.IsArchived),this.getDeviceList(this.props)}catch(e){console.log("LocationDetailsComposite:Error occured on componentDidMount",e)}}componentWillReceiveProps(e){try{if(void 0===e.LocationCode&&this.props.tokenDetails.tokenInfo===e.tokenDetails.tokenInfo){this.getDeviceList(e);let t={...this.state.validationErrors};Object.keys(t).forEach((e=>{t[e]=""})),this.setState({validationErrors:t})}}catch(t){console.log("LocationDetailsComposite:Error occured on componentWillReceiveProps",t)}}fillDetails(){try{let e=D().cloneDeep(this.state.modLocation),t=D().cloneDeep(this.state.checkedDevices);return t.forEach((e=>{e.TerminalCode=this.props.selectedTerminal})),e.LocationType=this.state.selectedLocationType,e.TerminalCode=this.props.selectedTerminal,e.AssociatedDevices=t,e}catch(e){console.log("LocationDetailsComposite:Error occured on filldetails",e)}}createLocation(e){try{let t=[{key:L.$A,value:e.LocationCode}],s={LocationInfo:e,BayInfo:null,isBayRequest:!1},o={ShareHolderCode:"",keyDataCode:L.$A,KeyCodes:t,Entity:s},i={messageType:"critical",message:[this.state.selectedLocationType+"SavedSuccess"],messageResultDetails:[{keyFields:[this.state.selectedLocationType+"Code"],keyValues:[e.LocationCode],isSuccess:!1,errorMessage:""}]};p()(y.Kbi,m.tW(o,this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;i.messageType=t.IsSuccess?"success":"critical",i.messageResultDetails[0].isSuccess=t.IsSuccess,!0===t.IsSuccess?(this.setState({saveEnabled:m.ab(this.props.userDetails.EntityResult.FunctionsList,k.i.add,m.k5(this.props.transportationtype)),showSaveAuthenticationLayout:!1}),this.getLocation({selectedlocation:this.state.modLocation.LocationCode,locationtype:this.props.locationtype,selectedTerminal:this.props.selectedTerminal,isClone:!1})):(i.messageResultDetails[0].errorMessage=t.ErrorList[0],this.setState({saveEnabled:m.ab(this.props.userDetails.EntityResult.FunctionsList,k.i.add,m.k5(this.props.transportationtype)),showSaveAuthenticationLayout:!1})),this.props.onSaved(this.state.modLocation,"add",i)}))}catch(t){console.log("LocationDetailsComposite:Error occured on createLocation",t)}}updateLocation(e){try{let t=[{key:L.$A,value:e.LocationCode}],s={LocationInfo:e,BayInfo:null,isBayRequest:!1},o={ShareHolderCode:"",keyDataCode:L.$A,KeyCodes:t,Entity:s},i={messageType:"critical",message:[this.state.selectedLocationType+"SavedSuccess"],messageResultDetails:[{keyFields:[this.state.selectedLocationType+"Code"],keyValues:[e.LocationCode],isSuccess:!1,errorMessage:""}]};p()(y.Xe1,m.tW(o,this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;i.messageType=t.IsSuccess?"success":"critical",i.messageResultDetails[0].isSuccess=t.IsSuccess,!0===t.IsSuccess?(this.setState({saveEnabled:m.ab(this.props.userDetails.EntityResult.FunctionsList,k.i.modify,m.k5(this.props.transportationtype)),showSaveAuthenticationLayout:!1}),this.getLocation({selectedlocation:this.state.modLocation.LocationCode,locationtype:this.props.locationtype,selectedTerminal:this.props.selectedTerminal,isClone:!1})):(i.messageResultDetails[0].errorMessage=t.ErrorList[0],this.setState({saveEnabled:m.ab(this.props.userDetails.EntityResult.FunctionsList,k.i.modify,m.k5(this.props.transportationtype)),showSaveAuthenticationLayout:!1})),this.props.onSaved(this.state.modLocation,"update",i)}))}catch(t){console.log("LocationDetailsComposite:Error occured on updateLocation",t)}}validateSave(e){const t={...this.state.validationErrors};Object.keys(S.OA).forEach((function(s){void 0!==e[s]&&(t[s]=m.jr(S.OA[s],e[s]))})),e.Active!==this.state.location.Active&&(null!==e.Remarks&&""!==e.Remarks||(t.Remarks="OriginTerminal_RemarksRequired"));let s={messageType:"critical",message:[this.state.selectedLocationType+"SavedSuccess"],messageResultDetails:[]};0===e.AssociatedDevices.length&&s.messageResultDetails.push({keyFields:[this.state.selectedLocationType+"Code"],keyValues:[e.LocationCode],isSuccess:!1,errorMessage:"LocationInfo_DeviceRequired"}),this.setState({validationErrors:t});var o=Object.values(t).every((function(e){return""===e}));return s.messageResultDetails.length>0?(this.props.onSaved(this.state.modLocation,"update",s),!1):o}getDeviceList(e){let t=e.locationtype;t=t.replace(/ /g,"");var s=this.props.selectedTerminal;try{p()(y.X3N+"?locationType="+t+"&locationInfo=&terminalCode="+s,m.Jm(this.props.tokenDetails.tokenInfo)).then((t=>{let s=t.data;!0===s.IsSuccess&&Array.isArray(s.EntityResult)&&s.EntityResult.length>0?this.setState({modAvailableDevices:s.EntityResult},(()=>{this.getLocation(e)})):this.getLocation(e)}))}catch(o){console.log("LocationDetailsComposite:Error occured on getDeviceList",o)}}getLocation(e){try{let o=e.selectedlocation,a=this.props.selectedTerminal;if(i.F4.LocationType=e.locationtype.replace(/ /g,""),i.F4.AvailableDevices=D().cloneDeep(this.state.modAvailableDevices),void 0===o||""===o)return void this.setState({location:D().cloneDeep(i.F4),modLocation:D().cloneDeep(i.F4),selectedLocationType:i.F4.LocationType,modAssociatedDevices:[],modAvailableDevices:D().cloneDeep(i.F4.AvailableDevices),checkedDevices:[],isDeleteEnabled:!1,isReadyToRender:!0,saveEnabled:m.ab(this.props.userDetails.EntityResult.FunctionsList,k.i.add,m.k5(this.props.transportationtype))});var t=[{key:L.$A,value:o},{key:L.uw,value:a},{key:L.c4,value:this.props.locationtype}],s={ShareHolderCode:"",keyDataCode:L.$A,KeyCodes:t};p()(y.Q8r,m.tW(s,this.props.tokenDetails.tokenInfo)).then((t=>{var s=t.data;if(!0===s.IsSuccess){if(!0===e.isClone)return void this.setState({selectedLocationType:D().cloneDeep(s.EntityResult.LocationType),location:D().cloneDeep(i.F4),modLocation:D().cloneDeep(i.F4),isReadyToRender:!0,modAssociatedDevices:[],modAvailableDevices:D().cloneDeep(this.state.modAvailableDevices),checkedDevices:[],saveEnabled:m.ab(this.props.userDetails.EntityResult.FunctionsList,k.i.add,m.k5(this.props.transportationtype)),isDeleteEnabled:!1});{let e=D().cloneDeep(s.EntityResult.AssociatedDevices);Array.isArray(e)&&e.forEach((e=>{e.DeviceType=(0,m.cd)(C.k6,e.DeviceType)})),this.setState({selectedLocationType:D().cloneDeep(s.EntityResult.LocationType),isReadyToRender:!0,location:s.EntityResult,modLocation:D().cloneDeep(s.EntityResult),modAssociatedDevices:e,checkedDevices:D().cloneDeep(s.EntityResult.AssociatedDevices),modAvailableDevices:D().cloneDeep(s.EntityResult.AvailableDevices),isDeleteEnabled:m.ab(this.props.userDetails.EntityResult.FunctionsList,k.i.remove,m.k5(this.props.transportationtype)),saveEnabled:m.ab(this.props.userDetails.EntityResult.FunctionsList,k.i.modify,m.k5(this.props.transportationtype))})}}else this.setState({selectedLocationType:i.F4.LocationType,location:D().cloneDeep(i.F4),modLocation:D().cloneDeep(i.F4),isReadyToRender:!0,modAssociatedDevices:[],modAvailableDevices:[],checkedDevices:[],isDeleteEnabled:!1})}))}catch(o){console.log("LocationDetailsComposite:Error occured on getTerminalsList",o)}}handleOperation(){return this.state.showDeleteAuthenticationLayout?this.handleDelete:this.saveLocation}getFunctionName(){return this.state.showDeleteAuthenticationLayout?k.i.remove:""===this.state.location.LocationCode?k.i.add:k.i.modify}render(){const e=[{fieldName:"DriverInfo_LastUpdated",fieldValue:new Date(this.state.modLocation.LastUpdatedTime).toLocaleDateString()+" "+new Date(this.state.modLocation.LastUpdatedTime).toLocaleTimeString()},{fieldName:"DriverInfo_LastActive",fieldValue:void 0!==this.state.modLocation.LastActiveTime&&null!==this.state.modLocation.LastActiveTime?new Date(this.state.modLocation.LastActiveTime).toLocaleDateString()+" "+new Date(this.state.modLocation.LastActiveTime).toLocaleTimeString():""},{fieldName:"DriverInfo_CreatedTime",fieldValue:new Date(this.state.modLocation.CreatedTime).toLocaleDateString()+" "+new Date(this.state.modLocation.CreatedTime).toLocaleTimeString()}];return this.state.isReadyToRender?(0,l.jsxs)("div",{children:[(0,l.jsx)(g.A,{children:(0,l.jsx)(E.A,{entityCode:this.state.location.LocationCode,newEntityName:"New"+this.state.selectedLocationType,popUpContents:e})}),(0,l.jsx)(g.A,{children:(0,l.jsx)(d,{location:this.state.location,modLocation:this.state.modLocation,selectedLocationType:this.state.selectedLocationType,modAvailableDevices:this.state.modAvailableDevices,modAssociatedDevices:this.state.modAssociatedDevices,validationErrors:this.state.validationErrors,onFieldChange:this.handleChange,checkBoxChanged:this.handleCheckboxChanged,handleCellDataEdit:this.handleCellDataEdit,onActiveStatusChange:this.handleActiveStatusChange})}),(0,l.jsx)(g.A,{children:(0,l.jsx)(r.E,{isEnterpriseNode:this.props.userDetails.EntityResult.IsEnterpriseNode,handleSave:this.handleSave,handleDelete:this.authenticateDelete,saveEnabled:this.state.saveEnabled,isDeleteEnabled:this.state.isDeleteEnabled})}),this.state.showDeleteAuthenticationLayout||this.state.showSaveAuthenticationLayout?(0,l.jsx)(b.A,{Username:this.props.userDetails.EntityResult.UserName,functionName:this.getFunctionName(),functionGroup:k.Ug,handleClose:this.handleAuthenticationClose,handleOperation:this.handleOperation()}):null]}):(0,l.jsx)(A.A,{message:"Loading"})}}const R=(0,u.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})))(T)}}]);
//# sourceMappingURL=6231.a5f0151d.chunk.js.map