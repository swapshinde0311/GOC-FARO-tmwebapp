"use strict";(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[9329,5841,8222],{89329:(e,t,a)=>{a.r(t),a.d(t,{default:()=>j});var s=a(65043),r=a(72711),i=a(7523),o=a(67907),l=a(65187),n=a(73571),c=a(72067),d=a(40854),m=a.n(d),h=a(11981),p=a(14159),u=(a(92342),a(97508)),g=a(69062),v=a(53536),f=a.n(v),N=a(35861),x=a(40252),P=(a(38726),a(86178)),R=a.n(P),y=a(70579);class D extends s.Component{constructor(){super(...arguments),this.state={showReport:!1,reportList:[],showReportParams:!1,parameters:[],paramValues:{},paramOptions:{},disabledParams:{},listLoading:!0,parameterLoading:!1},this.validateParams=e=>{let t={...this.state.validationErrors},a=this.validationDef;return Object.keys(a).forEach((function(s){void 0!==e[s]&&(t[s]=g.jr(a[s],e[s]))})),this.setState({validationErrors:t}),Object.values(t).every((function(e){return""===e}))},this.handleShowReportClick=()=>{try{Object.values(this.state.validationErrors).every((function(e){return""===e}))&&this.validateParams(this.state.paramValues)&&this.setState({showReport:!0})}catch(e){console.log("ReportsComposite: Error occured onhandleShowReportClick",e)}},this.buildBreadcrumb=()=>(0,y.jsx)(o.TranslationConsumer,{children:e=>(0,y.jsxs)(r.Breadcrumb,{children:[this.props.activeItem.parents.map((t=>(0,y.jsx)(r.Breadcrumb.Item,{children:e(t.localizedKey)},t.itemCode))),(0,y.jsx)(r.Breadcrumb.Item,{children:e(this.props.activeItem.localizedKey)},this.props.activeItem.itemCode)]})}),this.handleReportClick=e=>{this.setState({parameterLoading:!0}),m()(c.B7e+"?ReportName="+e,g.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{if(e.data.IsSuccess){let t=e.data.EntityResult.Parameters;this.paramTables=e.data.EntityResult.ReportsData;let a=f().cloneDeep(this.state.paramOptions),s=f().cloneDeep(this.state.disabledParams),r={Culture:this.props.userDetails.EntityResult.UICulture};this.validationDef={},this.reportName=e.data.EntityResult.ReportName,void 0!==e.data.EntityResult.UserName&&""!==e.data.EntityResult.UserName&&null!==e.data.EntityResult.UserName&&(r.UserName=e.data.EntityResult.UserName);for(let e=0;e<t.length;++e)if("DropDownList"===t[e].ControlType)if(this.validationDef[t[e].ParamName]=[],!0===t[e].Required&&this.validationDef[t[e].ParamName].push({minLength:1,errorCode:"Select_Value"}),null===t[e].DependentControls||0===t[e].DependentControls.length){let i=t[e].TableName,o=t[e].FieldName,l=this.paramTables[i],n=new Set(l.map((e=>e[o])));n=[...n];let c=g.Zj(n);r[t[e].ParamName]=null,t[e].IsOnlyForEnterprise||t[e].Required||(c.unshift({text:"All",value:0}),r[t[e].ParamName]=0),a[t[e].ParamName]=c,s[t[e].ParamName]=!1}else if(t[e].IsOnlyForEnterprise||t[e].Required)if(t[e].Required){let i=[{text:"Select",value:""}];a[t[e].ParamName]=i,s[t[e].ParamName]=!0,r[t[e].ParamName]=""}else r[t[e].ParamName]=0;else{let i=[{text:"All",value:0}];a[t[e].ParamName]=i,s[t[e].ParamName]=!0,r[t[e].ParamName]=0}else if("DateTime"===t[e].ControlType||"Date"===t[e].ControlType){if(!0===t[e].Required){let a=[{minLength:1,errorCode:"Select_Date"},{isDate:!0,errorCode:"Valid_Date"}];this.validationDef[t[e].ParamName]=a}if(this.props.userDetails.EntityResult.IsWebPortalUser){let a=this.props.userDetails.EntityResult.TimeZoneOffset+(new Date).getTimezoneOffset();r[t[e].ParamName]=R()(new Date).add(a,"m").toDate()}else r[t[e].ParamName]=new Date}else if("Text"===t[e].ControlType){if(!0===t[e].Required){let a=[{minLength:1,errorCode:"Mandatory_Field"},{expression:"^[0-9a-zA-Z-_]+$",errorCode:"Code_ValidInputCharacters"}];this.validationDef[t[e].ParamName]=a}r[t[e].ParamName]=null}this.setState({parameters:[...e.data.EntityResult.Parameters],paramOptions:a,disabledParams:s,paramValues:r,showReportParams:!0,validationErrors:g.Th(this.validationDef),parameterLoading:!1})}else console.log("Get Report Params error:",e.data.ErrorList),this.setState({parameterLoading:!1,showReportParams:!1})})).catch((e=>{console.log("Error occured on handleReportClick",e),this.setState({parameterLoading:!1,showReportParams:!1})}))},this.handleBack=()=>{this.setState({showReport:!1})},this.onDropDownChange=(e,t)=>{let a=f().cloneDeep(this.state.paramValues),s=f().cloneDeep(this.state.disabledParams),r=f().cloneDeep(this.state.paramOptions),i=f().cloneDeep(this.state.validationErrors);if(void 0!==e&&null!==e){a[t.ParamName]=e,void 0!==this.validationDef[t.ParamName]&&(i[t.ParamName]=g.jr(this.validationDef[t.ParamName],e));let o=t.RefreshControls;for(let e=0;e<o.length;++e){s[o[e]]=!1;let t=this.state.parameters.find((t=>{let{ParamName:a}=t;return a===o[e]})),i=this.paramTables[t.TableName],l=t.DependentControls;for(let e=0;e<l.length;++e){let t=this.state.parameters.find((t=>{let{ParamName:a}=t;return a===l[e]}));0!==a[l[e]]&&(i=i.filter((s=>s[t.FieldName]===a[l[e]])))}let n=new Set(i.map((e=>e[t.FieldName])));n=[...n];let c=g.Zj(n);t.Required||t.IsOnlyForEnterprise?t.Required?(c.unshift({text:"Select",value:""}),a[t.ParamName]=""):a[t.ParamName]=0:c.unshift({text:"All",value:0}),r[t.ParamName]=c}}this.setState({paramValues:a,disabledParams:s,paramOptions:r,validationErrors:i})},this.onFieldChange=(e,t)=>{let a=f().cloneDeep(this.state.paramValues),s=f().cloneDeep(this.state.validationErrors);a[e]=t,void 0!==this.validationDef[e]&&(s[e]=g.jr(this.validationDef[e],t)),this.setState({paramValues:a,validationErrors:s})},this.onDateTextChange=(e,t,a)=>{let s=f().cloneDeep(this.state.paramValues),r=f().cloneDeep(this.state.validationErrors);r[e]=a,s[e]=t,this.setState({paramValues:s,validationErrors:r})},this.buildReportParams=()=>this.state.parameters.map((e=>"DropDownList"===e.ControlType?(0,y.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,y.jsx)(o.TranslationConsumer,{children:t=>(0,y.jsx)(r.Select,{fluid:!0,placeholder:t("FinishedProductInfo_Select"),indicator:e.Required?"required":"",label:t(e.LocalisedParamName),value:void 0===this.state.paramValues[e.ParamName]?"":this.state.paramValues[e.ParamName],disabled:this.state.disabledParams[e.ParamName],options:void 0===this.state.paramOptions[e.ParamName]?[]:this.state.paramOptions[e.ParamName],onChange:t=>this.onDropDownChange(t,e),error:t(this.state.validationErrors[e.ParamName]),reserveSpace:!1})})}):"DateTime"===e.ControlType?(0,y.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,y.jsx)(o.TranslationConsumer,{children:t=>(0,y.jsx)(r.DatePicker,{fluid:!0,value:null===this.state.paramValues[e.ParamName]?"":new Date(this.state.paramValues[e.ParamName]),type:"datetime",displayFormat:(0,N.F1)(),label:t(e.LocalisedParamName),showYearSelector:"true",indicator:e.Required?"required":"",onChange:t=>this.onFieldChange(e.ParamName,t),onTextChange:(t,a)=>{this.onDateTextChange(e.ParamName,t,a)},error:t(this.state.validationErrors[e.ParamName]),reserveSpace:!1})})}):"Text"===e.ControlType?(0,y.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,y.jsx)(o.TranslationConsumer,{children:t=>(0,y.jsx)(r.Input,{fluid:!0,value:null===this.state.paramValues[e.ParamName]?"":this.state.paramValues[e.ParamName],onChange:t=>this.onFieldChange(e.ParamName,t),indicator:e.Required?"required":"",label:t(e.LocalisedParamName),error:t(this.state.validationErrors[e.ParamName]),reserveSpace:!1})})}):"Date"===e.ControlType?(0,y.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,y.jsx)(o.TranslationConsumer,{children:t=>(0,y.jsx)(r.DatePicker,{fluid:!0,value:null===this.state.paramValues[e.ParamName]?"":new Date(this.state.paramValues[e.ParamName]),displayFormat:(0,N.F1)(),label:t(e.LocalisedParamName),showYearSelector:"true",indicator:e.Required?"required":"",onChange:t=>this.onFieldChange(e.ParamName,t.toISOString()),onTextChange:(t,a)=>{this.onDateTextChange(e.ParamName,t,a)},error:t(this.state.validationErrors[e.ParamName]),reserveSpace:!1})})}):void 0)),this.getChangedReportParameters=()=>{let e=f().cloneDeep(this.state.paramValues);try{Object.keys(e).forEach((t=>{if(e[t]instanceof Date)if(this.props.userDetails.EntityResult.IsWebPortalUser){let a=this.props.userDetails.EntityResult.TimeZoneOffset+(new Date).getTimezoneOffset();e[t]=R()(R()(e[t]).utc().format()).subtract(a,"m").toISOString().replace("Z","")}else e[t]=e[t].toISOString().replace("Z","")}))}catch(t){console.log("error while getChangedReportParameters",t)}return e},this.handleReportPrintClick=()=>{try{if(Object.values(this.state.validationErrors).every((function(e){return""===e}))&&this.validateParams(this.state.paramValues)){let e=Object.keys(this.state.paramValues),t=[];for(let r=0;r<e.length;++r)t.push(e[r]),t.push(this.state.paramValues[e[r]]);let a={Entity:{ReportName:this.reportName,ReportParams:t}},s={messageType:"critical",message:"ReportPrintStatus",messageResultDetails:[{keyFields:[],keyValues:[],isSuccess:!1,errorMessage:""}]};m()(c.W1t,g.tW(a,this.props.tokenDetails.tokenInfo)).then((e=>{s.messageType=e.data.IsSuccess?"success":"critical",s.messageResultDetails[0].isSuccess=e.data.IsSuccess,e.data.IsSuccess||(s.messageResultDetails[0].errorMessage=e.data.ErrorList[0]),(0,p.toast)((0,y.jsx)(l.A,{children:(0,y.jsx)(h.A,{notificationMessage:s})}),{autoClose:"success"===s.messageType&&1e4})}))}}catch(e){console.log("ReportsComposite: Error occured onhandleReportPrintClick",e)}}}componentDidMount(){m()(c.tsU,g.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{if(e.data.IsSuccess){let t=e.data.EntityResult.ReportListCategories;m()(c.yTV,g.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{e.data.IsSuccess?(this.reportServiceURI=e.data.EntityResult,this.setState({reportList:t,listLoading:!1})):console.log("Error in fetching ReportServiceURI: ",e.data.ErrorList)})).catch((e=>{console.log("Error in fetching ReportServiceURI: ",e)}))}else console.log("Error in fetching ReportList: ",e.data.ErrorList)})).catch((e=>{console.log("Error in fetching ReportList: ",e)}))}renderModal(){let e=null;return e=this.props.userDetails.EntityResult.IsArchived?"TM/"+i.mD+"/"+this.reportName:"TM/"+i.PZ+"/"+this.reportName,(0,y.jsx)(n.A,{showReport:this.state.showReport,handleBack:this.handleBack,handleModalClose:this.handleBack,proxyServerHost:c._Oi,reportServiceHost:this.reportServiceURI,filePath:e,parameters:this.getChangedReportParameters()})}render(){return(0,y.jsxs)("div",{children:[" ",(0,y.jsx)(o.TranslationConsumer,{children:e=>(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"row",style:{marginTop:"10px"},children:(0,y.jsx)("div",{className:"col-12 col-sm-12 col-md-12 col-lg-5 col-xl-7",children:(0,y.jsxs)(l.A,{children:[" ",this.buildBreadcrumb()]})})}),this.state.parameterLoading?(0,y.jsx)("div",{className:"authLoading parameterLoader",children:(0,y.jsx)(r.Loader,{text:" ",className:"globalLoaderPositionPosition"})}):"",this.state.listLoading?(0,y.jsx)(x.A,{message:"Loading"}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"detailsContainer",children:(0,y.jsx)("div",{className:"row  reportTable",children:this.state.reportList.map((t=>{if(t.ReportListItems.Table.length>0)return(0,y.jsx)("div",{className:"col-12 col-md-6 col-lg-4 fixed-top",children:(0,y.jsxs)(r.Table,{children:[(0,y.jsx)(r.Table.Header,{children:(0,y.jsx)(r.Table.HeaderCell,{content:e(t.ReportCategory)})}),(0,y.jsx)(r.Table.Body,{children:t.ReportListItems.Table.map((t=>(0,y.jsx)(r.Table.Row,{children:(0,y.jsx)(r.Table.Cell,{onClick:()=>this.handleReportClick(t.ReportName),style:{cursor:"pointer",fontWeight:this.reportName===t.ReportName?"bold":"normal",borderLeft:this.reportName===t.ReportName?"5px solid #1274B7":""},children:e(t.ReportName)})})))})]})})}))})}),this.state.showReportParams?(0,y.jsxs)("div",{className:"detailsContainer",children:[(0,y.jsx)("div",{className:"row",children:(0,y.jsx)("div",{className:"col-12 col-md-12 col-lg-12",children:(0,y.jsxs)("h5",{children:[" ",e(this.reportName)]})})}),(0,y.jsx)("div",{className:"row",children:this.buildReportParams()}),this.renderModal(),(0,y.jsxs)("div",{className:"row",style:{justifyContent:"center"},children:[this.props.userDetails.EntityResult.IsWebPortalUser?null:(0,y.jsx)("div",{className:"col-12 col-md-6 col-lg-3",children:(0,y.jsx)(r.Button,{onClick:this.handleReportPrintClick,content:e("EOD_Print")})}),(0,y.jsx)("div",{className:"col-12 col-md-6 col-lg-3",children:(0,y.jsx)(r.Button,{onClick:this.handleShowReportClick,content:e("Report_Show")})})]})]}):""]})]})}),(0,y.jsx)(l.A,{children:(0,y.jsx)(p.ToastContainer,{hideProgressBar:!0,closeOnClick:!1,closeButton:!0,newestOnTop:!0,position:"bottom-right",toastClassName:"toast-notification-wrap"})})]})}}const j=(0,u.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})))(D)},73571:(e,t,a)=>{a.d(t,{A:()=>p});a(65043);var s=a(72711),r=a(728),i=a(92569),o=a(47766),l=(a(60663),a(7523)),n=a(97508),c=a(70579);function d(e){let{proxyServerHost:t,reportServiceHost:a,parameters:s,filePath:r,...l}=e;const n=t+"api/report",d=(e,t)=>{const a=t.settings.beforeSend;t.settings.beforeSend=function(t){a&&a(t),l.userDetails.EntityResult.IsWebPortalUser||(t.withCredentials=!0),t.URL_DEBUG.indexOf("parameters")>-1&&(t.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var t=e.hostElement;setTimeout((()=>{var e=t.querySelector(".wj-viewer-splitter"),a=t.querySelector(".wj-viewer-tabsleft").querySelectorAll("li")[2];a.disabled||(a.className="hidden",e.click())}),1e3)}})}};let m={Authorization:"Bearer "+l.tokenDetails.tokenInfo};const h=(e,s)=>{o._ReportService.prototype.load=function(e){var s=this,r=new o._Promise;return this._checkReportController(r)?(this.httpRequest(this._getReportInstancesUrl(),{method:"POST",data:e}).then((function(e){var i=o._parseReportExecutionInfo(e.responseText);s._instanceId=i.id,s._status=o._ExecutionStatus.loaded,s._outlinesLocation=i.outlinesLocation,s._statusLocation=i.statusLocation.replace(a,t),s._pageSettingsLocation=i.pageSettingsLocation,s._featuresLocation=i.featuresLocation,s._parametersLocation=i.parametersLocation,r.resolve(i)}),(function(e){r.reject(s._getError(e))})),r):r}};return(0,c.jsx)("div",{children:l.userDetails.EntityResult.IsWebPortalUser?(0,c.jsx)("div",{children:(0,c.jsx)(i.R,{requestHeaders:m,style:{height:"80vh"},parameters:s,serviceUrl:n,filePath:r,initialized:h,beforeSendRequest:d})}):(0,c.jsx)("div",{children:(0,c.jsx)(i.R,{style:{height:"80vh"},parameters:s,serviceUrl:n,filePath:r,initialized:h,beforeSendRequest:d})})})}d.defaultProps={parameters:{}},r.setLicenseKey(l.yQ);const m=(0,n.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})))(d);var h=a(67907);function p(e){let{proxyServerHost:t,reportServiceHost:a,filePath:r,handleBack:i,showReport:o,handleModalClose:l,parameters:n}=e;const[d]=(0,h.useTranslation)();return(0,c.jsx)(s.Modal,{style:{padding:"0px"},size:"fullscreen",open:o,children:(0,c.jsxs)("div",{children:[(0,c.jsx)(s.Header,{title:d("Header_TerminalManager"),menu:!1}),(0,c.jsx)(m,{proxyServerHost:t,reportServiceHost:a,filePath:r,parameters:n}),(0,c.jsx)("div",{style:{marginTop:"10px",marginLeft:"20px"},children:(0,c.jsx)(s.Button,{className:"backButton",onClick:i,content:d("Report_Back")})})]})})}p.defaultProps={parameters:{}}},11981:(e,t,a)=>{a.d(t,{A:()=>l});a(65043);var s=a(72711),r=a(67907),i=a(7523),o=a(70579);function l(e){let{notificationMessage:t}=e;function a(e){try{return e.split(i.uV)[0]}catch(t){return console.log(t),""}}function l(e){try{let t=e.split(i.uV);return t.splice(0,1),t}catch(t){return console.log(t),[]}}return(0,o.jsx)(r.TranslationConsumer,{children:e=>(0,o.jsx)(s.Notification,{className:"toast-notification",severity:t.messageType,hasIcon:!0,title:e(t.message),children:t.messageResultDetails.map((t=>{var s="";if(t.keyFields.length>0)for(var r=0;r<t.keyFields.length;r++)s=s+e(t.keyFields[r])+" : "+t.keyValues[r]+", ";return(0,o.jsxs)("div",{children:[(0,o.jsxs)("span",{style:{color:t.isSuccess?"#7eb338":"#F15A4F"},children:[s,t.isSuccess?e("NotificationList_MessageType_Success"):e("NotificationList_MessageType_Failure")+" : "+e(a(t.errorMessage),l(t.errorMessage))]}),(0,o.jsx)("br",{})]})}))})})}},35861:(e,t,a)=>{a.d(t,{F1:()=>l,i7:()=>n,r4:()=>o});var s=a(86178),r=a.n(s),i=(a(15660),a(65043),a(70579));function o(e,t){if(Array.isArray(e)){0===e.filter((e=>e.text===t)).length&&e.unshift({value:null,text:t})}return e}function l(){let e=window.navigator.userLanguage||window.navigator.language;return r().locale(e),r().localeData().longDateFormat("L")}function n(e){return(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:e}),(0,i.jsx)("div",{class:"ui red circular empty label badge  circle-padding"})]})}},92342:()=>{}}]);
//# sourceMappingURL=9329.ec27349e.chunk.js.map