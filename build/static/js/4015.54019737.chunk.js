"use strict";(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[4015],{24015:(e,t,s)=>{s.r(t),s.d(t,{default:()=>k});var i=s(65043),a=s(80432),r=s(9256),o=s(65187),n=s(40252),l=s(93779),d=s(72067),c=s(7523),u=s(97508),p=s(40854),h=s.n(p),m=s(53536),E=s.n(m),y=s(69062),M=s(43503),g=s(44192),D=s(46100),C=s(80312),v=s(72711),S=s(67907),T=s(85800),b=s(70579);function A(e){let{meter:t,LABlendType:s,modMeter:i,listOptions:a,validationErrors:r,onFieldChange:n,onActiveStatusChange:l,meterLineType:d,attributeValidationErrors:c,modAttributeMetaDataList:u,onAttributeDataChange:p,isTransloading:h,source:m}=e;const[E]=(0,S.useTranslation)(),y=(e,t)=>{let s=[];return s=e.find((e=>e.TerminalCode===t)),s.attributeValidationErrors};return(0,b.jsxs)("div",{className:"detailsContainer",children:[(0,b.jsxs)("div",{className:"row",children:[(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Input,{fluid:!0,value:i.Code,label:E("Meter_Code"),indicator:"required",disabled:""!==t.Code,onChange:e=>n("Code",e),error:E(r.Code),reserveSpace:!1})}),(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Input,{fluid:!0,value:i.Name,label:E("Meter_Name"),indicator:"required",onChange:e=>n("Name",e),error:E(r.Name),reserveSpace:!1})}),(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Select,{fluid:!0,placeholder:"Select",label:E("Meter_Type"),value:i.MeterType,disabled:"NONE"===s&&"MAINLINE"===d||"MAINLINE"!==d||""!==t.Code,indicator:"required",options:"PipelineSiteView"===m?a.pipelineTypeOptions:"MAINLINE"===d?a.mainlineTypeOptions:a.additiveTypeOptions,onChange:e=>n("MeterType",e),reserveSpace:!1,search:!1,noResultsMessage:E("noResultsMessage")})}),"ADDITIVE"===d?(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Select,{fluid:!0,placeholder:"Select",label:E("Meter_AssociatedProdMeterCode"),value:null!=i.ConjunctionNumber?i.ConjunctionNumber.toString():"",indicator:"required",options:a.meterCodeOptions,onChange:e=>n("ConjunctionNumber",e),error:E(r.ConjunctionNumber),reserveSpace:!1})}):"","MAINLINE"===d?(0,b.jsxs)("div",{className:"col-12 col-md-6 col-lg-4",children:[(0,b.jsx)(v.Input,{fluid:!0,value:i.MeterNumber,label:E("Meter_BCUMeterRefNumber"),indicator:"required",disabled:""!==t.Code,onChange:e=>n("MeterNumber",e),reserveSpace:!1,error:E(r.MeterNumber)})," "]}):"PipelineSiteView"!==m?(0,b.jsxs)("div",{className:"col-12 col-md-6 col-lg-4",children:[(0,b.jsx)(v.Input,{fluid:!0,value:i.MeterNumber,label:E("Meter_BCUInjectorPosNo"),indicator:"required",disabled:""!==t.Code,onChange:e=>n("MeterNumber",e),reserveSpace:!1,error:E(r.MeterNumber)})," "]}):null,"MAINLINE"===d&&"SIDE_STREAM"===s&&"FINISHED_PRODUCT_METER"!==i.MeterType?(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Select,{fluid:!0,placeholder:"Select",label:E("Meter_FPNumber"),value:null!=i.ConjunctionNumber?i.ConjunctionNumber.toString():"",indicator:"required",options:a.FpMeterCodes,onChange:e=>n("ConjunctionNumber",e),error:E(r.ConjunctionNumber),reserveSpace:!1})}):"",h?(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Select,{fluid:!0,placeholder:"Select",label:E("BaseProductList_Title"),value:i.BaseproductList,options:a.baseProductOptions,onChange:e=>n("BaseproductList",e),multiple:!0,reserveSpace:!1})}):"MAINLINE"===d&&"SEQUENTIAL"===s?(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Select,{fluid:!0,placeholder:"Select",label:E("Meter_AvlTankGroup"),value:i.TankGroupList,multiple:!0,indicator:"required",options:a.tankGroupOptions,onChange:e=>n("TankGroupList",e),error:E(r.TankGroupCode),noResultsMessage:E("noResultsMessage"),reserveSpace:!1,search:!0})}):"FINISHED_PRODUCT_METER"!==i.MeterType&&"PipelineSiteView"!==m?(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Select,{fluid:!0,placeholder:"Select",label:E("Meter_AvlTankGroup"),value:i.TankGroupCode,indicator:"required",options:a.tankGroupOptions,onChange:e=>n("TankGroupCode",e),error:E(r.TankGroupCode),noResultsMessage:E("noResultsMessage"),reserveSpace:!1,search:!0})}):null,"PipelineSiteView"!==m?(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Input,{fluid:!0,label:E("Meter_ProductDensity"),value:i.ProductDensityInput,onChange:e=>n("ProductDensityInput",e),error:E(r.ProductDensityInput),reserveSpace:!1})}):null,"PipelineSiteView"!==m?(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Input,{fluid:!0,value:null===i.Description?"":i.Description,label:E("FinishedProductList_Description"),onChange:e=>n("Description",e),error:E(r.Description),reserveSpace:!1})}):null,"PipelineSiteView"===m?(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Select,{fluid:!0,placeholder:"Select",label:E("Meter_BaseUOM"),value:null!=i.MeterBaseUOM?i.MeterBaseUOM.toString():"",indicator:"required",disabled:""!==t.Code,options:a.MeterBaseUOMs,onChange:e=>n("MeterBaseUOM",e),error:E(r.MeterBaseUOM),reserveSpace:!1})}):"",(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Select,{fluid:!0,placeholder:E("FinishedProductInfo_Select"),label:E("Cust_Status"),value:i.Active,options:[{text:E("ViewShipment_Ok"),value:!0},{text:E("ViewShipmentStatus_Inactive"),value:!1}],onChange:e=>l(e)})}),(0,b.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,b.jsx)(v.Input,{fluid:!0,value:null===i.Remarks?"":i.Remarks,label:E("Cust_Remarks"),onChange:e=>n("Remarks",e),indicator:i.Active!==t.Active?"required":"",error:E(r.Remarks),reserveSpace:!1})})]}),u.length>0?u.map((e=>(0,b.jsx)("div",{className:"bayAccordian",children:(0,b.jsx)(o.A,{children:(0,b.jsx)(v.Accordion,{className:"",children:(0,b.jsx)(v.Accordion.Content,{title:E("Attributes_Header"),children:(0,b.jsx)(T.n,{selectedAttributeList:e.attributeMetaDataList,handleCellDataEdit:p,attributeValidationErrors:y(c,e.TerminalCode)})})})})}))):null]})}var L=s(15417),R=s(62900);class I extends i.Component{constructor(){super(...arguments),this.state={meter:{},modMeter:{},isReadyToRender:!1,saveEnabled:!1,parentCode:"",isDeleteEnabled:!1,mainlineTypeOptions:[],additiveTypeOptions:[],pipelineTypeOptions:[],tankGroupOptions:[],baseProductOptions:[],meterCodeOptions:[],meterLineType:"",attributeMetaDataList:[],modAttributeMetaDataList:[],attributeValidationErrors:[],validationErrors:y.Th(g.SA),IsTransloading:!1,loadingArm:{},FpMeterCodes:[],MeterBaseUOMs:[],showDeleteAuthenticationLayout:!1,showSaveAuthenticationLayout:!1,tempMeter:{}},this.handleChange=(e,t)=>{try{let s=E().cloneDeep(this.state.modMeter);s[e]=t;const i={...this.state.validationErrors};s.Active===this.state.meter.Active&&(this.state.meter.Remarks!==s.Remarks&&""!==s.Remarks||(i.Remarks=""),""===s.Remarks&&(s.Remarks=this.state.meter.Remarks)),"MeterType"===e&&("SIDE_STREAM"===this.state.loadingArm.BlendType&&"FINISHED_PRODUCT_METER"!==t&&this.getFPMeterTypes(),"VIRTUAL_BASE_PRODUCT_METER"===t&&(s.Virtual=!0)),"Active"===e&&s.Active!==this.state.meter.Active&&(s.Remarks=""),void 0!==g.SA[e]&&(i[e]=y.jr(g.SA[e],t)),this.setState({validationErrors:i,modMeter:s})}catch(s){console.log("LoadingArmDetailsComposite:Error occured on handleChange",s)}},this.handleActiveStatusChange=e=>{try{let t=E().cloneDeep(this.state.modMeter);t.Active=e,t.Active!==this.state.meter.Active&&(t.Remarks=""),this.setState({modMeter:t})}catch(t){console.log("LoadingArmDetailsComposite:Error occured on handleActiveStatusChange",t)}},this.saveMeter=()=>{try{this.setState({saveEnabled:!1});let e=E().cloneDeep(this.state.tempMeter);"PipelineSiteView"===this.props.source?""===this.state.meter.Code?this.createPipelineMeter(e):this.updatePipelineMeter(e):""===this.state.meter.Code?this.createMeter(e):this.updateMeter(e)}catch(e){console.log("MeterComposite : Error in saveMeter")}},this.handleSave=()=>{try{let e=this.fillDetails(),t=y.pI(this.state.modAttributeMetaDataList);if(this.validateSave(e,t)){t=y.SC(t),e.Attributes=y.Gh(t);let s=!0!==this.props.userDetails.EntityResult.IsWebPortalUser,i=E().cloneDeep(e);this.setState({showSaveAuthenticationLayout:s,tempMeter:i},(()=>{!1===s&&this.saveMeter()}))}else this.setState({saveEnabled:!0})}catch(e){console.log("MeterDetailsComposite:Error occured on handleSave",e)}},this.handleDelete=()=>{try{var e=[],t=this.state.modMeter.Code,s={keyDataCode:0,ShareHolderCode:"",KeyCodes:[{Key:l.Zx,Value:t},{Key:l.Y4,Value:this.props.parentCode},{Key:l.Ln,Value:this.props.transportationtype},{Key:l.uw,Value:this.props.selectedTerminal},{Key:l.oV,Value:this.state.meterLineType}]};e.push(s),h()(d.Pe8,y.tW(e,this.props.tokenDetails.tokenInfo)).then((e=>{var s=e.data,i=s.IsSuccess;null!==s.ResultDataList&&void 0!==s.ResultDataList&&(i=s.ResultDataList.filter((function(e){return!e.IsSuccess})).length!==s.ResultDataList.length);let a={messageType:"critical",message:"MeterDeletionStatus",messageResultDetails:[{keyFields:["MeterCode"],keyValues:[t],isSuccess:!1,errorMessage:""}]};a.messageType=s.IsSuccess?"success":"critical",a.messageResultDetails[0].isSuccess=s.IsSuccess,i?(this.getMeter({meterCode:this.state.modMeter.Code,selectedTerminal:this.props.selectedTerminal,isClone:!1}),this.setState({isDeleteEnabled:!1,showDeleteAuthenticationLayout:!1})):this.setState({isDeleteEnabled:!0,showDeleteAuthenticationLayout:!1}),a.messageResultDetails[0].errorMessage=s.ErrorList[0],this.props.onDelete(this.state.modMeter,"delete",a)}))}catch(i){console.log("MeterDetailsComposite:Error occured on handleDelete",i)}},this.handleAttributeDataChange=(e,t)=>{try{let s=[],i=E().cloneDeep(this.state.modAttributeMetaDataList),a=i.filter((t=>t.TerminalCode===e.TerminalCode));a.length>0&&Array.isArray(a[0].attributeMetaDataList)&&(s=a[0].attributeMetaDataList.filter((t=>t.Code===e.Code))),s.length>0&&(s[0].DefaultValue=t);const r=E().cloneDeep(this.state.attributeValidationErrors);r.forEach((s=>{s.TerminalCode===e.TerminalCode&&(s.attributeValidationErrors[e.Code]=y.I5(e,t))})),this.setState({attributeValidationErrors:r,modAttributeMetaDataList:i})}catch(s){console.log("MeterDetailsComposite:Error occured on handleAttributeDataChange",s)}},this.handleReset=()=>{try{const{validationErrors:e}={...this.state};Object.keys(e).forEach((function(t){e[t]=""})),this.setState({modMeter:E().cloneDeep(this.state.meter),selectedCompRow:[],validationErrors:e,modAttributeMetaDataList:[]},(()=>{this.props.userDetails.EntityResult.IsEnterpriseNode?(this.terminalSelectionChange([this.state.meter.TerminalCode]),this.handleResetAttributeValidationError()):(this.localNodeAttribute(),this.handleResetAttributeValidationError())}))}catch(e){console.log("PipelineMeterDetailsComposite:Error occured on handleReset",e)}},this.authenticateDelete=()=>{try{let e=!0!==this.props.userDetails.EntityResult.IsWebPortalUser;this.setState({showDeleteAuthenticationLayout:e}),!1===e&&this.handleDelete()}catch(e){console.log("LoadingArmComposite : Error in authenticateDelete")}},this.handleAuthenticationClose=()=>{this.setState({showSaveAuthenticationLayout:!1,showDeleteAuthenticationLayout:!1})}}componentDidMount(){try{y.pJ(this.props.userDetails.EntityResult.IsArchived),"PipelineSiteView"===this.props.source?(this.getMeterTypes(),this.getAttributes(this.props),this.getUOMList()):(this.getLoadingArm(this.props.parentCode),this.getBCUDeviceDetails(this.props.deviceCode),this.getMeterTypes(),this.getTankGroups(this.props.meterLineType),this.getMeterCodes(this.props.parentCode),this.getAttributes(this.props))}catch(e){console.log("LoadingArmDetailsComposite:Error occured on componentDidMount",e)}}getUOMList(){h()(d.WFM,y.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult){let e=t.EntityResult.VOLUME,s=t.EntityResult.MASS,i=[];e.forEach((e=>{i.push({text:e,value:e})})),s.forEach((e=>{i.push({text:e,value:e})})),this.setState({MeterBaseUOMs:i})}}else console.log("Error in getUOM:",t.ErrorList)})).catch((e=>{console.log("Error while getting getUOM:",e)}))}componentWillReceiveProps(e){try{if("PipelineSiteView"===this.props.source){this.getPipelineMeter(e);let t={...this.state.validationErrors};Object.keys(t).forEach((e=>{t[e]=""})),this.setState({validationErrors:t})}else if(void 0===e.LocationCode&&this.props.tokenDetails.tokenInfo===e.tokenDetails.tokenInfo){this.getTankGroups(e.meterLineType),this.getMeterCodes(e.parentCode),this.getAttributes(e),this.getLoadingArm(e.parentCode);let t={...this.state.validationErrors};Object.keys(t).forEach((e=>{t[e]=""})),this.setState({validationErrors:t})}}catch(t){console.log("LoadingArmDetailsComposite:Error occured on componentWillReceiveProps",t)}}getLoadingArm(e){try{var t=[{key:l.Y4,value:e},{key:l.Ln,value:c.LY.ROAD},{key:l.uw,value:this.props.selectedTerminal}],s={ShareHolderCode:"",keyDataCode:l.Y4,KeyCodes:t};h()(d.b3t,y.tW(s,this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;!0===t.IsSuccess&&this.setState({loadingArm:t.EntityResult})}))}catch(i){console.log("LoadingArmDetailsComposite:Error occured in getLoadingArm",i)}}getAttributes(e){try{h()(d.fKH,y.tW([L.HP],this.props.tokenDetails.tokenInfo)).then((t=>{var s=t.data;!0===s.IsSuccess?this.setState({attributeMetaDataList:E().cloneDeep(s.EntityResult),attributeValidationErrors:y.Fl(s.EntityResult.meter)},(()=>{"PipelineSiteView"===this.props.source?this.getPipelineMeter(e.selectedRow):this.getMeter(e)})):console.log("Error in getAttributes:")}))}catch(t){console.log("Error while getAttributes:",t)}}getMeterTypes(){try{h()(d.fln,y.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult&&null!=t.EntityResult.MAINLINE){var s=y.JT(t.EntityResult.MAINLINE);this.setState({mainlineTypeOptions:s})}if(null!==t.EntityResult&&null!=t.EntityResult.ADDITIVE){var i=y.JT(t.EntityResult.ADDITIVE);this.setState({additiveTypeOptions:i})}if(null!==t.EntityResult&&null!=t.EntityResult.PIPELINE){var a=y.JT(t.EntityResult.PIPELINE);this.setState({pipelineTypeOptions:a})}}else console.log("Error in getDeviceTypes:",t.ErrorList)}))}catch(e){console.log("LoadingArmDetailsComposite:Error while getting getBlendTypes")}}getFPMeterTypes(){try{h()(d.jQd+"?LoadingArmCode="+this.props.parentCode,y.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;!0===t.IsSuccess?this.setState({FpMeterCodes:y.JT(t.EntityResult)}):console.log("Error in getMeterTypes:",t.ErrorList)}))}catch(e){console.log("MeterDetailsComposite:Error while getting getMeterTypes")}}getBaseProducts(e){h()(d.Odh+"?TerminalCode="+e,y.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult&&Array.isArray(t.EntityResult)){let e=y.Zj(t.EntityResult);this.setState({baseProductOptions:e})}}else console.log("Error in getBaseProducts:",t.ErrorList)})).catch((e=>{console.log("Error while getting BaseProducts:",e)}))}getMeterCodes(e){try{h()(d.c8h+"?armCode="+e+"&transportationType="+this.props.transportationtype,y.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult){var s=y.JT(t.EntityResult.BASE_PRODUCT_METER);this.setState({meterCodeOptions:s})}}else console.log("Error in getDeviceTypes:",t.ErrorList)}))}catch(t){console.log("LoadingArmDetailsComposite:Error while getting getBlendTypes")}}getBCUDeviceDetails(e){try{var t=[{key:l.wX,value:e},{key:l.uw,value:this.props.selectedTerminal}],s={ShareHolderCode:"",keyDataCode:l.wX,KeyCodes:t};h()(d.T1y,y.tW(s,this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;!0===t.IsSuccess&&(this.setState({IsTransloading:t.EntityResult.IsTransloading}),this.getBaseProducts(this.props.selectedTerminal))}))}catch(i){console.log("MeterDetailsComposite:Error while getting getBCUDeviceDetails")}}getPipelineMeter(e){try{if(D.XE.MeterType=c.Zj.PIPELINE_HEADER_METER,void 0===e.Common_Code)return D.XE.MeterBaseUOM=this.props.userDetails.EntityResult.PageAttibutes.DefaultUOMS.QuantityUOM,void this.setState({meter:E().cloneDeep(D.XE),modMeter:E().cloneDeep(D.XE),modAttributeMetaDataList:[],isReadyToRender:!0,saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,C.aZ)},(()=>{this.localNodeAttribute()}));var t=[{key:l.Zx,value:e.Common_Code},{key:l.uw,value:this.props.selectedTerminal}],s={ShareHolderCode:"",keyDataCode:l.Zx,KeyCodes:t};h()(d.Kng,y.tW(s,this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;!0===t.IsSuccess?this.setState({modAttributeMetaDataList:[],meter:E().cloneDeep(t.EntityResult),modMeter:E().cloneDeep(t.EntityResult),isReadyToRender:!0,saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,C.aZ)},(()=>{this.terminalSelectionChange([t.EntityResult.TerminalCode])})):this.setState({meter:E().cloneDeep(D.XE),modMeter:E().cloneDeep(D.XE),isReadyToRender:!0,saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,C.aZ)})}))}catch(i){console.log("MeterDetailsComposite:Error occured in getPipelinemeter",i)}}getMeter(e){let t=e.meterCode,s=e.meterLineType;s===c.oV.MAINLINE?(D.XE.MeterLineType=c.oV.MAINLINE,D.XE.MeterType=c.Zj.BASE_PRODUCT_METER):(D.XE.MeterLineType=c.oV.ADDITIVE,D.XE.MeterType=c.Zj.ADDITIVE_METER);try{if(void 0===t||""===t)return void this.setState({meter:E().cloneDeep(D.XE),modMeter:E().cloneDeep(D.XE),modAttributeMetaDataList:[],isDeleteEnabled:!1,isReadyToRender:!0,meterLineType:s,saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,y.k5(this.props.transportationtype))},(()=>{this.localNodeAttribute()}));if(!0===e.isClone)return void this.setState({meter:E().cloneDeep(D.XE),modMeter:E().cloneDeep(D.XE),modAttributeMetaDataList:[],isDeleteEnabled:!1,isReadyToRender:!0,meterLineType:s,saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,y.k5(this.props.transportationtype))},(()=>{this.localNodeAttribute()}));var i=[{key:l.Zx,value:t},{key:l.Ln,value:this.props.transportationtype},{key:l.uw,value:this.props.selectedTerminal}],a={ShareHolderCode:"",keyDataCode:l.Zx,KeyCodes:i};h()(d.eSx,y.tW(a,this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){this.setState({modAttributeMetaDataList:[],meter:E().cloneDeep(t.EntityResult),modMeter:E().cloneDeep(t.EntityResult),isReadyToRender:!0,isDeleteEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.remove,y.k5(this.props.transportationtype)),saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,y.k5(this.props.transportationtype))},(()=>{"SIDE_STREAM"===this.state.loadingArm.BlendType&&"FINISHED_PRODUCT_METER"!==t.EntityResult.MeterType&&this.getFPMeterTypes(),this.terminalSelectionChange([t.EntityResult.TerminalCode])}));let e=E().cloneDeep(this.state.modMeter);this.setState({meterLineType:e.MeterLineType})}else this.setState({meter:E().cloneDeep(D.XE),modMeter:E().cloneDeep(D.XE),isDeleteEnabled:!1,isReadyToRender:!0,saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,y.k5(this.props.transportationtype))})}))}catch(r){console.log("LoadingArmDetailsComposite:Error occured in getLoadingArm",r)}}terminalSelectionChange(e){try{let a=[];var t=[],s=[];t=E().cloneDeep(this.state.attributeMetaDataList),s=E().cloneDeep(this.state.modAttributeMetaDataList);const r=E().cloneDeep(this.state.attributeValidationErrors);var i=E().cloneDeep(this.state.modMeter);e.forEach((e=>{var r=s.find((t=>t.TerminalCode===e));void 0===r?t.meter.forEach((function(t){if(t.TerminalCode===e){var s=i.Attributes.find((t=>t.TerminalCode===e));void 0!==s&&t.attributeMetaDataList.forEach((function(e){var t=s.ListOfAttributeData.find((t=>t.AttributeCode===e.Code));void 0!==t&&(e.DefaultValue=t.AttributeValue)})),a.push(t)}})):a.push(r)})),s=[],s=a,s=y.nQ(s),r.forEach((t=>{void 0===e.find((e=>t.TerminalCode===e))&&Object.keys(t.attributeValidationErrors).forEach((e=>t.attributeValidationErrors[e]=""))})),this.setState({modAttributeMetaDataList:s,attributeValidationErrors:r})}catch(a){console.log("MeterDetailsComposite:Error occured on terminalSelectionChange",a)}}localNodeAttribute(){try{this.terminalSelectionChange([this.props.selectedTerminal])}catch(e){console.log("MeterDetailsComposite:Error occured on localNodeAttribute",e)}}getTankGroups(e){h()(d.LUH+"?MeterLine="+e,y.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult&&Array.isArray(t.EntityResult)){var s=y.Zj(t.EntityResult);this.setState({tankGroupOptions:s})}}else console.log("Error in getLoadingTypes:",t.ErrorList)})).catch((e=>{console.log("Error while getting getLoadingTypes:",e)}))}validateSave(e,t){const s={...this.state.validationErrors};Object.keys(g.SA).forEach((function(t){void 0!==e[t]&&(s[t]=y.jr(g.SA[t],e[t]))})),e.Active!==this.state.meter.Active&&(null!==e.Remarks&&""!==e.Remarks||(s.Remarks="OriginTerminal_RemarksRequired"));let i=this.state.meterLineType;!1===this.state.IsTransloading&&("FINISHED_PRODUCT_METER"===e.MeterType||"SEQUENTIAL"===this.state.loadingArm.BlendType||null!==e.TankGroupCode&&""!==e.TankGroupCode||"PipelineSiteView"===this.props.source||(s.TankGroupCode="Meter_TankGrpSelect"),"FINISHED_PRODUCT_METER"!==e.MeteType&&i===c.oV.MAINLINE&&"SEQUENTIAL"===this.state.loadingArm&&"PipelineSiteView"!==this.props.source&&(s.TankGroupCode="Meter_TankGrpSelect")),i===c.oV.MAINLINE&&(null!==e.MeterNumber&&""!==e.MeterNumber||(s.MeterNumber="Meter_BCUMeterRefNoMandatory"),"SIDE_STREAM"!==this.state.loadingArm.BlendType||"FINISHED_PRODUCT_METER"===e.MeterType||null!==e.ConjunctionNumber&&""!==e.ConjunctionNumber||(s.ConjunctionNumber="siteView_meter_select_FPMeter")),i===c.oV.ADDITIVE&&(null!==e.MeterNumber&&""!==e.MeterNumber||(s.MeterNumber="Meter_BCUInjPosNum"),null!==e.ConjunctionNumber&&""!==e.ConjunctionNumber||(s.ConjunctionNumber="Meter_APMCMandatory")),e.MeterLineType===c.oV.PIPELINE&&(null!==e.MeterBaseUOM&&""!==e.MeterBaseUOM||(s.MeterBaseUOM="TankInfo_UOMRequired"));var a=E().cloneDeep(this.state.attributeValidationErrors);t.forEach((e=>{a.forEach((t=>{t.TerminalCode===e.TerminalCode&&e.attributeMetaDataList.forEach((e=>{t.attributeValidationErrors[e.Code]=y.I5(e,e.DefaultValue)}))}))})),this.setState({validationErrors:s,attributeValidationErrors:a});var r=!0;return a.forEach((e=>{if(!r)return r;r=Object.values(e.attributeValidationErrors).every((function(e){return""===e}))})),r&&(r=Object.values(s).every((function(e){return""===e}))),r}fillDetails(){try{let e=E().cloneDeep(this.state.modMeter);return"PipelineSiteView"===this.props.source?(e.Duplicate=!1,e.MeterLineType=c.oV.PIPELINE,e.Virtual=!1,e.TankGroupCode=null):(e.LoadingArmCode=this.props.parentCode,e.TerminalCode=this.props.selectedTerminal),e}catch(e){console.log("MeterDetailsComposite:Error occured on filldetails",e)}}createMeter(e){try{let t=[{key:l.Zx,value:e.Code},{key:l.Ln,value:this.props.transportationtype}],s={ShareHolderCode:"",keyDataCode:l.Zx,KeyCodes:t,Entity:e},i={messageType:"critical",message:["MeterCodeSavedSuccess"],messageResultDetails:[{keyFields:["MeterCode"],keyValues:[e.Code],isSuccess:!1,errorMessage:""}]};h()(d.G98,y.tW(s,this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;i.messageType=t.IsSuccess?"success":"critical",i.messageResultDetails[0].isSuccess=t.IsSuccess,!0===t.IsSuccess?(this.setState({saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,y.k5(this.props.transportationtype)),showSaveAuthenticationLayout:!1}),this.getMeter({meterCode:this.state.modMeter.Code,selectedTerminal:this.props.selectedTerminal,isClone:!1})):(i.messageResultDetails[0].errorMessage=t.ErrorList[0],this.setState({saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,y.k5(this.props.transportationtype)),showSaveAuthenticationLayout:!1})),this.props.onSaved(this.state.modMeter,"add",i)}))}catch(t){console.log("LoadingArmDetailsComposite:Error occured on createLoadingArm",t)}}createPipelineMeter(e){try{let t=[{key:l.Zx,value:e.Code}],s={ShareHolderCode:"",keyDataCode:l.Zx,KeyCodes:t,Entity:e},i={messageType:"critical",message:["MeterCodeSavedSuccess"],messageResultDetails:[{keyFields:["MeterCode"],keyValues:[e.Code],isSuccess:!1,errorMessage:""}]};h()(d.KcJ,y.tW(s,this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;i.messageType=t.IsSuccess?"success":"critical",i.messageResultDetails[0].isSuccess=t.IsSuccess,!0===t.IsSuccess?(this.setState({saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,C.aZ),showSaveAuthenticationLayout:!1}),this.getPipelineMeter({Common_Code:this.state.modMeter.Code,selectedTerminal:this.props.selectedTerminal})):(i.messageResultDetails[0].errorMessage=t.ErrorList[0],this.setState({saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,C.aZ),showSaveAuthenticationLayout:!1})),this.props.onSaved(this.state.modMeter,"add",i)}))}catch(t){console.log("MeterDetailsComposite:Error occured on createPipelineMeter",t)}}updatePipelineMeter(e){try{let t=[{key:l.Zx,value:e.Code}],s={ShareHolderCode:"",keyDataCode:l.Zx,KeyCodes:t,Entity:e},i={messageType:"critical",message:["MeterCodeSavedSuccess"],messageResultDetails:[{keyFields:["MeterCode"],keyValues:[e.Code],isSuccess:!1,errorMessage:""}]};h()(d.zqU,y.tW(s,this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;i.messageType=t.IsSuccess?"success":"critical",i.messageResultDetails[0].isSuccess=t.IsSuccess,!0===t.IsSuccess?(this.setState({saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,C.aZ),showSaveAuthenticationLayout:!1}),this.getPipelineMeter({Common_Code:this.state.modMeter.Code,selectedTerminal:this.props.selectedTerminal})):(i.messageResultDetails[0].errorMessage=t.ErrorList[0],this.setState({saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,C.aZ),showSaveAuthenticationLayout:!1})),this.props.onSaved(this.state.modMeter,"update",i)}))}catch(t){console.log("MeterDetailsComposite:Error occured on updatePipelineMeter",t)}}handleResetAttributeValidationError(){try{var e=E().cloneDeep(this.state.attributeMetaDataList);this.setState({attributeValidationErrors:y.Fl(e.meter)})}catch(t){console.log("PipelineMeterDetailsComposite:Error occured on handleResetAttributeValidationError",t)}}updateMeter(e){try{let t=[{key:l.Zx,value:e.Code},{key:l.Ln,value:this.props.transportationtype}],s={ShareHolderCode:"",keyDataCode:l.Zx,KeyCodes:t,Entity:e},i={messageType:"critical",message:["MeterCodeSavedSuccess"],messageResultDetails:[{keyFields:["MeterCode"],keyValues:[e.Code],isSuccess:!1,errorMessage:""}]};h()(d.Llr,y.tW(s,this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;i.messageType=t.IsSuccess?"success":"critical",i.messageResultDetails[0].isSuccess=t.IsSuccess,!0===t.IsSuccess?(this.setState({saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,y.k5(this.props.transportationtype)),showSaveAuthenticationLayout:!1}),this.getMeter({meterCode:this.state.modMeter.Code,selectedTerminal:this.props.selectedTerminal,isClone:!1})):(i.messageResultDetails[0].errorMessage=t.ErrorList[0],this.setState({saveEnabled:y.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,y.k5(this.props.transportationtype)),showSaveAuthenticationLayout:!1})),this.props.onSaved(this.state.modMeter,"update",i)}))}catch(t){console.log("LoadingArmDetailsComposite:Error occured on updateLoadingArm",t)}}handleOperation(){return this.state.showDeleteAuthenticationLayout?this.handleDelete:this.saveMeter}getFunctionGroupName(){return"PipelineSiteView"===this.props.source?C.aZ:this.props.transportationtype===c.LY.RAIL?C.Z9:this.props.transportationtype===c.LY.MARINE?C.PP:C.x5}getFunctionName(){return this.state.showDeleteAuthenticationLayout?C.i.remove:""===this.state.meter.Code?C.i.add:C.i.modify}render(){const e=[{fieldName:"DriverInfo_LastUpdated",fieldValue:new Date(this.state.meter.LastUpdatedTime).toLocaleDateString()+" "+new Date(this.state.modMeter.LastUpdatedTime).toLocaleTimeString()},{fieldName:"DriverInfo_LastActive",fieldValue:void 0!==this.state.modMeter.LastActiveTime&&null!==this.state.modMeter.LastActive?new Date(this.state.modMeter.LastActiveTime).toLocaleDateString()+" "+new Date(this.state.modMeter.LastActiveTime).toLocaleTimeString():""},{fieldName:"DriverInfo_CreatedTime",fieldValue:new Date(this.state.modMeter.CreatedTime).toLocaleDateString()+" "+new Date(this.state.modMeter.CreatedTime).toLocaleTimeString()}];return this.state.isReadyToRender?(0,b.jsxs)("div",{children:[(0,b.jsx)(o.A,{children:(0,b.jsx)(M.A,{entityCode:this.state.meter.Code,newEntityName:"Meter_Headder",popUpContents:e})}),(0,b.jsx)(o.A,{children:(0,b.jsx)(A,{meter:this.state.meter,modMeter:this.state.modMeter,meterLineType:this.state.meterLineType,LABlendType:this.state.loadingArm.BlendType,listOptions:{mainlineTypeOptions:this.state.mainlineTypeOptions,additiveTypeOptions:this.state.additiveTypeOptions,pipelineTypeOptions:this.state.pipelineTypeOptions,tankGroupOptions:this.state.tankGroupOptions,meterCodeOptions:this.state.meterCodeOptions,baseProductOptions:this.state.baseProductOptions,FpMeterCodes:this.state.FpMeterCodes,MeterBaseUOMs:this.state.MeterBaseUOMs},validationErrors:this.state.validationErrors,modAttributeMetaDataList:this.state.modAttributeMetaDataList,attributeValidationErrors:this.state.attributeValidationErrors,attributeMetaDataList:this.state.attributeMetaDataList,onAttributeDataChange:this.handleAttributeDataChange,onFieldChange:this.handleChange,onActiveStatusChange:this.handleActiveStatusChange,isTransloading:this.state.IsTransloading,source:this.props.source})}),(0,b.jsx)(o.A,{children:""!==this.props.source&&void 0!==this.props.source?(0,b.jsx)(r.q,{handleBack:this.props.onBack,handleSave:this.handleSave,handleReset:this.handleReset,saveEnabled:!this.props.userDetails.EntityResult.IsEnterpriseNode&&this.state.saveEnabled}):(0,b.jsx)(a.E,{isEnterpriseNode:this.props.userDetails.EntityResult.IsEnterpriseNode,handleSave:this.handleSave,handleDelete:this.authenticateDelete,saveEnabled:this.state.saveEnabled,isDeleteEnabled:this.state.isDeleteEnabled})}),this.state.showDeleteAuthenticationLayout||this.state.showSaveAuthenticationLayout?(0,b.jsx)(R.A,{Username:this.props.userDetails.EntityResult.UserName,functionName:this.getFunctionName(),functionGroup:this.getFunctionGroupName(),handleClose:this.handleAuthenticationClose,handleOperation:this.handleOperation()}):null]}):(0,b.jsx)(n.A,{message:"Loading"})}}const k=(0,u.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})))(I)}}]);
//# sourceMappingURL=4015.54019737.chunk.js.map