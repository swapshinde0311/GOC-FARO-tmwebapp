"use strict";(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[4872],{74872:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var a=s(65043),n=s(78374),o=s(72711),i=s(67907),l=s(35861),r=s(70579);function c(e){let{entryDate:t,modAssociations:s,selectedAssociations:a,listOptions:c,onFieldChange:d,onTankSearchChange:h,handleAddAssociation:u,handleDeleteAssociation:m,handleAssociationSelectionChange:p,handleCellDataEdit:y,isEnterpriseNode:E}=e;const[g]=(0,i.useTranslation)(),D=(e,t)=>(0,r.jsx)(o.Select,{className:"selectDropwdown",value:s[e.rowIndex][e.field],fluid:!0,options:t,onChange:t=>y(t,e),indicator:"required",reserveSpace:!1,search:!0,noResultsMessage:g("noResultsMessage")}),C=e=>(0,r.jsx)(o.Select,{fluid:!0,value:s[e.rowIndex][e.field],options:(0,l.r4)(c.tankCode,g("Common_Select")),onChange:t=>y(t,e),search:!0,reserveSpace:!1,noResultsMessage:g("noResultsMessage"),onSearch:h}),M=e=>(0,r.jsx)(o.Input,{fluid:!0,value:s[e.rowIndex][e.field],onChange:t=>y(t,e),reserveSpace:!1}),O=e=>{const{value:t}=e;return"number"===typeof t?t.toLocaleString():t};return(0,r.jsx)(i.TranslationConsumer,{children:e=>(0,r.jsxs)("div",{className:"detailsContainer",children:[(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("div",{style:{padding:"0 15px 15px 15px"},children:(0,r.jsx)(o.DatePicker,{fluid:!0,value:null===t?"":new Date(t),label:e("TankEODEntry_EODEntryDate"),type:"date",displayFormat:(0,l.F1)(),indicator:"required",onChange:e=>d("EntryTime",e),reserveSpace:!1})})}),(0,r.jsxs)("div",{className:"row compartmentRow",children:[(0,r.jsx)("div",{className:"col col-md-8 col-lg-9 col col-xl-9",children:(0,r.jsx)("h4",{children:e("TankEODEntry_PageTitle")})}),(0,r.jsx)("div",{className:"col col-md-4 col-lg-3 col-xl-3",children:(0,r.jsxs)("div",{className:"compartmentIconContainer",children:[(0,r.jsxs)("div",{onClick:u,className:"compartmentIcon",children:[(0,r.jsx)("div",{children:(0,r.jsx)(o.Icon,{root:"common",name:"badge-plus",size:"medium"})}),(0,r.jsx)("div",{className:"margin_l10",children:(0,r.jsx)("h5",{className:"font14",children:e("FinishedProductInfo_Add")})})]}),(0,r.jsxs)("div",{onClick:m,className:"compartmentIcon margin_l30",children:[(0,r.jsx)("div",{children:(0,r.jsx)(o.Icon,{root:"common",name:"delete",size:"medium"})}),(0,r.jsx)("div",{className:"margin_l10",children:(0,r.jsx)("h5",{className:"font14",children:e("DestAdd_Delete")})})]})]})})]}),(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("div",{className:"col-12 detailsTable",children:(0,r.jsxs)(n.bQ,{data:s,selectionMode:"multiple",selection:a,onSelectionChange:p,children:[(0,r.jsx)(n.bQ.Column,{className:"compColHeight",field:"TankCode",header:e("TankEODEntry_TankCode"),editable:!0,editFieldType:"text",customEditRenderer:e=>C(e)},"TankCode"),(0,r.jsx)(n.bQ.Column,{className:"compColHeight",field:"BaseProductCode",header:e("TankEODEntry_Product"),editable:!0,editFieldType:"text",customEditRenderer:e=>D(e,c.baseProductCode)},"BaseProductCode"),(0,r.jsx)(n.bQ.Column,{className:"compColHeight",field:"EOPGrossVolume",header:e("TankEODEntry_GrossQty"),editable:!0,editFieldType:"text",renderer:e=>O(e),customEditRenderer:M},"EOPGrossVolume"),(0,r.jsx)(n.bQ.Column,{className:"compColHeight",field:"EOPNetVolume",header:e("TankEODEntry_NetQty"),editable:!0,editFieldType:"text",renderer:e=>O(e),customEditRenderer:M},"EOPNetVolume"),(0,r.jsx)(n.bQ.Column,{className:"compColHeight",field:"QuantityUOM",header:e("TankUnaccountedTransaction_QuantityUOM"),editable:!0,editFieldType:"text",customEditRenderer:e=>D(e,c.quantityUOM)},"QuantityUOM"),(0,r.jsx)(n.bQ.Column,{className:"compColHeight",field:"EOPMassVolume",header:e("TankEODEntry_MassVolume"),editable:!0,editFieldType:"text",renderer:e=>O(e),customEditRenderer:M},"EOPMassVolume"),(0,r.jsx)(n.bQ.Column,{className:"compColHeight",field:"MassQuantityUOM",header:e("TankEODEntry_MassQuantityUOM"),editable:!0,editFieldType:"text",customEditRenderer:e=>D(e,c.densityQuantityUOM)},"MassQuantityUOM")]})})})]})})}c.defaultProps={isEnterpriseNode:!1};var d=s(53536),h=s.n(d),u=s(69062),m=s(9966),p=s(72067),y=s(7523),E=s(28882),g=s(80312),D=s(40854),C=s.n(D),M=s(65187),O=s(40252),k=s(50805),S=s(97508),A=s(62900);class T extends a.Component{constructor(){super(...arguments),this.state={entryDate:new Date,isReadyToRender:!1,associations:[],modAssociations:[],selectedAssociations:[],tankCodeOptions:[],tankCodeSearchOptions:[],baseProductCodeOptions:[],quantityUOMOptions:[],massQuantityUOMOptions:[],saveEnabled:!1,showAuthenticationLayout:!1,tempAssociations:{}},this.handleAssociationSelectionChange=e=>{this.setState({selectedAssociations:e})},this.handleAddAssociation=()=>{if(!this.props.userDetails.EntityResult.IsArchived)try{const e=h().cloneDeep(this.state.modAssociations),t={BaseProductCode:"",BOPGrossVolume:"",BOPMassVolume:"",BOPNetVolume:"",EOPGrossVolume:"",EOPMassVolume:"",EOPNetVolume:"",MassQuantityUOM:"",QuantityUOM:"",ReconciliationCode:"",TransactionTotalGrossQty:"",TransactionTotalNetQty:"",TankCode:""};t.SeqNumber=u.Mz(this.state.modAssociations),e.push(t),this.setState({modAssociations:e,selectedAssociations:[]})}catch(e){console.log("TankManualEntryDetailsComposite: Error occurred on handleAddAssociation",e)}},this.handleDeleteAssociation=()=>{if(!this.props.userDetails.EntityResult.IsArchived)try{if(null!=this.state.selectedAssociations&&this.state.selectedAssociations.length>0&&this.state.modAssociations.length>0){let e=h().cloneDeep(this.state.modAssociations);this.state.selectedAssociations.forEach(((t,s)=>{e=e.filter(((e,s)=>e.SeqNumber!==t.SeqNumber))})),this.setState({modAssociations:e})}this.setState({selectedAssociations:[]})}catch(e){console.log("TankManualEntryDetailsComposite: Error occurred on handleDeleteAssociation",e)}},this.handleChange=(e,t)=>{try{this.getTankManualEntryData(t),this.setState({entryDate:t})}catch(s){console.log("TankManualEntryDetailsComposite: Error occurred on handleChange",s)}},this.handleCellDataEdit=(e,t)=>{let s=h().cloneDeep(this.state.modAssociations);s[t.rowIndex][t.field]=e,this.setState({modAssociations:s})},this.handleTankSearchChange=e=>{try{let t=this.state.tankCodeOptions.filter((t=>t.value.toLowerCase().includes(e.toLowerCase())));t.length>y.bM&&(t=t.slice(0,y.bM)),this.setState({tankCodeSearchOptions:t})}catch(t){console.log("TankManualEntryDetailsComposite: Error occurred on handleTankSearchChange",t)}},this.handleTankManualEntry=()=>{this.setState({saveEnabled:!1}),this.handleAuthenticationClose();let e=h().cloneDeep(this.state.tempAssociations);for(let s of e)s.EOPGrossVolume=u.bo(s.EOPGrossVolume),s.EOPNetVolume=u.bo(s.EOPNetVolume),s.EOPMassVolume=u.bo(s.EOPMassVolume),s.MassQuantityUOM=u.bo(s.MassQuantityUOM);const t=0===this.state.associations.length;this.updateTankEODData(t,e)},this.handleSave=()=>{try{const e=h().cloneDeep(this.state.modAssociations);if(this.validateSave(e)){let t=!0!==this.props.userDetails.EntityResult.IsWebPortalUser,s=h().cloneDeep(e);this.setState({showAuthenticationLayout:t,tempAssociations:s},(()=>{!1===t&&this.handleTankManualEntry()}))}else this.setState({saveEnabled:!0})}catch(e){console.log("TankManualEntryDetailsComposite: Error occurred on handleSave",e)}},this.handleReset=()=>{try{this.setState({entryDate:new Date,modAssociations:[]})}catch(e){console.log("TankManualEntryDetailsComposite: Error occurred on handleSave",e)}},this.handleAuthenticationClose=()=>{this.setState({showAuthenticationLayout:!1})}}componentDidMount(){try{u.pJ(this.props.userDetails.EntityResult.IsArchived),this.getTankCodes(this.props.userDetails.EntityResult.PrimaryShareholder),this.getBaseProductCodes(),this.getUOMs(),this.getTankManualEntryData(this.state.entryDate)}catch(e){console.log("TankManualEntryDetailsComposite: Error occurred on componentDidMount",e)}}componentWillReceiveProps(){try{this.getTankManualEntryData(this.state.entryDate)}catch(e){console.log("TankManualEntryDetailsComposite: Error occurred on componentWillReceiveProps",e)}}getTankCodes(e){C()(p.Ibp+"?ShareholderCode="+e,u.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult&&Array.isArray(t.EntityResult)){const e=u.Zj(t.EntityResult);let s=h().cloneDeep(e);s.length>y.bM&&(s=s.slice(0,y.bM)),this.setState({tankCodeOptions:e,tankCodeSearchOptions:s})}}else console.log("Error in getTankCode:",t.ErrorList)})).catch((e=>{console.log("Error in getTankCode:",e)}))}getBaseProductCodes(){C()(p.mD_,u.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{const t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult&&void 0!==t.EntityResult){const e=[];for(let s in t.EntityResult)for(let a of t.EntityResult[s])e.push(a);this.setState({baseProductCodeOptions:u.Zj(e)})}}else console.log("Error in getBaseProductList:",t.ErrorList)})).catch((e=>{console.log("Error while getting Base Product List:",e)}))}getUOMs(){C()(p.WFM,u.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult&&Array.isArray(t.EntityResult.VOLUME)){const e=[],s=[];t.EntityResult.VOLUME.forEach((t=>{e.push({text:t,value:t})})),t.EntityResult.MASS.forEach((t=>{e.push({text:t,value:t}),s.push({text:t,value:t})})),this.setState({quantityUOMOptions:e,massQuantityUOMOptions:s})}}else console.log("Error in GetUOMList:",t.ErrorList)})).catch((e=>{console.log("Error in GetUOMList:",e)}))}getTankManualEntryData(e){C()(p.tOp+"?EntryDate="+e.toISOString(),u.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{const t=e.data;if(!0===t.IsSuccess){const e=null===t.EntityResult?[]:t.EntityResult;this.setState({isReadyToRender:!0,associations:e,modAssociations:h().cloneDeep(e),saveEnabled:u.ab(this.props.userDetails.EntityResult.FunctionsList,g.i.modify,g.No)})}else this.setState({isReadyToRender:!0,associations:[],modAssociations:[],saveEnabled:!1}),console.log("Error in getTankManualEntryData:",t.ErrorList)})).catch((e=>{console.log("Error while getting TankManualEntryData:",e)}))}getTankCodeSearchOptions(){return h().cloneDeep(this.state.tankCodeSearchOptions)}validateSave(e){const t={messageType:"critical",message:"TankEODEntry_SavedStatus",messageResultDetails:[]};return Array.isArray(e)&&e.length>0?e.forEach((e=>{E.uQ.forEach((s=>{let a="";void 0!==s.validator&&(a=u.jr(s.validator,e[s.field])),""!==a&&t.messageResultDetails.push({keyFields:[s.displayName],keyValues:[e[s.field]],isSuccess:!1,errorMessage:a})})),""===e.EOPMassVolume&&""!==e.MassQuantityUOM||""===e.MassQuantityUOM&&""!==e.EOPMassVolume?t.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"MassQtyMassUOM_ProvidedTogether"}):e.EOPMassVolume<0&&t.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"TankManualEntry_MassQtyNonNegative"})})):t.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"ERRMSG_RECONCILIATIONTANKDATALIST_EMPTY"}),!(t.messageResultDetails.length>0)||(this.props.onSaved(this.state.modRailReceipt,"update",t),!1)}updateTankEODData(e,t){const s=[{key:"EntryDate",value:this.state.entryDate}],a={ShareHolderCode:this.props.selectedShareholder,KeyCodes:s,Entity:t},n={messageType:"critical",message:"TankEODEntry_SavedStatus",messageResultDetails:[{keyFields:["TankEODEntry_EODEntryDate"],keyValues:[this.state.entryDate.toLocaleDateString()],isSuccess:!1,errorMessage:""}]};C()(e?p.Xhf:p.OPv,u.tW(a,this.props.tokenDetails.tokenInfo)).then((e=>{const t=e.data;n.messageType=t.IsSuccess?"success":"critical",n.messageResultDetails[0].isSuccess=t.IsSuccess,!0===t.IsSuccess?this.getTankManualEntryData(this.state.entryDate):(this.setState({saveEnabled:!0}),n.messageResultDetails[0].errorMessage=t.ErrorList[0],console.log("Error in updateTankEODData:",t.ErrorList)),this.props.onSaved(this.state.modAssociations,"update",n)})).catch((e=>{n.messageResultDetails[0].errorMessage=e,this.props.onSaved(this.state.modAssociations,"modify",n),this.setState({saveEnabled:!0})}))}render(){return this.state.isReadyToRender?(0,r.jsxs)("div",{children:[(0,r.jsx)(M.A,{children:(0,r.jsx)(c,{entryDate:this.state.entryDate,modAssociations:this.state.modAssociations,selectedAssociations:this.state.selectedAssociations,listOptions:{tankCode:this.getTankCodeSearchOptions(),baseProductCode:this.state.baseProductCodeOptions,quantityUOM:this.state.quantityUOMOptions,densityQuantityUOM:this.state.massQuantityUOMOptions},onFieldChange:this.handleChange,onTankSearchChange:this.handleTankSearchChange,handleAddAssociation:this.handleAddAssociation,handleDeleteAssociation:this.handleDeleteAssociation,handleAssociationSelectionChange:this.handleAssociationSelectionChange,handleCellDataEdit:this.handleCellDataEdit,isEnterpriseNode:this.props.userDetails.EntityResult.IsEnterpriseNode})}),(0,r.jsx)(M.A,{children:(0,r.jsx)(i.TranslationConsumer,{children:e=>(0,r.jsx)("div",{className:"row",children:(0,r.jsxs)("div",{className:"col",style:{textAlign:"right"},children:[(0,r.jsx)(o.Button,{content:e("LookUpData_btnReset"),className:"cancelButton",onClick:this.handleReset}),(0,r.jsx)(o.Button,{content:e("Save"),disabled:!this.state.saveEnabled,onClick:this.handleSave})]})})})}),this.state.showAuthenticationLayout?(0,r.jsx)(A.A,{Username:this.props.userDetails.EntityResult.UserName,functionName:g.i.add,functionGroup:g.No,handleOperation:this.handleTankManualEntry,handleClose:this.handleAuthenticationClose}):null]}):(0,r.jsx)(O.A,{message:"Loading"})}}const v=(0,S.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})),(e=>({userAction:(0,k.zH)(m,e)})))(T)},35861:(e,t,s)=>{s.d(t,{F1:()=>l,i7:()=>r,r4:()=>i});var a=s(86178),n=s.n(a),o=(s(15660),s(65043),s(70579));function i(e,t){if(Array.isArray(e)){0===e.filter((e=>e.text===t)).length&&e.unshift({value:null,text:t})}return e}function l(){let e=window.navigator.userLanguage||window.navigator.language;return n().locale(e),n().localeData().longDateFormat("L")}function r(e){return(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{children:e}),(0,o.jsx)("div",{class:"ui red circular empty label badge  circle-padding"})]})}}}]);
//# sourceMappingURL=4872.5a121e12.chunk.js.map