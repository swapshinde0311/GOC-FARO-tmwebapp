"use strict";(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[4199],{34199:(e,t,i)=>{i.r(t),i.d(t,{default:()=>E});var a=i(65043),s=i(78374),r=i(72711),l=i(67907),o=i(35861),d=i(70579);function n(e){let{modRailReceipt:t,modWeighBridgeData:i,listOptions:a,handleCellDataEdit:n,onDateTextChange:h}=e;const[g]=(0,l.useTranslation)(),c=(e,t)=>(0,d.jsx)(r.Select,{className:"selectDropwdown",value:i[e.rowIndex][e.field],fluid:!0,options:t,onChange:t=>n(t,e),indicator:"required",reserveSpace:!1,search:!0,noResultsMessage:g("noResultsMessage")}),m=e=>(0,d.jsx)(r.Input,{fluid:!0,value:i[e.rowIndex][e.field],onChange:t=>n(t,e),reserveSpace:!1}),p=e=>(0,d.jsx)("div",{style:{textAlign:"center"},children:(0,d.jsx)(r.Checkbox,{style:{textAlign:"center"},fluid:!0,checked:i[e.rowIndex][e.field],onChange:t=>n(t,e),reserveSpace:!1})}),u=e=>{const{value:t}=e;return"number"===typeof t?t.toLocaleString():t},W=e=>(0,d.jsx)(r.DatePicker,{fluid:!0,value:null===i[e.rowIndex][e.field]?"":new Date(i[e.rowIndex][e.field]),type:"datetime",minuteStep:5,displayFormat:(0,o.F1)(),indicator:"required",disableFuture:!0,onChange:t=>n(t,e),onTextChange:(t,i)=>{h(e,t,i)},reserveSpace:!1}),R=e=>{const{value:t}=e;return null!==t?new Date(t).toLocaleDateString()+" "+new Date(t).toLocaleTimeString():""};return(0,d.jsx)(l.TranslationConsumer,{children:e=>(0,d.jsxs)("div",{className:"detailsContainer",children:[(0,d.jsxs)("div",{className:"row",children:[(0,d.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,d.jsx)(r.Input,{fluid:!0,value:t.ReceiptCode,disabled:!0,label:e("Rail_Receipt_Code"),reserveSpace:!1})}),(0,d.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,d.jsx)(r.Input,{fluid:!0,value:t.Description,label:e("Rail_Receipt_Desc"),reserveSpace:!1})}),(0,d.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,d.jsx)(r.DatePicker,{fluid:!0,value:null===t.ScheduledDate?"":new Date(t.ScheduledDate),label:e("ViewShipment_ScheduleDate"),type:"datetime",disablePast:!0,disabled:!0,minuteStep:"5",reserveSpace:!1})}),(0,d.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,d.jsx)(r.Input,{fluid:!0,value:t.ReceiptStatus,label:e("Rail_Receipt_ReceiptStatus"),reserveSpace:!1,disabled:!0})}),(0,d.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,d.jsx)(r.Input,{fluid:!0,value:t.Remark,label:e("Reconciliation_Remarks"),reserveSpace:!1,disabled:!0})})]}),(0,d.jsx)("div",{className:"row",children:(0,d.jsx)("div",{className:"col-12 detailsTable",children:(0,d.jsxs)(s.bQ,{data:i,editable:!0,children:[(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"WagonCode",header:e("Rail_Wagon_Code")},"WagonCode"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"FinishedProductCode",header:e("Receipt_Product")},"FinishedProductCode"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"TareWeight",header:e("RailWagonConfigurationDetails_TareWeight"),editable:!0,editFieldType:"number",renderer:e=>u(e),customEditRenderer:m},"TareWeight"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"TareWeightUOM",header:e("ViewReceiptStatus_QuantityUOM")},"TareWeightUOM"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"TareWeightWeightBridgeCode",header:e("weighBridge_tare"),editable:!0,editFieldType:"text",customEditRenderer:e=>c(e,a.WeighBridges)},"TareWeightWeightBridgeCode"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"TareWeightOperatorOverWritten",header:e("Operator_OverWrite_Tare"),renderer:e=>p(e)},"TareWeightOperatorOverWritten"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"LadenWeight",header:e("PCDET_Planning_gvLadenWeight"),editable:!0,editFieldType:"number",renderer:e=>u(e),customEditRenderer:m},"LadenWeight"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"LadenWeightUOM",header:e("AtgConfigure_UOM")},"LadenWeightUOM"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"LadenWeightWeightBridgeCode",header:e("weighBridge_Laden"),editable:!0,customEditRenderer:e=>c(e,a.WeighBridges)},"LadenWeightWeightBridgeCode"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"StartTime",header:e("LoadingDetails_StartTime"),displayFormat:(0,o.F1)(),editable:!0,renderer:e=>R(e),customEditRenderer:e=>W(e)},"StartTime"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"EndTime",header:e("LoadingDetails_EndTime"),displayFormat:(0,o.F1)(),editable:!0,renderer:e=>R(e),customEditRenderer:e=>W(e)},"EndTime"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"LadenWeightOperatorOverWritten",header:e("Operator_OverWrite_Laden"),renderer:e=>p(e)},"LadenWeightOperatorOverWritten"),(0,d.jsx)(s.bQ.Column,{className:"compColHeight",field:"LoadingType",header:e("Bay_LoadType"),editable:!1,editFieldType:"text"},"LoadingType")]})})})]})})}n.defaultProps={};var h=i(46100),g=i(69062),c=i(40854),m=i.n(c),p=i(7523),u=i(72067),W=i(9966),R=i(50805),T=i(97508),C=(i(38726),i(65187)),D=i(43503),v=i(93779),S=i(53536),y=i.n(S),x=i(40252),L=i(28882);class f extends a.Component{constructor(){super(...arguments),this.state={modRailWagon:{},isReadyToRender:!0,selectedWagonRow:[],modWeighBridgeData:[],modRailReceipt:{},WeighBridges:[],WeighBridgesWithUOM:[]},this.handleDateTextChange=(e,t,i)=>{try{const a=y().cloneDeep(this.state.validationErrors),s=y().cloneDeep(this.state.modWeighBridgeData);a[e]=i,s[e]=t,this.setState({validationErrors:a,modWeighBridgeData:s})}catch(i){console.log("Error in RailReceiptRecordDetailsComposite: Error occurred on handleDateTextChange",i)}},this.handleCellDataEdit=(e,t)=>{let i=y().cloneDeep(this.state.modWeighBridgeData);if("TareWeightWeightBridgeCode"===t.field){this.state.WeighBridgesWithUOM.forEach((a=>{a.Code!==e||(i[t.rowIndex].TareWeightUOM=a.WeightUOM)}))}if("LadenWeightWeightBridgeCode"===t.field){this.state.WeighBridgesWithUOM.forEach((a=>{a.Code!==e||(i[t.rowIndex].LadenWeightUOM=a.WeightUOM)}))}i[t.rowIndex][t.field]=e,this.setState({modWeighBridgeData:i})},this.handleRecordWeight=()=>{let e=this.fillDetails();if(!this.validateSave())return;let t=[],i="",a="",s="",r={messageType:"critical",message:"ViewRailReceipt_RecordWeight_status",messageResultDetails:[]};if(e.forEach((e=>{a="",s="";let l=0,o=0;if(i=e.WagonCode,null!==e.TareWeight&&void 0!==e.TareWeight&&""!==e.TareWeight&&(l=g.bo(e.TareWeight),l<0&&r.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"Tareweight_Cannot_Be_less_than_Zero"})),null!==e.LadenWeight&&void 0!==e.LadenWeight&&""!==e.LadenWeight&&(o=g.bo(e.LadenWeight),o<0&&r.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"ladenweight_Cannot_Be_less_than_Zero"})),null!==e.TareWeightWeightBridgeCode&&void 0!==e.TareWeightWeightBridgeCode&&""!==e.TareWeightWeightBridgeCode&&(a=e.TareWeightWeightBridgeCode),null!==e.LadenWeightWeightBridgeCode&&void 0!==e.LadenWeightWeightBridgeCode&&""!==e.LadenWeightWeightBridgeCode&&(s=e.LadenWeightWeightBridgeCode),l>0&&""===a&&r.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"ViewReceipt_WBMandatory"}),o>0&&""===s&&r.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"ViewReceipt_WBMandatory"}),e.StartTime>=e.EndTime&&r.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"MarineReceiptManualEntry_ErrorUnloadTime"}),r.messageResultDetails.length>0)return this.props.onSaved(this.state.modRailReceipt,"update",r),!1;if(l>0){let s={};s.ReceiptCode=this.state.modRailReceipt.ReceiptCode,s.TrailerCode=i,s.MeasuredWeight=l,s.MeasuredWeightTime=new Date,s.IsTareWeight=!0,s.IsOperatorOverWritable=e.TareWeightOperatorOverWritten,s.WeighbridgeCode=a,s.WeightUOM=e.TareWeightUOM,s.ShareholderCode=this.getShareholder(),s.StartTime=e.StartTime,s.EndTime=e.EndTime,t.push(s)}if(o>0){let a={};a.ReceiptCode=this.state.modRailReceipt.ReceiptCode,a.TrailerCode=i,a.MeasuredWeight=o,a.MeasuredWeightTime=new Date,a.IsTareWeight=!1,a.IsOperatorOverWritable=e.LadenWeightOperatorOverWritten,a.WeighbridgeCode=s,a.WeightUOM=e.LadenWeightUOM,a.StartTime=e.StartTime,a.EndTime=e.EndTime,a.ShareholderCode=this.getShareholder(),t.push(a)}})),0===t.length)return r.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"ERRMSG_RAIL_RECEIPT_WAGON_WEIGHBRIDGE_INFO_EMPTY"}),this.props.onSaved(this.state.modRailReceipt,"update",r),!1;var l={ShareHolderCode:this.props.shareholderCode,Entity:t};r={messageType:"critical",message:"ViewRailReceipt_RecordWeight_status",messageResultDetails:[{keyFields:["RailReceiptManualEntry_ReceiptCode"],keyValues:[this.state.modRailReceipt.ReceiptCode],isSuccess:!1,errorMessage:""}]},m()(u.qZ3,g.tW(l,this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;r.messageType=t.IsSuccess?"success":"critical",r.messageResultDetails[0].isSuccess=t.IsSuccess,!1===t.IsSuccess&&(r.messageResultDetails[0].errorMessage=t.ErrorList[0],console.log("Error in RailReceiptRecordWeight:",t.ErrorList)),this.props.onSaved(this.state.modRailReceipt,"add",r)})).catch((e=>{console.log("Error while getting RailReceiptRecordWeight:",e)}))},this.handleBack=()=>{try{var{operationsVisibilty:e}={...this.state};this.setState({isWagonDetail:"false",isRDetails:"true",selectedRow:{},selectedItems:[],operationsVisibilty:e})}catch(t){console.log("RailReceiptViewAllComposite:Error occured on Back click",t)}}}componentWillReceiveProps(e){}getShareholder(){return this.props.shareholderCode}getRailReceipt(e){var t=this.getTransportationType();if(h.cE.TransportationType=t,void 0!==e.Common_Code){var i=[{key:v.eT,value:e.Common_Code},{key:v.v6,value:t}],a={ShareHolderCode:this.props.shareholderCode,keyDataCode:v.eT,KeyCodes:i};m()(u.ffd,g.tW(a,this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;!0===t.IsSuccess?this.setState({isReadyToRender:!0,modRailReceipt:y().cloneDeep(t.EntityResult),saveEnabled:!1}):(this.setState({modRailReceipt:y().cloneDeep(h.cE),isReadyToRender:!0}),console.log("Error in GetRailReceipt:",t.ErrorList))})).catch((e=>{console.log("Error while getting railReceipt:",e)}))}else this.setState({modRailReceipt:{...h.cE},modWeighBridgeData:[],isReadyToRender:!0})}componentDidMount(){try{g.pJ(this.props.userDetails.EntityResult.IsArchived),this.getRailReceipt(this.props.selectedRow),this.GetWeightBridgeCodes(),this.GetRailMarineDispatchReceiptWeighBridgeData()}catch(e){console.log("RailReceiptRecordWeightComposite:Error occured on componentDidMount",e)}}GetWeightBridgeCodes(){m()(u.UO$+"?Transportationtype="+p.LY.RAIL,g.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult){var i=[];t.EntityResult.Table.forEach((e=>{i.push({text:e.Code,value:e.Code})})),this.setState({WeighBridges:i,WeighBridgesWithUOM:t.EntityResult.Table})}}else this.setState({WeighBridges:[],WeighBridgesWithUOM:[]}),console.log("Error in GetWeightBridgeData:",t.ErrorList)})).catch((e=>{console.log("Error while GetWeightBridgeData List:",e)}))}GetRailMarineDispatchReceiptWeighBridgeData(){var e=this.getTransportationType(),t=[{key:"TransactionType",value:"Receipt"},{key:v.v6,value:e},{key:"DispatchReceiptCode",value:this.props.selectedRow.Common_Code}],i={ShareHolderCode:this.getShareholder(),keyDataCode:v.eT,KeyCodes:t};m()(u.iTT,g.tW(i,this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;!0===t.IsSuccess?this.setState({isReadyToRender:!0,modWeighBridgeData:t.EntityResult.Table,saveEnabled:!1}):(this.setState({isReadyToRender:!0,modWeighBridgeData:[],saveEnabled:!1}),console.log("Error in GetRailMarineDispatchReceiptWeighBridgeData:",t.ErrorList))})).catch((e=>{console.log("Error while getting GetRailMarineDispatchReceiptWeighBridgeData:",e)}))}getTransportationType(){return p.LY.RAIL}validateSave(){let e={messageType:"critical",message:"ViewRailReceipt_RecordWeight_status",messageResultDetails:[]};return Array.isArray(this.state.modWeighBridgeData)&&this.state.modWeighBridgeData.length>0?this.state.modWeighBridgeData.forEach((t=>{L.XQ.forEach((i=>{let a="";void 0!==i.validator&&(a=g.jr(i.validator,t[i.field])),""!==a&&e.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:a})}))})):e.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"ERRMSG_RAIL_RECEIPT_WAGON_WEIGHBRIDGE_INFO_EMPTY"}),!(e.messageResultDetails.length>0)||(this.props.onSaved(this.state.modRailReceipt,"update",e),!1)}fillDetails(){try{let e=y().cloneDeep(this.state.modWeighBridgeData),t=0;return e.forEach((i=>{null!==i.LadenWeight&&""!==i.LadenWeight&&(e[t].LadenWeight=i.LadenWeight.toLocaleString()),null!==i.TareWeight&&""!==i.TareWeight&&(e[t].TareWeight=i.TareWeight.toLocaleString()),null!==i.maxTolLadenWeight&&""!==i.maxTolLadenWeight&&(e[t].maxTolLadenWeight=i.maxTolLadenWeight.toLocaleString()),null!==i.maxTolTareWeight&&""!==i.maxTolTareWeight&&(e[t].maxTolTareWeight=i.maxTolTareWeight.toLocaleString()),null!==i.minTolLadenWeight&&""!==i.minTolLadenWeight&&(e[t].minTolLadenWeight=i.minTolLadenWeight.toLocaleString()),null!==i.minTolTareWeight&&""!==i.minTolTareWeight&&(e[t].minTolTareWeight=i.minTolTareWeight.toLocaleString())})),this.setState({modWeighBridgeData:e}),e}catch(e){console.log("RailReceiptRecordWeightDetailsComposite:Error occured on fillDetails",e)}}render(){const e=[{fieldName:"RailWagonConfigurationDetails_LastUpdatedTime",fieldValue:new Date(this.state.modRailWagon.LastUpdateTime).toLocaleDateString()+" "+new Date(this.state.modRailWagon.LastUpdateTime).toLocaleTimeString()},{fieldName:"RailWagonConfigurationDetails_LastActiveTime",fieldValue:void 0!==this.state.modRailWagon.LastActiveTime&&null!==this.state.modRailWagon.LastActiveTime?new Date(this.state.modRailWagon.LastActiveTime).toLocaleDateString()+" "+new Date(this.state.modRailWagon.LastActiveTime).toLocaleTimeString():""},{fieldName:"RailWagonConfigurationDetails_CreatedTime",fieldValue:new Date(this.state.modRailWagon.CreatedTime).toLocaleDateString()+" "+new Date(this.state.modRailWagon.CreatedTime).toLocaleTimeString()}];return this.state.isReadyToRender?(0,d.jsx)("div",{children:(0,d.jsxs)("div",{children:[(0,d.jsx)(C.A,{children:(0,d.jsx)(D.A,{newEntityName:"ViewRailReceiptsDetails_PageTitle",popUpContents:e})}),(0,d.jsx)(C.A,{children:(0,d.jsx)(n,{modRailReceipt:this.state.modRailReceipt,modWeighBridgeData:this.state.modWeighBridgeData,listOptions:{WeighBridges:this.state.WeighBridges},handleRecordWeight:this.handleRecordWeight,handleCellDataEdit:this.handleCellDataEdit,onDateTextChange:this.handleDateTextChange})}),(0,d.jsx)(C.A,{children:(0,d.jsx)(l.TranslationConsumer,{children:e=>(0,d.jsxs)("div",{className:"row",children:[(0,d.jsx)("div",{className:"col col-lg-8",children:(0,d.jsx)(r.Button,{className:"backButton",onClick:this.props.handleBack,content:e("Back")})}),(0,d.jsx)("div",{className:"col col-lg-4",style:{textAlign:"right"},children:(0,d.jsx)(r.Button,{content:e("btnRecordWeight"),className:"saveButton",onClick:this.handleRecordWeight})})]})})})]})}):(0,d.jsx)(x.A,{message:"Loading"})}}const E=(0,T.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})),(e=>({userActions:(0,R.zH)(W,e)})))(f)}}]);
//# sourceMappingURL=4199.7662fcdc.chunk.js.map