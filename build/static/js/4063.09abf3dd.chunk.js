"use strict";(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[4063],{66444:(e,t,i)=>{i.r(t),i.d(t,{default:()=>_});var a=i(65043),s=i(40854),o=i.n(s),r=i(53536),l=i.n(r),n=i(7523),d=i(72067),c=(i(92342),i(9966)),p=i(50805),h=i(97508),u=i(14159),m=i(11981),C=(i(63973),i(69062)),R=i(65187),g=i(93779),D=i(80312),y=i(40252),A=i(44192),b=i(46100),E=i(78374),S=i(72711),f=i(67907),T=i(24904),v=i(85800),L=i(35861),I=i(70579);function x(e){let{modRailReceiptCompartmentPlanList:t,railReceipt:i,modRailReceipt:s,modAssociations:o,validationErrors:r,listOptions:l,selectedCompRow:d,onFieldChange:c,onAllTerminalsChange:p,handleCellDataEdit:h,handleAttributeCellDataEdit:u,handleAssociationSelectionChange:m,handleAddAssociation:C,handleDeleteAssociation:g,isEnterpriseNode:D,viewTab:y,enableHSEInspection:A,selectedAttributeList:b,attributeValidationErrors:x,onTabChange:w,toggleExpand:O,handleCompAttributeCellDataEdit:P,compartmentDetailsPageSize:N,expandedRows:j,railLookUpData:M,WagonDetailTab:k,isTransloading:V,currentAccess:_}=e;const[U]=(0,f.useTranslation)(),W=(e,t)=>{let i=[];return i=e.find((e=>e.TerminalCode===t)),i.attributeValidationErrors},[F,Q]=(0,a.useState)(!1),[q,H]=(0,a.useState)([]),B=(e,t)=>(0,I.jsx)(S.Select,{className:"selectDropwdown",value:o[e.rowIndex][e.field],fluid:!0,options:t,onChange:t=>h(t,e),indicator:"required",reserveSpace:!1,search:!0,noResultsMessage:U("noResultsMessage")}),K=e=>(0,I.jsx)(S.Input,{fluid:!0,value:o[e.rowIndex][e.field],onChange:t=>h(t,e),reserveSpace:!1}),G=()=>_.ViewRailReceipt_Update?!_.ViewRailReceipt_Update:s.ReceiptStatus!==n.Mw.READY,Y=e=>{const t=e.rowData;try{return t.DataType.toLowerCase()===n.pe.STRING.toLowerCase()||t.DataType.toLowerCase()===n.pe.INT.toLowerCase()||t.DataType.toLowerCase()===n.pe.FLOAT.toLowerCase()||t.DataType.toLowerCase()===n.pe.LONG.toLowerCase()||t.DataType.toLowerCase()===n.pe.DOUBLE.toLowerCase()?(0,I.jsx)(S.Input,{fluid:!0,value:t.AttributeValue,disabled:t.IsReadonly,onChange:t=>P(e,t),reserveSpace:!1}):t.DataType.toLowerCase()===n.pe.BOOL.toLowerCase()?(0,I.jsx)(S.Checkbox,{checked:"true"===t.AttributeValue.toString().toLowerCase(),disabled:t.IsReadonly,onChange:t=>P(e,t)}):t.DataType.toLowerCase()===n.pe.DATETIME.toLowerCase()?(0,I.jsx)(S.DatePicker,{fluid:!0,value:null===t.AttributeValue||void 0===t.AttributeValue||""===t.AttributeValue?"":new Date(t.AttributeValue),disabled:t.IsReadonly,showYearSelector:"true",onChange:t=>P(e,t),reserveSpace:!1}):null}catch(i){console.log("TrailerDetails:Error occured on handleAttributeType",i)}},z=e=>e.rowData.IsMandatory?(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:e.rowData.AttributeName}),(0,I.jsx)("div",{class:"ui red circular empty label badge  circle-padding"})]}):(0,I.jsx)("div",{children:(0,I.jsx)("span",{children:e.rowData.AttributeName})}),J=e=>{const t=j.findIndex((t=>t.SequenceNo===e.rowData.compSequenceNo))>=0;return(0,I.jsxs)("div",{onClick:()=>O(e.rowData,t),className:"compartmentIcon gridButtonFontColor",children:[(0,I.jsx)("span",{children:U(t?"Hide_Attributes":"View_Attributes")}),(0,I.jsx)(S.Icon,{root:"common",name:t?"caret-up":"caret-down",className:"margin_l10"})]})};function Z(e){return Array.isArray(e.AttributesforUI)&&e.AttributesforUI.length>0?(0,I.jsx)("div",{className:"childTable ChildGridViewAllShipmentLoadingDetails",children:(0,I.jsxs)(E.bQ,{data:e.AttributesforUI,rows:N,children:[D?(0,I.jsx)(E.bQ.Column,{className:"compColHeight",field:"TerminalCode",header:U("CompartmentTerminal"),editable:!1},"TerminalCode"):"",(0,I.jsx)(E.bQ.Column,{className:"compColHeight",header:U("CompartmentAttributeName"),renderer:z,editable:!1},"AttributeName"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight",header:U("CompartmentAttributeValue"),renderer:Y}),Array.isArray(e.AttributesforUI)&&e.AttributesforUI.length>N?(0,I.jsx)(E.bQ.Pagination,{}):""]})}):(0,I.jsx)("div",{className:"compartmentIcon",children:(0,I.jsx)("div",{className:"gridButtonAlignLeft",children:U("CustomerInventory_NoRecordsFound")})})}return(0,I.jsx)(f.TranslationConsumer,{children:e=>(0,I.jsxs)("div",{className:"detailsContainer",children:[(0,I.jsxs)("div",{className:"row",children:[(0,I.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,I.jsx)(S.Input,{fluid:!0,value:s.ReceiptCode,indicator:"required",disabled:""!==i.ReceiptCode,onChange:e=>c("ReceiptCode",e),label:e("Rail_Receipt_Code"),error:e(r.ReceiptCode),reserveSpace:!1})}),(0,I.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,I.jsx)(S.DatePicker,{fluid:!0,value:null===s.ScheduledDate?"":new Date(s.ScheduledDate),label:e("Rail_Receipt_ArrivalDateTime"),type:"datetime",showYearSelector:"true",disablePast:!1,displayFormat:(0,L.F1)(),disabled:G()||0!==s.CreatedFromEntity,minuteStep:5,indicator:"required",onChange:e=>c("ScheduledDate",e),error:e(r.ScheduledDate),reserveSpace:!1})}),(0,I.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,I.jsx)(S.Input,{fluid:!0,value:s.Description,onChange:e=>c("Description",e),label:e("Rail_Receipt_Desc"),error:e(r.Description),disabled:G()||0!==s.CreatedFromEntity,reserveSpace:!1})}),(0,I.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,I.jsx)(S.Select,{fluid:!0,placeholder:"Select",indicator:"required",label:e("Rail_Receipt_QuantityUOM"),value:s.QuantityUOM,options:l.quantityUOMOptions,onChange:e=>{c("QuantityUOM",e)},disabled:G()||0!==s.CreatedFromEntity,error:e(r.QuantityUOM),reserveSpace:!1,search:!0,noResultsMessage:e("noResultsMessage")})}),(0,I.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,I.jsx)(S.Input,{fluid:!0,value:s.ReceiptStatus,onChange:e=>c("ReceiptStatus",e),label:e("Rail_Receipt_ReceiptStatus"),disabled:!0,reserveSpace:!1})}),D?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,I.jsx)(T.y,{terminalList:l.terminalCodes,selectedTerminal:s.TerminalCodes,error:r.TerminalCodes,onFieldChange:c,onCheckChange:p})}),""===i.ReceiptCode||void 0===i.ReceiptCode||null===i.ReceiptCode?"":(0,I.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,I.jsx)(S.Input,{fluid:!0,placeholder:"",label:e("Shipment_LoadedTerminal"),value:s.ActualTerminalCode,disabled:!0})})]}):""]}),b.length>0?b.map((t=>(0,I.jsx)(R.A,{children:(0,I.jsx)(S.Accordion,{children:(0,I.jsx)(S.Accordion.Content,{className:"attributeAccordian",title:D?t.TerminalCode+" - "+e("Attributes_Header"):e("Attributes_Header"),children:(0,I.jsx)(v.n,{selectedAttributeList:t.attributeMetaDataList,handleCellDataEdit:u,attributeValidationErrors:W(x,t.TerminalCode)})})})}))):null,(0,I.jsx)("div",{className:"shipmentTabAlignment",children:(0,I.jsxs)(S.Tab,{defaultActiveIndex:y,className:"col-12",onTabChange:w,children:[(0,I.jsxs)(S.Tab.Pane,{title:e("RailDispatchPlanDetail_PlanHeader"),children:[(0,I.jsxs)("div",{className:"row compartmentRow",children:[(0,I.jsx)("div",{className:"col col-md-8 col-lg-9 col col-xl-9"}),(0,I.jsx)("div",{className:"col col-md-4 col-lg-3 col-xl-3",children:(0,I.jsxs)("div",{className:"compartmentIconContainer",children:[(0,I.jsxs)("div",{onClick:C,className:"compartmentIcon",children:[(0,I.jsx)("div",{children:(0,I.jsx)(S.Icon,{root:"common",name:"badge-plus",size:"medium"})}),(0,I.jsx)("div",{className:"margin_l10",children:(0,I.jsx)("h5",{className:"font14",children:e("FinishedProductInfo_Add")})})]}),(0,I.jsxs)("div",{onClick:g,className:"compartmentIcon margin_l30",children:[(0,I.jsx)("div",{children:(0,I.jsx)(S.Icon,{root:"common",name:"delete",size:"medium"})}),(0,I.jsx)("div",{className:"margin_l10",children:(0,I.jsx)("h5",{className:"font14",children:e("DestAdd_Delete")})})]})]})})]}),(0,I.jsx)("div",{className:"row marginRightZero tableScroll",children:(0,I.jsx)("div",{className:"col-12 detailsTable",children:(0,I.jsxs)(E.bQ,{data:o,selectionMode:"multiple",selection:d,onSelectionChange:m,rowExpansionTemplate:Z,expandedRows:j,children:[(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"CarrierCompanyCode",header:(0,L.i7)(e("Rail_Receipt_Carrier")),editable:!G(),editFieldType:"text",customEditRenderer:e=>B(e,l.carrierCompanyOptions)},"CarrierCompanyCode"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"TrailerCode",header:(0,L.i7)(e("Rail_Receipt_Wagon")),editable:!G(),editFieldType:"text",customEditRenderer:e=>(e=>{let t=[];return null===l.railWagonOptions&&void 0===l.railWagonOptions||void 0!==l.railWagonOptions[e.rowData.CarrierCompanyCode]&&Array.isArray(l.railWagonOptions[e.rowData.CarrierCompanyCode])&&l.railWagonOptions[e.rowData.CarrierCompanyCode].forEach((e=>t.push({text:e,value:e}))),B(e,t)})(e)},"TrailerCode"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"ShareholderCode",header:(0,L.i7)(e("Rail_Receipt_Shareholder")),editable:!G(),editFieldType:"text",customEditRenderer:e=>B(e,l.shareholders)},"ShareholderCode"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"FinishedProductCode",header:(0,L.i7)(e("Rail_Receipt_Product")),editable:!G(),editFieldType:"text",customEditRenderer:e=>(e=>{let t=[];return void 0!==l.finishedProductOptions&&null!==l.finishedProductOptions&&void 0!==l.finishedProductOptions[e.rowData.ShareholderCode]&&Array.isArray(l.finishedProductOptions[e.rowData.ShareholderCode])&&l.finishedProductOptions[e.rowData.ShareholderCode].forEach((e=>t.push({text:e,value:e}))),B(e,t)})(e)},"FinishedProductCode"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"SupplierCode",header:(0,L.i7)(e("Rail_Receipt_Supplier")),editable:!G(),editFieldType:"text",customEditRenderer:e=>(e=>{let t=[];return void 0!==l.supplierDestinationOptions[e.rowData.ShareholderCode]&&null!==l.supplierDestinationOptions[e.rowData.ShareholderCode]&&Object.keys(l.supplierDestinationOptions[e.rowData.ShareholderCode]).forEach((e=>t.push({text:e,value:e}))),B(e,t)})(e)},"SupplierCode"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"OriginTerminalCode",header:(0,L.i7)(e("Rail_Receipt_OriginCode")),editable:!G(),editFieldType:"text",customEditRenderer:e=>(e=>{let t=[];return void 0!==l.supplierDestinationOptions[e.rowData.ShareholderCode]&&null!==l.supplierDestinationOptions[e.rowData.ShareholderCode]&&void 0!==l.supplierDestinationOptions[e.rowData.ShareholderCode][e.rowData.SupplierCode]&&Array.isArray(l.supplierDestinationOptions[e.rowData.ShareholderCode][e.rowData.SupplierCode])&&l.supplierDestinationOptions[e.rowData.ShareholderCode][e.rowData.SupplierCode].forEach((e=>t.push({text:e,value:e}))),B(e,t)})(e)},"OriginTerminalCode"),"1"===M.PlanType?(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"Quantity",header:(0,L.i7)(e("Rail_Receipt_Quantity")),editable:!G(),editFieldType:"number",renderer:e=>(e=>{const{value:t}=e;return"number"===typeof t?t.toLocaleString():t})(e),customEditRenderer:K},"Quantity"):null,"CLOSED"!==i.ReceiptStatus&&V?(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"IsTransloading",header:e("Device_Transloading"),renderer:e=>(e=>{let t=o.findIndex((t=>t.SequenceNo===e.rowData.SequenceNo));return(0,I.jsx)("div",{children:(0,I.jsx)(S.Checkbox,{checked:o[t][e.field],onClick:()=>{h("",e)}})})})(e)},"IsTransloading"):"",(0,I.jsx)(E.bQ.Column,{className:"expandedColumn",initialWidth:"200px",renderer:J})]})})})]}),k.map((i=>(0,I.jsx)(S.Tab.Pane,{title:e("ViewRailDispatchList_WagonDetails"),children:(0,I.jsx)("div",{className:"row marginRightZero tableScroll",children:(0,I.jsx)("div",{className:"col-12 detailsTable",children:(0,I.jsxs)(E.bQ,{data:t,scrollable:!0,children:[(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"TrailerCode",header:e("Rail_Wagon_Code")},"TrailerCode"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"CarrierCompanyCode",header:e("DriverInfo_Carrier")},"CarrierCompanyCode"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"FinishedProductCode",header:e("Rail_Receipt_Product")},"FinishedProductCode"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"ReceiptCompartmentStatus",header:e("Reconciliation_Status")},"ReceiptCompartmentStatus"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"PlannedQuantity",header:e("ViewShipmentCompartment_PlannedQuantity")},"PlannedQuantity"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"RevisedQuantity",header:e("ViewMarineShipmentList_RevisedPlannedQuantity")},"RevisedQuantity"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"UnloadedQuantity",header:e("ContractInfo_LoadedQty")},"UnloadedQuantity"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"TareWeight",header:e("Trailer_Tareweight")},"TareWeight"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"LadenWeight",header:e("PCDET_Planning_gvLadenWeight")},"LadenWeight"),(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"DiffWeight",header:e("Weight_Difference")},"DiffWeight"),A?(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"HSEInspectionStatus",header:e("VehHSE_InspectionStatus")},"HSEInspectionStatus"):null,(0,I.jsx)(E.bQ.Column,{className:"compColHeight colminWidth",field:"ForceComplete",header:e("ViewMarineReceiptList_ForceComplete"),renderer:e=>(e=>{let i=t.findIndex((t=>t.SequenceNo===e.rowData.SequenceNo));return(0,I.jsx)("div",{children:s.ReceiptStatus===n.a$.READY||t[i].ReceiptCompartmentStatus===n.gB.FORCE_COMPLETED||t[i].ReceiptCompartmentStatus===n.gB.UNLOADING||e.rowData.ReceiptCompartmentStatus===n.gB.FORCE_COMPLETED||e.rowData.ReceiptCompartmentStatus===n.gB.UNLOADING?(0,I.jsx)("div",{style:{textAlign:"center"},children:(0,I.jsx)(S.Checkbox,{checked:e.rowData.ReceiptCompartmentStatus===n.gB.FORCE_COMPLETED,disabled:!0})}):(0,I.jsx)("div",{style:{textAlign:"center"},children:(0,I.jsx)(S.Checkbox,{checked:t[i][e.field],disabled:!1,onClick:()=>{t[i][e.field]?h("",e):(H(e),Q(!0))}})})})})(e)},"ForceComplete")]})})})})))]})}),(0,I.jsx)(f.TranslationConsumer,{children:e=>(0,I.jsxs)(S.Modal,{open:F,size:"small",children:[(0,I.jsx)(S.Modal.Content,{children:(0,I.jsx)("div",{children:(0,I.jsx)("b",{children:e("ViewMarineReceipt_ForceCompleteConfirm")})})}),(0,I.jsxs)(S.Modal.Footer,{children:[(0,I.jsx)(S.Button,{type:"secondary",content:e("Cancel"),onClick:()=>{Q(!1)}}),(0,I.jsx)(S.Button,{type:"primary",content:e("PipelineDispatch_BtnSubmit"),onClick:()=>{Q(!1),h("",q)}})]})]})})]})})}x.defaultProps={isEnterpriseNode:!1};var w=i(9256),O=(i(38726),i(43503)),P=i(28882),N=i(15417),j=i(40510),M=i(39424),k=i(62900);class V extends a.Component{constructor(){var e;super(...arguments),e=this,this.state={isWagonDetail:"false",modRailReceiptCompartmentPlanList:[],railReceipt:l().cloneDeep(b.cE),modRailReceipt:{},modAssociations:[],weightBridgeData:[],modWeightBridgeData:[],validationErrors:C.Th(A.zw),selectedCompRow:[],isDetail:"false",selectedShareholder:"",selectedRow:{},selectedItems:[],shareholders:this.getShareholders(),quantityUOMOptions:[],carrierCompanyOptions:[],railWagonOptions:{},finishedProductOptions:{},supplierDestinationOptions:[],ViewUnloadingData:[],saveEnabled:!1,isViewAuditTrail:"false",tabActiveIndex:0,operationsVisibilty:{add:!1,save:!1,authorizeToLoad:!1,closeReceipt:!1,viewAuditTrail:!1,viewUnloadingDetails:!1,printRAN:!1,viewBOD:!1,printBOD:!1,bSIOutbound:!1,manualEntry:!1,adjustPlan:!1,forceComplete:!1},attribute:[],attributeMetaDataList:[],compartmentAttributeMetaDataList:[],selectedAttributeList:[],attributeValidationErrors:[],expandedRows:[],expandedCompDetailRows:[],additiveDetails:[],saveCompartmentEnable:!1,isTransloading:!1,railReceiptKPIList:[],maxNumberOfCompartments:60,showAuthenticationLayout:!1,tempRailReceipt:{}},this.operationPermissionControl=e=>{var{operationsVisibilty:t}={...this.state};e.indexOf(n.Fj.ViewRailReceipt_AuthorizeToUnload)>-1&&(t.authorizeToLoad=!0),e.indexOf(n.Fj.ViewRailReceipt_RecordWeight)>-1&&(t.recordWeight=!0),e.indexOf(n.Fj.ViewRailReceipt_CloseReceipt)>-1&&(t.closeReceipt=!0),e.indexOf(n.Fj.ViewRailReceipt_ViewAuditTrail)>-1&&(t.viewAuditTrail=!0),e.indexOf(n.Fj.ViewRailReceipt_ViewLoadingDetails)>-1&&(t.viewUnloadingDetails=!0),e.indexOf(n.Fj.ViewRailReceipt_PrintRAN)>-1&&(t.printRAN=!0),e.indexOf(n.Fj.ViewRailReceipt_ViewBOD)>-1&&(t.viewBOD=!0),e.indexOf(n.Fj.ViewRailReceipt_PrintBOD)>-1&&(t.printBOD=!0),e.indexOf(n.Fj.ViewRailReceipt_BISOutbound)>-1&&(t.bSIOutbound=!0),e.indexOf(n.Fj.ViewRailReceipt_ManualEntry)>-1&&(t.manualEntry=!0),this.setState({operationsVisibilty:t})},this.handleChange=(e,t)=>{try{const i=l().cloneDeep(this.state.modRailReceipt),a=l().cloneDeep(this.state.validationErrors);i[e]=t,"Active"===e&&t!==this.state.railReceipt.Active&&(i.Remarks=""),"TerminalCodes"===e&&this.terminalSelectionChange(t),this.setState({modRailReceipt:i}),void 0!==A.zw[e]&&(a[e]=C.jr(A.zw[e],t),this.setState({validationErrors:a}))}catch(i){console.log("RailReceiptDetailsComposite:Error occured on handleChange",i)}},this.handleReset=()=>{try{const e={...this.state.validationErrors},t=l().cloneDeep(this.state.railReceipt);Object.keys(e).forEach((function(t){e[t]=""})),this.setState({modRailReceipt:{...t},modAssociations:this.getAssociationsFromReceipt(t),validationErrors:e},(()=>{this.props.userDetails.EntityResult.IsEnterpriseNode?(this.terminalSelectionChange([]),this.handleResetAttributeValidationError()):(this.localNodeAttribute(),this.handleResetAttributeValidationError())}))}catch(e){console.log("RailReceiptDetailsComposite:Error occured on handleReset",e)}},this.saveRailReceipt=()=>{this.handleAuthenticationClose();try{this.setState({saveEnabled:!1});let e=l().cloneDeep(this.state.tempRailReceipt);""===this.state.railReceipt.ReceiptCode?this.createRailReceipt(e):this.updateRailReceipt(e)}catch(e){console.log("RailShipComposite : Error in addUpdateRailDispatch")}},this.handleSave=()=>{try{let h=l().cloneDeep(this.state.modRailReceipt);if(0===this.state.tabActiveIndex){h.RailMarineReceiptCompartmentDetailPlanList=this.getCompartmentsFromAssociations(this.state.modAssociations);let e=C.pI(this.state.selectedAttributeList);if(this.validateSave(h,e)){h=this.fillAttributeDetails(h,e);for(let e in h.RailMarineReceiptCompartmentDetailPlanList)h.RailMarineReceiptCompartmentDetailPlanList[e].Quantity=C.bo(h.RailMarineReceiptCompartmentDetailPlanList[e].Quantity);let t=!0!==this.props.userDetails.EntityResult.IsWebPortalUser,i=l().cloneDeep(h);this.setState({showAuthenticationLayout:t,tempRailReceipt:i},(()=>{!1===t&&this.saveRailReceipt()}))}else this.setState({saveEnabled:!0})}else{let h=l().cloneDeep(this.state.modRailReceiptCompartmentPlanList);var{operationsVisibilty:e}={...this.state};e.save=!1,this.setState({operationsVisibilty:e});for(var t=[],i=0;i<h.length;i++){var a=h[i].ReceiptCode,s=h[i].ForceComplete,r=this.props.selectedShareholder;if(!1!==s){var n={ForceCompleted:h[i].ForceComplete,CarrierCompanyCode:h[i].CarrierCompanyCode,TrailerCode:h[i].TrailerCode};t.push(n)}}var c={ShareHolderCode:r,KeyCodes:[{Key:"ReceiptCode",Value:a}],Entity:t},p={messageType:"critical",message:"Receipt_SavedStatus",messageResultDetails:[{keyFields:["Marine_ReceiptCompDetail_ShipmentNumber"],keyValues:[this.props.selectedRow.Common_Code],isSuccess:!1,errorMessage:""}]};o()(d.kvB,C.tW(c,this.props.tokenDetails.tokenInfo)).then((t=>{var i=t.data;if(p.messageType=i.IsSuccess?"success":"critical",p.messageResultDetails[0].isSuccess=i.IsSuccess,!0===i.IsSuccess){e.save=!0,this.getRailReceipt(this.props.selectedRow);for(var a=0;a<h.length;a++)null!==h[a].AdjustPlan&&(h[a].AdjustPlan=null);this.setState({operationsVisibilty:e,modRailReceiptCompartmentPlanList:h})}else p.messageResultDetails[0].errorMessage=i.ErrorList[0],e.save=!1,this.setState({operationsVisibilty:e}),console.log("Error in Save Compartment Details:",i.ErrorList);(0,u.toast)((0,I.jsx)(R.A,{children:(0,I.jsx)(m.A,{notificationMessage:p})}),{autoClose:"success"===p.messageType&&1e4})})).catch((e=>{throw e}))}}catch(h){console.log("RailReceiptDetailsComposite:Error occured on handleSave",h)}},this.handleAddAssociation=()=>{if(!this.props.userDetails.EntityResult.IsArchived)try{let e={AssociatedContractItems:null,AssociatedOrderItems:null,Attributes:[],CarrierCompanyCode:"",CompartmentCode:"1",CompartmentSeqNoInVehicle:null,FinishedProductCode:"",OriginTerminalCode:"",Quantity:0,QuantityUOM:"",ReceiptCode:"",SequenceNo:0,ShareholderCode:"",SupplierCode:"",TrailerCode:""},t=l().cloneDeep(this.state.modAssociations);e.ShareholderCode=this.props.selectedShareholder,e.SequenceNo=t.length+1,t.push(e);let i=l().cloneDeep(this.state.modRailReceipt);this.setState({modAssociations:t,selectedCompRow:[]},(()=>{if(!1===this.props.userDetails.EntityResult.IsEnterpriseNode){var e=l().cloneDeep(this.state.compartmentAttributeMetaDataList);e.length>0&&this.formCompartmentAttributes([e[0].TerminalCode])}else this.formCompartmentAttributes(i.TerminalCodes)}))}catch(e){console.log("RailReceiptDetailsComposite:Error occured on handleAddAssociation",e)}},this.handleDeleteAssociation=()=>{if(!this.props.userDetails.EntityResult.IsArchived)try{if(null!=this.state.selectedCompRow&&this.state.selectedCompRow.length>0&&this.state.modAssociations.length>0){let e=l().cloneDeep(this.state.modAssociations);this.state.selectedCompRow.forEach(((t,i)=>{e=e.filter(((e,i)=>e.SequenceNo!==t.SequenceNo))}));for(let t=0;t<e.length;t++)e[t].SequenceNo=t+1;this.setState({modAssociations:e})}this.setState({selectedCompRow:[]})}catch(e){console.log("RailReceiptDetailsComposite:Error occured on handleDeleteAssociation",e)}},this.handleDateTextChange=(e,t,i)=>{try{var{validationErrors:a}={...this.state.validationErrors},s=l().cloneDeep(this.state.modRailReceipt);a[e]=i,s[e]=t,this.setState({validationErrors:a,modRailReceipt:s})}catch(i){console.log("RailReceiptDetailsComposite:Error occured on handleDateTextChange",i)}},this.handleCellDataEdit=(e,t)=>{let i=l().cloneDeep(this.state.modAssociations),a=l().cloneDeep(this.state.modRailReceiptCompartmentPlanList);if(i[t.rowIndex][t.field]=e,"CarrierCompanyCode"===t.field){let a=this.state.carrierCompanyOptions;void 0!==a&&null!==a&&(void 0!==this.state.railWagonOptions[e]&&Array.isArray(this.state.railWagonOptions[e])&&1===this.state.railWagonOptions[e].length?i[t.rowIndex].TrailerCode=this.state.railWagonOptions[e][0]:i[t.rowIndex].TrailerCode="")}else if("SupplierCode"===t.field){let a=l().cloneDeep(this.state.supplierDestinationOptions);if(void 0!==a[i[t.rowIndex].ShareholderCode]&&null!==a[i[t.rowIndex].ShareholderCode]){let s=a[i[t.rowIndex].ShareholderCode];void 0!==s[e]&&Array.isArray(s[e])&&1===s[e].length?i[t.rowIndex].OriginTerminalCode=s[e][0]:i[t.rowIndex].OriginTerminalCode=""}}else if("ForceComplete"===t.field){let e=a.findIndex((e=>e.SequenceNo===t.rowData.SequenceNo));a[e][t.field]=!a[e][t.field]}else"IsTransloading"===t.field&&(i[t.rowIndex][t.field]=!t.rowData.IsTransloading);this.setState({modAssociations:i,modRailReceiptCompartmentPlanList:a})},this.handleAssociationSelectionChange=e=>{this.setState({selectedCompRow:e})},this.handleAllTerminalsChange=e=>{try{var t=l().cloneDeep(this.state.modRailReceipt);t.TerminalCodes=e?[...this.props.terminalCodes]:[],this.terminalSelectionChange(t.TerminalCodes),this.setState({modRailReceipt:t})}catch(i){console.log("RailReceiptDetailsComposite:Error occured on handleAllTerminasChange",i)}},this.handleTabChange=e=>{try{this.setState({tabActiveIndex:e}),0===e&&this.setState({saveEnabled:C.ab(this.props.userDetails.EntityResult.FunctionsList,D.i.modify,D.hD)&&("READY"===this.state.modRailReceipt.ReceiptStatus||this.props.currentAccess.ViewRailReceipt_Update)}),1===e&&this.setState({saveEnabled:this.checkCompartmentSaveEnabled(this.state.modRailReceiptCompartmentPlanList)&&C.ab(this.props.userDetails.EntityResult.FunctionsList,D.i.modify,D.hD)})}catch(t){console.log("RailDispatchDetailsComposite: Error occurred on handleTabChange",t)}},this.handleBack=()=>{try{this.setState({isReadyToRender:!0,isDetail:"false",ViewUnloadingData:[]})}catch(e){console.log("ViewMarineReceiptDetailsComposite:Error occured on handleBack",e)}},this.handleManualEntryTabChange=e=>{try{this.setState({manualEntryTabActiveIndex:e})}catch(t){console.log("RailDispatchDetailsComposite: Error occurred on handleManualEntryTabChange",t)}},this.handleAttributeCellDataEdit=(e,t)=>{try{e.DefaultValue=t,this.setState({attribute:e});const i=l().cloneDeep(this.state.attributeValidationErrors);i.forEach((i=>{i.TerminalCode===e.TerminalCode&&(i.attributeValidationErrors[e.Code]=C.I5(e,t))})),this.setState({attributeValidationErrors:i})}catch(i){console.log("TankDetailsComposite:Error occured on handleCellDataEdit",i)}},this.toggleExpand=function(t,i){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=e.state.expandedRows,o=s.findIndex((e=>e.SequenceNo===t.SequenceNo));i?a&&o>=0?(s.splice(o,1),s.push(t)):o>=0&&s.splice(o,1):o>=0?s=s.filter((e=>e.Code!==t.Code&&e.SequenceNo!==t.SequenceNo)):s.push(t),e.setState({expandedRows:s})},this.handleCompAttributeCellDataEdit=(e,t)=>{let i=l().cloneDeep(this.state.modAssociations),a=i.findIndex((t=>t.SequenceNo===e.rowData.compSequenceNo));a>=0&&("Bool"===e.rowData.DataType?"true"===e.rowData.AttributeValue?i[a].AttributesforUI[e.rowData.SeqNumber-1].AttributeValue="false":i[a].AttributesforUI[e.rowData.SeqNumber-1].AttributeValue="true":i[a].AttributesforUI[e.rowData.SeqNumber-1].AttributeValue=t),this.setState({modAssociations:i}),a>=0&&this.toggleExpand(i[a],!0,!0)},this.handleAuthenticationClose=()=>{this.setState({showAuthenticationLayout:!1})}}componentDidMount(){try{C.pJ(this.props.userDetails.EntityResult.IsArchived),this.getAttributes(this.props.selectedRow),this.getUoms(),this.getCarrierCompanyCodes(),this.getFinishedProductCodes(),this.getSupplierOriginTerminals(),this.getTransloading()}catch(e){console.log("RailReceiptDetailsComposite:Error occured on componentDidMount",e)}}getTransloading(){try{o()(d.xAA+"?LookUpTypeCode=Transloading",C.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{const t=e.data;if(!0===t.IsSuccess){let e=!1;"True"===t.EntityResult.RAILEnable&&(e=!0),this.setState({isTransloading:e})}else console.log("Error in getLookUpData: ",t.ErrorList)})).catch((e=>{console.log("MarineReceiptDetailsComposite: Error occurred on getLookUpData",e)})),o()(d.xAA+"?LookUpTypeCode=VirtualPreset",C.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;!0===t.IsSuccess&&(isNaN(parseInt(t.EntityResult["RailMaximumNumberOfWagonsPerTrain "]))||this.setState({maxNumberOfCompartments:parseInt(t.EntityResult["RailMaximumNumberOfWagonsPerTrain "])}))}))}catch(e){console.log("RailReceiptDetailsComposite: Error occurred on getTransloading",e)}}getShareholders(){return C.Zj(this.props.userDetails.EntityResult.ShareholderList)}fillDetails(){try{let e=l().cloneDeep(this.state.modRailReceipt),t=0;return e.RailMarineReceiptCompartmentDetailPlanList.forEach((i=>{null===i.Quantity&&""===i.Quantity||(e.RailMarineReceiptCompartmentPlanList[t].PlannedQuantity=i.Quantity.toLocaleString())})),this.setState({modRailReceipt:e}),e}catch(e){console.log("RailReceiptRecordWeightDetailsComposite:Error occured on fillDetails",e)}}componentWillReceiveProps(e){try{(""!==this.state.railReceipt.ReceiptCode&&void 0===e.selectedRow.Common_Code&&this.props.tokenDetails.tokenInfo===e.tokenDetails.tokenInfo||e.selectedRow.ReceiptStatus!==this.props.selectedRow.ReceiptStatus&&void 0!==this.props.selectedRow.ReceiptStatus)&&this.getRailReceipt(e.selectedRow);let t={...this.state.validationErrors};Object.keys(t).forEach((e=>{t[e]=""})),this.setState({validationErrors:t})}catch(t){console.log("MarineDispatchDetailsComposite:Error occured on componentWillReceiveProps",t)}}validateSave(e,t){var i=l().cloneDeep(this.state.validationErrors);Object.keys(A.zw).forEach((function(t){void 0!==e[t]&&(i[t]=C.jr(A.zw[t],e[t]))})),e.Active!==this.state.railReceipt.Active&&(null===e.Remarks||""===e.Remarks?i.Remarks="Rail_Receipt_RemarksRequired":delete i.Remarks);var a=l().cloneDeep(this.state.attributeValidationErrors);t.forEach((e=>{a.forEach((t=>{t.TerminalCode===e.TerminalCode&&e.attributeMetaDataList.forEach((e=>{t.attributeValidationErrors[e.Code]=C.I5(e,e.DefaultValue)}))}))})),this.setState({validationErrors:i,attributeValidationErrors:a});let s={messageType:"critical",message:"Receipt_SavedStatus",messageResultDetails:[]};Array.isArray(e.RailMarineReceiptCompartmentDetailPlanList)&&e.RailMarineReceiptCompartmentDetailPlanList.length>0?e.RailMarineReceiptCompartmentDetailPlanList.length<=this.state.maxNumberOfCompartments?e.RailMarineReceiptCompartmentDetailPlanList.forEach((t=>{P.eI.forEach((i=>{let a="";"Quantity"===i.field&&"2"===this.props.railLookUpData.PlanType||(void 0!==i.validator&&(a=C.jr(i.validator,t[i.field])),""!==a&&s.messageResultDetails.push({keyFields:["RailReceiptManualEntry_ReceiptCode",i.displayName],keyValues:[e.ReceiptCode,t[i.field]],isSuccess:!1,errorMessage:a}))}));let i=[];null!==t.AttributesforUI&&void 0!==t.AttributesforUI&&(i=t.AttributesforUI.filter((function(e){return t.Attributes.some((function(t){let i=t.ListOfAttributeData.findIndex((t=>t.AttributeCode===e.AttributeCode))>=0;return e.TerminalCode===t.TerminalCode&&i}))}))),i.forEach((e=>{let i=C.I5(e,e.AttributeValue);""!==i&&(this.props.userDetails.EntityResult.IsEnterpriseNode?s.messageResultDetails.push({keyFields:["CompAttributeComp","CompAttributeTerminal",e.AttributeName],keyValues:[t.Code,e.TerminalCode,e.AttributeValue],isSuccess:!1,errorMessage:i}):s.messageResultDetails.push({keyFields:["CompAttributeComp",e.AttributeName],keyValues:[t.Code,e.AttributeValue],isSuccess:!1,errorMessage:i}))})),this.toggleExpand(t,!0,!0)})):s.messageResultDetails.push({keyFields:["RailReceiptManualEntry_ReceiptCode"],keyValues:[e.ReceiptCode],isSuccess:!1,errorMessage:"Wagon_limit_Exceeded"}):s.messageResultDetails.push({keyFields:[],keyValues:[],isSuccess:!1,errorMessage:"ERRMSG_RAILRECEIPT_COMP_PLAN_LIST_EMPTY"}),this.setState({validationErrors:i});var o=Object.values(i).every((function(e){return""===e}));return s.messageResultDetails.length>0?(this.props.onSaved(this.state.modRailReceipt,"update",s),!1):(a.forEach((e=>{if(!o)return o;o=Object.values(e.attributeValidationErrors).every((function(e){return""===e}))})),o)}createRailReceipt(e){var t=[{key:g.eT,value:e.ReceiptCode}];e.RailMarineReceiptCompartmentPlanList=[],e.RailMarineReceiptCompartmentDetailPlanList.forEach((t=>{e.RailMarineReceiptCompartmentPlanList.push({ShareHolderCode:t.ShareholderCode,FinishedProductCode:t.FinishedProductCode,CompartmentCode:t.CompartmentCode,TrailerCode:t.TrailerCode,PlannedQuantity:t.Quantity,PlanQuantityUOM:t.QuantityUOM,CompartmentSeqNoInVehicle:null,Attributes:[],AssociatedContractItems:null,ReceiptCompartmentTanks:null})}));var i={ShareHolderCode:this.props.userDetails.EntityResult.PrimaryShareholder,keyDataCode:g.eT,KeyCodes:t,Entity:e},a={messageType:"critical",message:"Receipt_SavedStatus",messageResultDetails:[{keyFields:["RailReceiptManualEntry_ReceiptCode"],keyValues:[e.ReceiptCode],isSuccess:!1,errorMessage:""}]};o()(d.vCX,C.tW(i,this.props.tokenDetails.tokenInfo)).then((t=>{var i=t.data;a.messageType=i.IsSuccess?"success":"critical",a.messageResultDetails[0].isSuccess=i.IsSuccess,!0===i.IsSuccess?this.getRailReceipt({Common_Code:e.ReceiptCode}):(a.messageResultDetails[0].errorMessage=i.ErrorList[0],this.setState({saveEnabled:!0}),console.log("Error in CreateRailReceipt:",i.ErrorList)),this.props.onUpdateStatusOperation(e),this.props.onSaved(e,"add",a)})).catch((t=>{this.setState({saveEnabled:!0}),a.messageResultDetails[0].errorMessage=t,this.props.onSaved(e,"add",a)}))}updateRailReceipt(e){var t=[{key:g.eT,value:this.state.modRailReceipt.ReceiptCode}];e.RailMarineReceiptCompartmentDetailPlanList.forEach((t=>{e.RailMarineReceiptCompartmentPlanList[0].ShareholderCode=t.ShareholderCode,e.RailMarineReceiptCompartmentPlanList[0].FinishedProductCode=t.FinishedProductCode,e.RailMarineReceiptCompartmentPlanList[0].CompartmentCode=t.CompartmentCode,e.RailMarineReceiptCompartmentPlanList[0].TrailerCode=t.TrailerCode,e.RailMarineReceiptCompartmentPlanList[0].PlannedQuantity=t.Quantity,e.RailMarineReceiptCompartmentPlanList[0].PlanQuantityUOM=t.QuantityUOM,e.RailMarineReceiptCompartmentPlanList[0].Attributes=t.Attributes}));var i={ShareHolderCode:this.props.userDetails.EntityResult.PrimaryShareholder,keyDataCode:g.eT,KeyCodes:t,Entity:e},a={messageType:"critical",message:"Receipt_SavedStatus",messageResultDetails:[{keyFields:["RailReceiptManualEntry_ReceiptCode"],keyValues:[e.ReceiptCode],isSuccess:!1,errorMessage:""}]};o()(d.WeR,C.tW(i,this.props.tokenDetails.tokenInfo)).then((t=>{var i=t.data;a.messageType=i.IsSuccess?"success":"critical",a.messageResultDetails[0].isSuccess=i.IsSuccess,!0===i.IsSuccess?this.getRailReceipt({Common_Code:e.ReceiptCode}):(this.setState({saveEnabled:!0}),a.messageResultDetails[0].errorMessage=i.ErrorList[0]),this.props.onSaved(e,"update",a)})).catch((t=>{a.messageResultDetails[0].errorMessage=t,this.props.onSaved(e,"modify",a),this.setState({saveEnabled:!0})}))}getTransportationType(){var e=n.LY.RAIL;const{genericProps:t}=this.props;return void 0!==t&&void 0!==t.transportationType&&(e=t.transportationType),e}getUoms(){o()(d.WFM,C.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult&&Array.isArray(t.EntityResult.VOLUME)){var i=l().cloneDeep(this.state.quantityUOMOptions);t.EntityResult.VOLUME.forEach((e=>{i.push({text:e,value:e})})),t.EntityResult.MASS.forEach((e=>{i.push({text:e,value:e})})),this.setState({quantityUOMOptions:i})}}else console.log("Error in GetUOMList:",t.ErrorList)})).catch((e=>{console.log("Error in GetUOMList:",e)}))}getCarrierCompanyCodes(){o()(d.Xj6+"?ShareholderCode=&Transportationtype="+n.LY.RAIL,C.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult&&Array.isArray(t.EntityResult)){let e=l().cloneDeep(this.state.carrierCompanyOptions);t.EntityResult.forEach((t=>{e.push({text:t,value:t})})),this.setState({carrierCompanyOptions:e}),this.getTrailerCodes(t.EntityResult)}}else console.log("Error in GetCarrierListForRole:",t.ErrorList)})).catch((e=>{console.log("Error while getting Carrier List:",e)}))}getTrailerCodes(e){e.forEach((e=>o()(d.VCb+"?CarrierCompanyCode="+e+"&Transportationtype="+n.LY.RAIL,C.Jm(this.props.tokenDetails.tokenInfo)).then((t=>{let i=t.data;if(!0===i.IsSuccess){if(null!==i.EntityResult&&Array.isArray(i.EntityResult.RailWagonList)){let t=l().cloneDeep(this.state.railWagonOptions);t[e]=i.EntityResult.RailWagonList,this.setState({railWagonOptions:t})}}else console.log("Error in GetCarrierListForRole:",i.ErrorList)})).catch((e=>{console.log("Error while getting Carrier List:",e)}))))}getFinishedProductCodes(){o()(d.Ypw+"?ShareholderCode=&Transportationtype="+n.LY.RAIL,C.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult){let e=t.EntityResult;this.setState({finishedProductOptions:e})}}else console.log("Error in GetFinishedProductCodes:",t.ErrorList)})).catch((e=>{console.log("Error while GetFinishedProductCodes List:",e)}))}getSupplierOriginTerminals(){o()(d._fS+"?ShareholderCode=&Transportationtype="+n.LY.RAIL,C.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{let t=e.data;if(!0===t.IsSuccess)if(Array.isArray(t.EntityResult)){let e={};t.EntityResult.forEach((t=>{e[t.ShareholderCode]=t.SupplierOriginTerminalsList})),this.setState({supplierDestinationOptions:e})}else console.log("customerdestinations not identified for shareholder");else console.log("Error in getOriginTerminals:",t.ErrorList)})).catch((e=>{console.log("Error while getOriginTerminals List:",e)}))}getRailReceipt(e){var t=this.getTransportationType();if(b.cE.TransportationType=t,b.cE.QuantityUOM=this.props.userDetails.EntityResult.PageAttibutes.DefaultQtyUOMForTransactionUI.RAIL,void 0===e.Common_Code)return this.handleResetAttributeValidationError(),void this.setState({railReceipt:{...b.cE},modRailReceipt:{...b.cE},modAssociations:[],modRailReceiptCompartmentPlanList:[],selectedAttributeList:[],isDetail:"true",saveEnabled:C.ab(this.props.userDetails.EntityResult.FunctionsList,D.i.add,D.hD)},(()=>{this.props.userDetails.EntityResult.IsEnterpriseNode?this.terminalSelectionChange([]):this.localNodeAttribute()}));var i=[{key:g.eT,value:e.Common_Code},{key:g.v6,value:t}],a={ShareHolderCode:this.props.selectedShareholder,keyDataCode:g.eT,KeyCodes:i};o()(d.ffd,C.tW(a,this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;!0===t.IsSuccess?(this.props.onUpdateStatusOperation(t.EntityResult),"READY"===t.EntityResult.ReceiptStatus?this.setState({isDetail:"true",railReceipt:l().cloneDeep(t.EntityResult),modRailReceipt:l().cloneDeep(t.EntityResult),modAssociations:this.getAssociationsFromReceipt(t.EntityResult),saveEnabled:C.ab(this.props.userDetails.EntityResult.FunctionsList,D.i.modify,D.hD)},(()=>{this.getKPIList(t.EntityResult.ReceiptCode),this.props.userDetails.EntityResult.IsEnterpriseNode?this.terminalSelectionChange(this.state.modRailReceipt.TerminalCodes):this.localNodeAttribute()})):this.setState({isDetail:"true",railReceipt:l().cloneDeep(t.EntityResult),modRailReceipt:l().cloneDeep(t.EntityResult),modAssociations:this.getAssociationsFromReceipt(t.EntityResult),saveEnabled:this.props.currentAccess.ViewRailReceipt_Update},(()=>{this.getKPIList(t.EntityResult.ReceiptCode),this.props.userDetails.EntityResult.IsEnterpriseNode?this.terminalSelectionChange([t.EntityResult.TerminalCode]):this.localNodeAttribute()})),this.getRailReceiptWeighBridgeData(t.EntityResult)):(this.setState({railReceipt:l().cloneDeep(b.cE),modRailReceipt:l().cloneDeep(b.cE),isDetail:"true"}),console.log("Error in GetRailReceipt:",t.ErrorList))})).catch((e=>{console.log("Error while getting railReceipt:",e)}))}getWagonHseInspectionStatus(e){o()(d.TKi+"?TransactionType=Receipt&DispatchReceiptCode="+e+"&ShareholderCode="+this.props.selectedShareholder,C.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{const t=e.data;if(!0===t.IsSuccess&&null!==t.EntityResult&&Array.isArray(t.EntityResult.Table)){const e=l().cloneDeep(this.state.modRailReceiptCompartmentPlanList);for(let i of t.EntityResult.Table)for(let t of e)if(t.TrailerCode===i.Code){i.HseInspectionStatus===n.P6.NOT_DONE&&(t.HSEInspectionStatus="NOT_DONE"),i.HseInspectionStatus===n.P6.PASS&&(t.HSEInspectionStatus="PASS"),i.HseInspectionStatus===n.P6.FAIL&&(t.HSEInspectionStatus="FAIL"),i.HseInspectionStatus===n.P6.INPROGRESS&&(t.HSEInspectionStatus="INPROGRESS");break}this.setState({modRailReceiptCompartmentPlanList:e})}else console.log("Error in getWagonHseInspectionStatus: ",t.ErrorList)})).catch((e=>{console.log("Error while getWagonHseInspectionStatus: ",e)}))}getRailReceiptWeighBridgeData(e){const t=[{key:"TransactionType",value:"Receipt"},{key:g.v6,value:n.LY.RAIL},{key:"DispatchReceiptCode",value:e.ReceiptCode}],i={ShareHolderCode:this.props.selectedShareholder,keyDataCode:g.eT,KeyCodes:t};o()(d.iTT,C.tW(i,this.props.tokenDetails.tokenInfo)).then((t=>{const i=t.data;!0===i.IsSuccess&&null!==i.EntityResult&&Array.isArray(i.EntityResult.Table)?(this.setState({weightBridgeData:i.EntityResult.Table,modWeightBridgeData:l().cloneDeep(i.EntityResult.Table)}),this.setmodRailReceiptCompartmentPlanListFromReceipt(e,i.EntityResult.Table)):(this.setState({weightBridgeData:[],modWeightBridgeData:[]}),this.setmodRailReceiptCompartmentPlanListFromReceipt(e,i.EntityResult.Table))})).catch((e=>{this.setState({weightBridgeData:[],modWeightBridgeData:[]}),console.log("Error while getting GetRailMarineDispatchReceiptWeighBridgeData:",e)}))}setmodRailReceiptCompartmentPlanListFromReceipt(e,t){const i=[];Array.isArray(e.RailMarineReceiptCompartmentPlanList)&&e.RailMarineReceiptCompartmentPlanList.forEach((e=>{let a;for(let i of t)if(i.WagonCode===e.TrailerCode){a=i;break}const s={ReceiptCode:e.ReceiptCode,TrailerCode:e.TrailerCode,CarrierCompanyCode:e.CarrierCompanyCode,FinishedProductCode:e.FinishedProductCode,ReceiptCompartmentStatus:(0,C.cd)(n.vy,e.ReceiptCompartmentStatus),SequenceNo:e.SequenceNo,PlannedQuantity:null!==e.PlannedQuantity&&""!==e.PlannedQuantity?e.PlannedQuantity.toLocaleString()+(e.PlanQuantityUOM?" "+e.PlanQuantityUOM:""):"",RevisedQuantity:null!==e.AdjustedPlanQuantity&&""!==e.AdjustedPlanQuantity?e.AdjustedPlanQuantity.toLocaleString()+(e.PlanQuantityUOM?" "+e.PlanQuantityUOM:""):"",UnloadedQuantity:null!==e.UnloadedQuantity&&""!==e.UnloadedQuantity?e.UnloadedQuantity.toLocaleString()+(e.UnloadedQuantityUOM?" "+e.UnloadedQuantityUOM:""):"",TareWeight:"",LadenWeight:"",DiffWeight:"",HSEInspectionStatus:"",ForceComplete:!1};if(s.ReceiptCompartmentStatus!==n.gB.FORCE_COMPLETED&&1===this.state.tabActiveIndex&&this.setState({saveEnabled:!0}),void 0!==a){let e=!1,t=!1;""!==a.TareWeight&&null!==a.TareWeight&&(e=!0,s.TareWeight=Math.round(a.TareWeight).toLocaleString()+" "+a.TareWeightUOM),""!==a.LadenWeightInDispatchReceiptUOM&&null!==a.LadenWeightInDispatchReceiptUOM&&(t=!0,s.LadenWeight=Math.round(a.LadenWeight).toLocaleString()+" "+a.LadenWeightUOM),e&&t?s.DiffWeight=Math.round(a.LadenWeight-a.TareWeight).toLocaleString()+" "+a.DispatchReceiptUOM:!e&&t?s.DiffWeight=s.LadenWeight:e&&!t&&(0===Math.round(a.TareWeight)?s.DiffWeight=s.TareWeight:s.DiffWeight="-"+s.TareWeight)}this.getWagonHseInspectionStatus(e.ReceiptCode),i.push(s)})),this.setState({modRailReceiptCompartmentPlanList:i})}generateCompartmentCode(e){var t=0;return null===e||0===e.length?1:(e.forEach((e=>{var i=e.CompartmentCode;if((null!==i||""!==i)&&!isNaN(parseInt(i))){let e=parseInt(i);e>t&&(t=e)}})),t+1)}getAssociationsFromReceipt(e){let t=[];return Array.isArray(e.RailMarineReceiptCompartmentDetailPlanList)&&e.RailMarineReceiptCompartmentDetailPlanList.forEach((e=>{t.push({AssociatedContractItems:e.AssociatedContractItems,AssociatedOrderItems:e.AssociatedOrderItems,Attributes:e.Attributes,CarrierCompanyCode:e.CarrierCompanyCode,CompartmentCode:e.CompartmentCode,CompartmentSeqNoInVehicle:e.CompartmentSeqNoInVehicle,FinishedProductCode:e.FinishedProductCode,OriginTerminalCode:e.OriginTerminalCode,Quantity:null!==e.Quantity&&""!==e.Quantity?e.Quantity.toLocaleString():null,IsTransloading:e.IsTransloading,QuantityUOM:e.QuantityUOM,ReceiptCode:e.ReceiptCode,SequenceNo:e.SequenceNo,ShareholderCode:e.ShareholderCode,SupplierCode:e.SupplierCode,TrailerCode:e.TrailerCode})})),t}getCompartmentsFromAssociations(e){let t=[];return Array.isArray(e)&&e.forEach((e=>{(null!==e.FinishedProductCode&&""!==e.FinishedProductCode||null!==e.SupplierCode&&""!==e.SupplierCode||null!==e.OriginTerminalCode&&""!==e.OriginTerminalCode)&&t.push({AssociatedContractItems:e.AssociatedContractItems,AssociatedOrderItems:e.AssociatedOrderItems,Attributes:e.Attributes,AttributesforUI:e.AttributesforUI,CarrierCompanyCode:e.CarrierCompanyCode,CompartmentCode:e.CompartmentCode,CompartmentSeqNoInVehicle:e.CompartmentSeqNoInVehicle,FinishedProductCode:e.FinishedProductCode,OriginTerminalCode:e.OriginTerminalCode,Quantity:e.Quantity,IsTransloading:e.IsTransloading,QuantityUOM:this.state.modRailReceipt.QuantityUOM,ReceiptCode:this.state.modRailReceipt.ReceiptCode,SequenceNo:e.SequenceNo,ShareholderCode:e.ShareholderCode,SupplierCode:e.SupplierCode,TrailerCode:e.TrailerCode})})),t}checkCompartmentSaveEnabled(e){if(null===e)return!1;for(let t of e){if(t.ReceiptCompartmentStatus!==n.gB.FORCE_COMPLETED)return!0}return!1}getAttributes(e){try{o()(d.fKH,C.tW([N.QY,N.Ps],this.props.tokenDetails.tokenInfo)).then((t=>{var i=t.data;!0===i.IsSuccess?this.setState({attributeMetaDataList:l().cloneDeep(i.EntityResult),attributeValidationErrors:C.Fl(i.EntityResult.RAILRECEIPTPLAN),compartmentAttributeMetaDataList:l().cloneDeep(i.EntityResult.RAILRECEIPTWAGONDETAILPLAN)},(()=>this.getRailReceipt(e))):console.log("Error in getAttributes:")}))}catch(t){console.log("Error while getAttributes:",t)}}fillAttributeDetails(e,t){try{return t=C.SC(t),e.Attributes=[],t.forEach((t=>{let i={ListOfAttributeData:[]};i.TerminalCode=t.TerminalCode,t.attributeMetaDataList.forEach((e=>{i.ListOfAttributeData.push({AttributeCode:e.Code,AttributeValue:e.DefaultValue})})),e.Attributes.push(i)})),e.RailMarineReceiptCompartmentDetailPlanList.forEach((t=>{let i=[];if(this.props.userDetails.EntityResult.IsEnterpriseNode)i=l().cloneDeep(e.TerminalCodes);else{var a=l().cloneDeep(this.state.compartmentAttributeMetaDataList);a.length>0&&(i=[a[0].TerminalCode])}let s=[];t.Attributes=[],null===i&&(i=[]),i.forEach((e=>{null!==t.AttributesforUI&&void 0!==t.AttributesforUI&&(s=t.AttributesforUI.filter((function(t){return t.TerminalCode===e})));let i={ListOfAttributeData:[]};i.TerminalCode=e,s.forEach((e=>{""===e.AttributeValue&&!0!==e.IsMandatory||i.ListOfAttributeData.push({AttributeCode:e.AttributeCode,AttributeValue:e.AttributeValue})})),null!==i.ListOfAttributeData&&void 0!==i.ListOfAttributeData&&i.ListOfAttributeData.length>0&&t.Attributes.push(i)}))})),this.setState({modRailReceipt:e}),e}catch(i){console.log("RailReceiptDetailsComposite:Error occured on fillAttributeDetails",i)}}terminalSelectionChange(e){try{if(null==e&&(e=[]),void 0!==e&&null!==e){let s=[];var t=[],i=[];t=l().cloneDeep(this.state.attributeMetaDataList),i=l().cloneDeep(this.state.selectedAttributeList);const o=l().cloneDeep(this.state.attributeValidationErrors);var a=l().cloneDeep(this.state.modRailReceipt);e.forEach((e=>{var o=i.find((t=>t.TerminalCode===e));void 0===o?t.RAILRECEIPTPLAN.forEach((function(t){if(t.TerminalCode===e){var i=a.Attributes.find((t=>t.TerminalCode===e));void 0!==i&&t.attributeMetaDataList.forEach((function(e){var t=i.ListOfAttributeData.find((t=>t.AttributeCode===e.Code));void 0!==t&&(e.DefaultValue=t.AttributeValue)})),s.push(t)}})):s.push(o)})),i=[],i=s,i=C.nQ(i),o.forEach((t=>{void 0===e.find((e=>t.TerminalCode===e))&&Object.keys(t.attributeValidationErrors).forEach((e=>t.attributeValidationErrors[e]=""))})),this.formCompartmentAttributes(e),this.setState({selectedAttributeList:i,attributeValidationErrors:o})}}catch(s){console.log("RailReceiptDetailsComposite:Error occured on terminalSelectionChange",s)}}localNodeAttribute(){try{var e=l().cloneDeep(this.state.attributeMetaDataList);Array.isArray(e.RAILRECEIPTPLAN)&&e.RAILRECEIPTPLAN.length>0&&this.terminalSelectionChange([e.RAILRECEIPTPLAN[0].TerminalCode]);var t=l().cloneDeep(this.state.compartmentAttributeMetaDataList);Array.isArray(t)&&t.length>0&&this.formCompartmentAttributes([t[0].TerminalCode])}catch(i){console.log("RailReceiptDetailsComposite:Error occured on localNodeAttribute",i)}}handleResetAttributeValidationError(){try{var e=l().cloneDeep(this.state.attributeMetaDataList);this.setState({attributeValidationErrors:C.Fl(e.RAILRECEIPTPLAN)})}catch(t){console.log("handleAttributeValidationError:Error occured on handleReset",t)}}formCompartmentAttributes(e){try{let t=l().cloneDeep(this.state.compartmentAttributeMetaDataList);t=t.filter((function(t){return e.some((function(e){return t.TerminalCode===e}))}));let i=l().cloneDeep(this.state.modAssociations),a=[];t.forEach((e=>{e.attributeMetaDataList.forEach((e=>{a.push({AttributeCode:e.Code,AttributeName:e.DisplayName,AttributeValue:e.DefaultValue,TerminalCode:e.TerminalCode,IsMandatory:e.IsMandatory,DataType:e.DataType,IsReadonly:e.IsReadonly,compSequenceNo:""})}))}));let s=l().cloneDeep(a);i.forEach((t=>{if(null!==t.ReceiptCode&&""!==t.ReceiptCode||null!==t.AttributesforUI&&void 0!==t.AttributesforUI){null!==t.AttributesforUI&&void 0!==t.AttributesforUI?(t.AttributesforUI=t.AttributesforUI.filter((function(t){return e.some((function(e){return t.TerminalCode===e}))})),a=a.filter((function(e){return!t.AttributesforUI.some((function(t){return e.TerminalCode===t.TerminalCode}))}))):t.AttributesforUI=[];let i=l().cloneDeep(a);if(Array.isArray(t.Attributes)&&null!==t.Attributes&&void 0!==t.Attributes&&t.Attributes.length>0){t.Attributes.filter((function(t){return e.some((function(e){return t.TerminalCode===e}))})).forEach((e=>{e.ListOfAttributeData.forEach((t=>{let a=i.findIndex((i=>i.TerminalCode===e.TerminalCode&&i.AttributeCode===t.AttributeCode));a>=0&&(i[a].AttributeValue=t.AttributeValue)}))})),i.forEach((e=>{e.compSequenceNo=t.SequenceNo,t.AttributesforUI.push(e)}))}else{l().cloneDeep(a).forEach((e=>{e.compSequenceNo=t.SequenceNo,t.AttributesforUI.push(e)}))}}else t.AttributesforUI=[],s.forEach((e=>{e.compSequenceNo=t.SequenceNo,t.AttributesforUI.push(e)}));this.toggleExpand(t,!0,!0),t.AttributesforUI=C.Q3(t.AttributesforUI)})),this.setState({modAssociations:i})}catch(t){console.log("RailReceiptDetailsComposite:Error in forming Compartment Attributes",t)}}getKPIList(e){if(!0===C.ab(this.props.userDetails.EntityResult.FunctionsList,D.i.view,D.bL)){let t={PageName:M.Bl,TransportationType:n.LY.RAIL,InputParameters:[{key:"ReceiptCode",value:e}]};o()(d.dxq,C.tW(t,this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;!0===t.IsSuccess?this.setState({railReceiptKPIList:t.EntityResult.ListKPIDetails}):(this.setState({railReceiptKPIList:[]}),console.log("Error in pipeline KPIList:",t.ErrorList))})).catch((e=>{console.log("Error while getting PipelineDispatch KPIList:",e)}))}}render(){const e=[{fieldName:"ViewRailReceiptDetails_LastUpdatedTime",fieldValue:new Date(this.state.modRailReceipt.LastUpdatedTime).toLocaleDateString()+" "+new Date(this.state.modRailReceipt.LastUpdatedTime).toLocaleTimeString()},{fieldName:"ViewRailReceiptDetails_LastActiveTime",fieldValue:void 0!==this.state.modRailReceipt.LastActiveTime&&null!==this.state.modRailReceipt.LastActiveTime?new Date(this.state.modRailReceipt.LastActiveTime).toLocaleDateString()+" "+new Date(this.state.modRailReceipt.LastActiveTime).toLocaleTimeString():""},{fieldName:"ViewRailReceiptDetails_CreatedTime",fieldValue:new Date(this.state.modRailReceipt.CreatedTime).toLocaleDateString()+" "+new Date(this.state.modRailReceipt.CreatedTime).toLocaleTimeString()}];return"true"===this.state.isDetail?(0,I.jsxs)("div",{children:[(0,I.jsx)(R.A,{children:(0,I.jsx)(O.A,{entityCode:this.state.railReceipt.ReceiptCode,newEntityName:"Rail_Receipt_NewReceipt",popUpContents:e})}),(0,I.jsx)(j.A,{KPIList:this.state.railReceiptKPIList,children:" "}),(0,I.jsx)(R.A,{children:(0,I.jsx)(x,{operationsVisibilty:this.state.operationsVisibilty,modRailReceiptCompartmentPlanList:this.state.modRailReceiptCompartmentPlanList,selectedCompRow:this.state.selectedCompRow,railReceipt:this.state.railReceipt,modRailReceipt:this.state.modRailReceipt,modAssociations:this.state.modAssociations,validationErrors:this.state.validationErrors,listOptions:{shareholders:this.state.shareholders,terminalCodes:this.props.terminalCodes,quantityUOMOptions:this.state.quantityUOMOptions,carrierCompanyOptions:this.state.carrierCompanyOptions,railWagonOptions:this.state.railWagonOptions,finishedProductOptions:this.state.finishedProductOptions,supplierDestinationOptions:this.state.supplierDestinationOptions},onFieldChange:this.handleChange,onAllTerminalsChange:this.handleAllTerminalsChange,handleAssociationSelectionChange:this.handleAssociationSelectionChange,handleCellDataEdit:this.handleCellDataEdit,handleAttributeCellDataEdit:this.handleAttributeCellDataEdit,handleAddAssociation:this.handleAddAssociation,handleDeleteAssociation:this.handleDeleteAssociation,isEnterpriseNode:this.props.userDetails.EntityResult.IsEnterpriseNode,attributeValidationErrors:this.state.attributeValidationErrors,selectedAttributeList:this.state.selectedAttributeList,viewTab:this.props.viewTab,onTabChange:this.handleTabChange,handleCompAttributeCellDataEdit:this.handleCompAttributeCellDataEdit,toggleExpand:this.toggleExpand,expandedRows:this.state.expandedRows,compartmentDetailsPageSize:this.props.userDetails.EntityResult.PageAttibutes.WebPortalListPageSize,enableHSEInspection:this.props.enableHSEInspection,railLookUpData:this.props.railLookUpData,WagonDetailTab:""===this.state.railReceipt.ReceiptCode||null===this.state.railReceipt.ReceiptCode||void 0===this.state.railReceipt.ReceiptCode?[]:[""],isTransloading:this.state.isTransloading,currentAccess:this.props.currentAccess})}),(0,I.jsx)(R.A,{children:(0,I.jsx)(w.q,{handleBack:this.props.onBack,handleSave:this.handleSave,handleReset:this.handleReset,saveEnabled:this.state.saveEnabled})}),this.state.showAuthenticationLayout?(0,I.jsx)(k.A,{Username:this.props.userDetails.EntityResult.UserName,functionName:""===this.state.railReceipt.ReceiptCode?D.i.add:D.i.modify,functionGroup:D.hD,handleOperation:this.saveRailReceipt,handleClose:this.handleAuthenticationClose}):null]}):(0,I.jsx)(y.A,{message:"Loading"})}}const _=(0,h.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})),(e=>({userActions:(0,p.zH)(c,e)})))(V)},24904:(e,t,i)=>{i.d(t,{y:()=>l});i(65043);var a=i(67907),s=i(72711),o=i(69062),r=i(70579);function l(e){let{terminalList:t,selectedTerminal:i,validationError:l,onFieldChange:n,onCheckChange:d}=e;return null===i&&(i=[]),(0,r.jsx)(a.TranslationConsumer,{children:e=>(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,r.jsx)("div",{style:{width:"80%"},children:(0,r.jsx)(s.Select,{fluid:!0,placeholder:e("Common_Select"),label:e("TerminalCodes"),value:i,multiple:!0,options:o.Zj(t),onChange:e=>n("TerminalCodes",e),error:e(l),disabled:0===t.length,reserveSpace:!1})}),(0,r.jsx)("div",{className:"ddlSelectAll",children:(0,r.jsx)(s.Checkbox,{label:e("Common_All"),checked:Array.isArray(i)&&i.length===t.length,onChange:e=>d(e)})})]})})}l.defaultProps={terminalList:[],selectedTerminal:[],validationError:""}}}]);
//# sourceMappingURL=4063.09abf3dd.chunk.js.map