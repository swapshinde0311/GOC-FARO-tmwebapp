"use strict";(self.webpackChunktmwebapp=self.webpackChunktmwebapp||[]).push([[3624],{53624:(e,t,s)=>{s.r(t),s.d(t,{default:()=>W});var a=s(65043),i=s(69062),o=s(40854),l=s.n(o),r=s(72067),n=s(72711),c=s(67907),d=s(78374),h=s(7523),m=s(70579);function p(e){const t=e.value;if("boolean"===typeof t)return t?(0,m.jsx)(n.Icon,{name:"check",size:"small",color:"green"}):(0,m.jsx)(n.Icon,{name:"close",size:"small",color:"red"})}function b(e){let{webPortalUser:t,modWebPortalUser:s,validationErrors:a,onFieldChange:i,listOptions:o,userChange:l,handleAvailableEntitySelection:r,handleAssociatedEntitySelection:b,handleEntityAssociation:E,handleEntityDisassociation:u,pageSize:y}=e;return(0,m.jsx)(c.TranslationConsumer,{children:e=>(0,m.jsxs)("div",{className:"detailsContainer",children:[(0,m.jsxs)("div",{className:"row",children:[(0,m.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:""===t.UserName?(0,m.jsx)(n.Select,{fluid:!0,placeholder:e("Common_Select"),label:e("WebPortal_Username"),value:s.UserName,options:o.securityUsers,onChange:e=>{l(e)},indicator:"required",error:e(a.UserName),reserveSpace:!1,search:!0,noResultsMessage:e("noResultsMessage")}):(0,m.jsx)(n.Input,{fluid:!0,value:s.UserName,indicator:"required",disabled:!0,label:e("WebPortal_Username"),error:e(a.UserName),reserveSpace:!1})}),(0,m.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,m.jsx)(n.Input,{fluid:!0,value:s.UserPrincipal,indicator:"required",onChange:e=>i("UserPrincipal",e),label:e("WebPortal_UserPrincipal"),error:e(a.UserPrincipal),reserveSpace:!1,disabled:""!==t.UserName})}),(0,m.jsx)("div",{className:"col-12 col-md-6 col-lg-4",children:(0,m.jsx)(n.Input,{fluid:!0,value:s.RoleName,label:e("WebPortal_Role"),reserveSpace:!1,disabled:!0})})]}),o.availableEntities.length>0||s.WebPortalUserEntityItems.length>0?(0,m.jsxs)("div",{className:"row",children:[(0,m.jsxs)("div",{className:"col-12 col-md-5 col-lg-5",children:[(0,m.jsx)("h4",{children:e("WebPortal_AvailableEntity")}),(0,m.jsx)("div",{className:"detailsTable",children:(0,m.jsxs)(d.bQ,{data:o.availableEntities,search:!0,selectionMode:"multiple",selection:o.selectedAvailableEntities,onSelectionChange:r,rows:y,searchPlaceholder:e("LoadingDetailsView_SearchGrid"),children:[(0,m.jsx)(d.bQ.Column,{className:"compColHeight",field:"Code",header:e("WebPortal_Entity"),editFieldType:"text"},"Code"),(0,m.jsx)(d.bQ.Column,{className:"compColHeight",field:"ShareholderCode",header:e("AccessCardInfo_Shareholder"),editFieldType:"text"},"ShareholderCode"),Array.isArray(o.availableEntities)&&o.availableEntities.length>y?(0,m.jsx)(d.bQ.Pagination,{}):""]})})]}),(0,m.jsxs)("div",{className:"col-12 col-md-2 col-lg-2",children:[(0,m.jsx)("br",{}),(0,m.jsx)("br",{}),(0,m.jsxs)("div",{style:{textAlign:"center"},children:[(0,m.jsx)(n.Button,{type:"primary",icon:(0,m.jsx)(n.Icon,{name:"caret-right",root:"common"}),content:"",iconPosition:"right",onClick:E,disabled:s.RoleName===h.Av.SHAREHOLDER}),(0,m.jsx)("br",{}),(0,m.jsx)("br",{}),(0,m.jsx)(n.Button,{type:"primary",icon:(0,m.jsx)(n.Icon,{name:"caret-left",root:"common"}),content:"",iconPosition:"right",onClick:u,disabled:s.RoleName===h.Av.SHAREHOLDER})]})]}),(0,m.jsxs)("div",{className:"col-12 col-md-5 col-lg-5",children:[(0,m.jsx)("h4",{children:e("WebPortal_AssociatedEntity")}),(0,m.jsx)("div",{className:"detailsTable",children:(0,m.jsxs)(d.bQ,{data:s.WebPortalUserEntityItems,search:!0,selectionMode:"multiple",selection:o.selectedAssociatedEntities,onSelectionChange:b,rows:y,searchPlaceholder:e("LoadingDetailsView_SearchGrid"),children:[(0,m.jsx)(d.bQ.Column,{className:"compColHeight",field:"Code",header:e("WebPortal_Entity"),editFieldType:"text"},"Code"),(0,m.jsx)(d.bQ.Column,{className:"compColHeight",field:"ShareholderCode",header:e("AccessCardInfo_Shareholder"),editFieldType:"text"},"ShareholderCode"),(0,m.jsx)(d.bQ.Column,{className:"compColHeight",field:"IsEntityActive",header:e("TankGroupInfo_Active"),editable:!1,renderer:p,editFieldType:"text"},"IsEntityActive"),Array.isArray(s.WebPortalUserEntityItems)&&s.WebPortalUserEntityItems.length>y?(0,m.jsx)(d.bQ.Pagination,{}):""]})})]})]}):null]})})}b.defaultProps={listOptions:{securityUsers:[],availableEntities:[],selectedAvailableEntities:[],selectedAssociatedEntities:[]}};var E=s(9256),u=s(97508),y=s(46100),v=s(44192),U=(s(38726),s(65187)),P=s(43503),g=s(40252),S=s(53536),D=s.n(S),C=s(80312);class R extends a.Component{constructor(){super(...arguments),this.state={webPortalUser:D().cloneDeep(y.v1),modWebPortalUser:{},validationErrors:i.Th(v.GV),isReadyToRender:!1,saveEnabled:!1,securityUsers:[],availableEntities:[],selectedAvailableEntites:[],selectedAssociatedEntities:[],entityDisassociationPopUp:!1},this.handleChange=(e,t)=>{try{const s=D().cloneDeep(this.state.modWebPortalUser);s[e]=t,this.setState({modWebPortalUser:s});const a=D().cloneDeep(this.state.validationErrors);void 0!==v.GV[e]&&(a[e]=i.jr(v.GV[e],t),this.setState({validationErrors:a}))}catch(s){console.log("WebPortalUserMapDetailsComposite:Error occured on handleChange",s)}},this.handleReset=()=>{try{const{validationErrors:e}={...this.state},t=D().cloneDeep(this.state.webPortalUser);Object.keys(e).forEach((function(t){e[t]=""})),this.setState({modWebPortalUser:{...t},selectedCompRow:[],validationErrors:e,availableEntities:[],selectedAvailableEntites:[],selectedAssociatedEntities:[],isReadyToRender:!1},(()=>{void 0!==t.UserName&&null!==t.UserName&&""!==t.UserName?this.getEntityForPortalUser(t.UserName):this.setState({isReadyToRender:!0})}))}catch(e){console.log("WebPortalUserMapDetailsComposite:Error occured on handleReset",e)}},this.handleUserChange=e=>{try{let t=D().cloneDeep(y.v1);const s=D().cloneDeep(this.state.validationErrors);s.UserName="",t.UserName=e,this.setState({modWebPortalUser:t,validationErrors:s,selectedAssociatedEntities:[],selectedAvailableEntites:[]},(()=>{this.getEntityForPortalUser(e)}))}catch(t){console.log("WebPortalUserMapDetailsComposite:Error occured on handleUserChange",t)}},this.getEntityForPortalUser=e=>{try{let t=D().cloneDeep(this.state.modWebPortalUser);l()(r.QA6+"?userName="+e+"&entityType=",i.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var s=e.data;!0===s.IsSuccess?(t.RoleName=s.EntityResult.Table[0].RoleName,s.EntityResult.Table[0].RoleName===h.Av.SHAREHOLDER?(t.WebPortalUserEntityItems=s.EntityResult.Table1,this.setState({availableEntities:[],modWebPortalUser:t,isReadyToRender:!0})):this.setState({availableEntities:s.EntityResult.Table1,modWebPortalUser:t,isReadyToRender:!0})):console.log("Error in GetEntityForPortalUser:",s.ErrorList)}))}catch(t){console.log("WebPortalUserMapDetailsComposite:Error occured on getEntityForPortalUser",t)}},this.handleAvailableEntitySelection=e=>{this.setState({selectedAvailableEntites:e})},this.handleAssociatedEntitySelection=e=>{this.setState({selectedAssociatedEntities:e})},this.handleEntityAssociation=()=>{try{this.setState({isReadyToRender:!1},(()=>{const e=D().cloneDeep(this.state.selectedAvailableEntites);let t=D().cloneDeep(this.state.availableEntities),s=D().cloneDeep(this.state.modWebPortalUser);e.forEach((e=>{s.WebPortalUserEntityItems.push(e),t=t.filter((t=>t.Code!==e.Code))})),this.setState({modWebPortalUser:s,selectedAvailableEntites:[],availableEntities:t,isReadyToRender:!0})}))}catch(e){console.log("WebPortalUserMapDetailsComposite:Error occured on handleEntityAssociation",e)}},this.handleEntityDisassociation=()=>{this.state.selectedAssociatedEntities.length>0&&this.setState({entityDisassociationPopUp:!0})},this.EntityDisassociation=()=>{try{this.setState({isReadyToRender:!1},(()=>{const e=D().cloneDeep(this.state.selectedAssociatedEntities);let t=D().cloneDeep(this.state.modWebPortalUser),s=D().cloneDeep(this.state.availableEntities);e.forEach(((e,a)=>{s.push(e),t.WebPortalUserEntityItems=t.WebPortalUserEntityItems.filter(((t,s)=>t.Code!==e.Code))})),this.setState({selectedAssociatedEntities:[],modWebPortalUser:t,availableEntities:s,isReadyToRender:!0})}))}catch(e){console.log("WebPortalUserMapDetailsComposite:Error occured on handleEntityDisassociation",e)}},this.confirmEntityDisassociation=()=>(0,m.jsx)(c.TranslationConsumer,{children:e=>(0,m.jsxs)(n.Modal,{open:this.state.entityDisassociationPopUp,size:"small",children:[(0,m.jsx)(n.Modal.Content,{children:(0,m.jsx)("div",{className:"col col-lg-12",children:(0,m.jsx)("h5",{children:e("WebPortal_ConfirmDisassociation")})})}),(0,m.jsxs)(n.Modal.Footer,{children:[(0,m.jsx)(n.Button,{type:"primary",content:e("AccessCardInfo_Ok"),onClick:()=>{this.setState({entityDisassociationPopUp:!1},(()=>{this.EntityDisassociation()}))}}),(0,m.jsx)(n.Button,{type:"primary",content:e("Cancel"),onClick:()=>{this.setState({entityDisassociationPopUp:!1})}})]})]})}),this.handleSave=()=>{try{let e=this.fillDetails();this.setState({saveEnabled:!1}),this.validateSave(e)?""===this.state.webPortalUser.UserName?this.createWebPortalUser(e):this.updateWebPortalUser(e):this.setState({saveEnabled:!0})}catch(e){console.log("WebPortalUserMapDetailsComposite:Error occured on handleSave",e)}}}componentDidMount(){try{i.pJ(this.props.userDetails.EntityResult.IsArchived),this.getWebPortalUser(this.props.selectedRow),this.GetSecurityUsers()}catch(e){console.log("WebPortalUserMapDetailsComposite:Error occured on componentDidMount",e)}}componentWillReceiveProps(e){try{if(""!==this.state.webPortalUser.UserName&&void 0===e.selectedRow.WebPortal_UserName&&this.props.tokenDetails.tokenInfo===e.tokenDetails.tokenInfo){this.getWebPortalUser(e.selectedRow);let t={...this.state.validationErrors};Object.keys(t).forEach((e=>{t[e]=""})),this.setState({validationErrors:t})}}catch(t){console.log("WebPortalUserMapDetailsComposite:Error occured on componentWillReceiveProps",t)}}getWebPortalUser(e){void 0!==e.WebPortal_UserName?l()(r.mBC+"?userName="+e.WebPortal_UserName,i.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;!0===t.IsSuccess?this.setState({isReadyToRender:!1,webPortalUser:D().cloneDeep(t.EntityResult),modWebPortalUser:D().cloneDeep(t.EntityResult),saveEnabled:i.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,C.Ee)},(()=>{this.getEntityForPortalUser(t.EntityResult.UserName)})):this.setState({webPortalUser:D().cloneDeep(y.v1),modWebPortalUser:D().cloneDeep(y.v1),isReadyToRender:!0})})):this.setState({webPortalUser:D().cloneDeep(y.v1),modWebPortalUser:D().cloneDeep(y.v1),isReadyToRender:!0,saveEnabled:i.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,C.Ee),availableEntities:[]},(()=>{this.GetSecurityUsers()}))}GetSecurityUsers(){try{l()(r.lVD,i.Jm(this.props.tokenDetails.tokenInfo)).then((e=>{var t=e.data;if(!0===t.IsSuccess){if(null!==t.EntityResult&&Array.isArray(t.EntityResult)){let e=i.Zj(t.EntityResult);this.setState({securityUsers:e})}}else console.log("Error in getUsers:",t.ErrorList)}))}catch(e){console.log("Error while getting getUsers:",e)}}fillDetails(){try{let e=D().cloneDeep(this.state.modWebPortalUser),t=[];return e.WebPortalUserEntityItems.forEach((e=>{let s={EntityType:void 0===e.EntityType?e.Entity:e.EntityType,Code:e.Code,ShareholderCode:e.ShareholderCode};t.push(s)})),e.WebPortalUserEntityItems=t,this.setState({modWebPortalUser:e}),e}catch(e){console.log("WebPortalUserMapDetailsComposite:Error occured on fillDetails",e)}}validateSave(e){const t={...this.state.validationErrors};Object.keys(v.GV).forEach((function(s){void 0!==e[s]&&(t[s]=i.jr(v.GV[s],e[s]))})),this.setState({validationErrors:t});let s={messageType:"critical",message:"WebPortaUserMap_SavedStatus",messageResultDetails:[]};0===e.WebPortalUserEntityItems.length&&s.messageResultDetails.push({keyFields:["WebPortal_UserName"],keyValues:[e.UserName],isSuccess:!1,errorMessage:"ASSOCIATED_ENTITY_ITEMS_EMPTY_X"});let a=Object.values(t).every((function(e){return""===e}));return s.messageResultDetails.length>0?(this.props.onSaved(this.state.modWebPortalUser,"update",s),!1):a}createWebPortalUser(e){let t={Entity:e},s={messageType:"critical",message:"WebPortaUserMap_SavedStatus",messageResultDetails:[{keyFields:["WebPortal_UserName"],keyValues:[e.UserName],isSuccess:!1,errorMessage:""}]};l()(r._K5,i.tW(t,this.props.tokenDetails.tokenInfo)).then((t=>{let a=t.data;s.messageType=a.IsSuccess?"success":"critical",s.messageResultDetails[0].isSuccess=a.IsSuccess,!0===a.IsSuccess?this.setState({saveEnabled:i.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,C.Ee)},(()=>this.getWebPortalUser({WebPortal_UserName:e.UserName}))):(s.messageResultDetails[0].errorMessage=a.ErrorList[0],this.setState({saveEnabled:i.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,C.Ee)}),console.log("Error in createWebPortalUser:",a.ErrorList)),this.props.onSaved(this.state.modWebPortalUser,"add",s)})).catch((e=>{this.setState({saveEnabled:i.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.add,C.Ee)}),s.messageResultDetails[0].errorMessage=e,this.props.onSaved(this.state.modWebPortalUser,"add",s)}))}updateWebPortalUser(e){let t={Entity:e},s={messageType:"critical",message:"WebPortaUserMap_SavedStatus",messageResultDetails:[{keyFields:["WebPortal_UserName"],keyValues:[e.UserName],isSuccess:!1,errorMessage:""}]};l()(r.rqn,i.tW(t,this.props.tokenDetails.tokenInfo)).then((t=>{let a=t.data;s.messageType=a.IsSuccess?"success":"critical",s.messageResultDetails[0].isSuccess=a.IsSuccess,!0===a.IsSuccess?this.setState({saveEnabled:i.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,C.Ee)},(()=>this.getWebPortalUser({WebPortal_UserName:e.UserName}))):(s.messageResultDetails[0].errorMessage=a.ErrorList[0],this.setState({saveEnabled:i.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,C.Ee)}),console.log("Error in update updateWebPortalUser:",a.ErrorList)),this.props.onSaved(this.state.modWebPortalUser,"update",s)})).catch((e=>{this.setState({saveEnabled:i.ab(this.props.userDetails.EntityResult.FunctionsList,C.i.modify,C.Ee)}),s.messageResultDetails[0].errorMessage=e,this.props.onSaved(this.state.modWebPortalUser,"modify",s)}))}render(){const e={securityUsers:this.state.securityUsers,availableEntities:this.state.availableEntities,selectedAvailableEntities:this.state.selectedAvailableEntites,selectedAssociatedEntities:this.state.selectedAssociatedEntities};return this.state.isReadyToRender?(0,m.jsxs)("div",{children:[(0,m.jsx)(U.A,{children:(0,m.jsx)(P.A,{entityCode:this.state.webPortalUser.UserName,newEntityName:"WebPortalUserAssociation",popUpContents:[]})}),(0,m.jsx)(U.A,{children:(0,m.jsx)(b,{webPortalUser:this.state.webPortalUser,modWebPortalUser:this.state.modWebPortalUser,listOptions:e,validationErrors:this.state.validationErrors,onFieldChange:this.handleChange,onActiveStatusChange:this.handleActiveStatusChange,onAllTerminalsChange:this.handleAllTerminalsChange,isEnterpriseNode:this.props.userDetails.EntityResult.IsEnterpriseNode,attributeValidationErrors:this.state.attributeValidationErrors,selectedAttributeList:this.state.selectedAttributeList,handleCellDataEdit:this.handleCellDataEdit,userChange:this.handleUserChange,handleAvailableEntitySelection:this.handleAvailableEntitySelection,handleAssociatedEntitySelection:this.handleAssociatedEntitySelection,handleEntityAssociation:this.handleEntityAssociation,handleEntityDisassociation:this.handleEntityDisassociation,pageSize:this.props.userDetails.EntityResult.PageAttibutes.WebPortalListPageSize})}),(0,m.jsx)(U.A,{children:(0,m.jsx)(E.q,{handleBack:this.props.onBack,handleSave:this.handleSave,handleReset:this.handleReset,saveEnabled:this.state.saveEnabled})}),this.state.entityDisassociationPopUp?this.confirmEntityDisassociation():null]}):(0,m.jsx)(g.A,{message:"Loading"})}}const W=(0,u.Ng)((e=>({userDetails:e.getUserDetails.userDetails,tokenDetails:e.getUserDetails.TokenAuth})))(R)},43503:(e,t,s)=>{s.d(t,{A:()=>r});s(65043);var a=s(67907),i=s(72711),o=s(70579);function l(e){let{entityCode:t,newEntityName:s,popUpContents:l}=e;return(0,o.jsx)(a.TranslationConsumer,{children:e=>(0,o.jsx)("div",{className:"headerContainer",children:(0,o.jsxs)("div",{className:"row headerSpacing",children:[(0,o.jsx)("div",{className:"col paddingHeaderItemLeft",children:(0,o.jsx)("span",{style:{margin:"auto"},className:"headerLabel",children:""===t||void 0===t?e(s):t})}),""!==t&&void 0!==t&&l.length>0?(0,o.jsx)("div",{className:"headerItemRight",children:(0,o.jsx)(i.Popup,{element:(0,o.jsxs)("div",{children:[e(l[0].fieldName)+" ",":"," "+l[0].fieldValue,(0,o.jsx)(i.Icon,{style:{marginLeft:"10px"},root:"common",name:"caret-down",size:"small"})]}),position:"bottom left",children:(0,o.jsx)(i.List,{className:"detailsHeaderPopUp",children:l.map((t=>(0,o.jsxs)(i.List.Content,{className:"detailsHeaderPopUpListPadding",children:[e(t.fieldName)+" ",":"," "+t.fieldValue]},"content.fieldName")))})})}):""]})})})}l.defaultProps={entityCode:"",newEntityName:"",popUpContents:[]};const r=l},9256:(e,t,s)=>{s.d(t,{q:()=>l});s(65043);var a=s(72711),i=s(67907),o=s(70579);function l(e){let{handleBack:t,handleSave:s,handleReset:l,saveEnabled:r}=e;return(0,o.jsx)(i.TranslationConsumer,{children:e=>(0,o.jsxs)("div",{className:"row userActionPosition",children:[(0,o.jsx)("div",{className:"col-12 col-md-3 col-lg-4",children:(0,o.jsx)(a.Button,{className:"backButton",onClick:t,content:e("Back")})}),(0,o.jsx)("div",{className:"col-12 col-md-9 col-lg-8",children:(0,o.jsxs)("div",{style:{float:"right"},children:[(0,o.jsx)(a.Button,{content:e("LookUpData_btnReset"),className:"cancelButton",onClick:l}),(0,o.jsx)(a.Button,{content:e("Save"),disabled:!r,onClick:s})]})})]})})}l.defaultProps={saveEnabled:!1}}}]);
//# sourceMappingURL=3624.f80f6050.chunk.js.map